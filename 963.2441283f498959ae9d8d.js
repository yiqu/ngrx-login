"use strict";(self.webpackChunklogin_ngrx=self.webpackChunklogin_ngrx||[]).push([[963],{9337:(Lr,bt,V)=>{V.d(bt,{ST:()=>xy});var R,A=V(7716),X=V(3637),y=V(8891),H=V(4402),Xe=V(5917),D=V(7667),ee=V(9761),we=V(9328),J=V(8002),he=V(2145),et=V(7519),Dt=V(5435),Z=V(8747),de=V(8583),be=(V(4828),V(4486)),I=V(8239),Ue=V(5452),_e=V(8308),tt=V(5601),Y=V(3854),fn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ze={},mt=mt||{},q=fn||self;function kt(){}function Rt(s){var n=typeof s;return"array"==(n="object"!=n?n:s?Array.isArray(s)?"array":n:"null")||"object"==n&&"number"==typeof s.length}function j(s){var n=typeof s;return"object"==n&&null!=s||"function"==n}var L="closure_uid_"+(1e9*Math.random()>>>0),C=0;function F(s,n,r){return s.call.apply(s.bind,arguments)}function $(s,n,r){if(!s)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var o=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(o,i),s.apply(n,o)}}return function(){return s.apply(n,arguments)}}function K(s,n,r){return(K=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?F:$).apply(null,arguments)}function fe(s,n){var r=Array.prototype.slice.call(arguments,1);return function(){var i=r.slice();return i.push.apply(i,arguments),s.apply(this,i)}}function ie(s,n){function r(){}r.prototype=n.prototype,s.Z=n.prototype,s.prototype=new r,s.prototype.constructor=s,s.Vb=function(i,o,a){for(var u=Array(arguments.length-2),c=2;c<arguments.length;c++)u[c-2]=arguments[c];return n.prototype[o].apply(i,u)}}function Ve(){this.s=this.s,this.o=this.o}var Hi={};Ve.prototype.s=!1,Ve.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var s=function(s){return Object.prototype.hasOwnProperty.call(s,L)&&s[L]||(s[L]=++C)}(this);delete Hi[s]}},Ve.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Us=Array.prototype.indexOf?function(s,n){return Array.prototype.indexOf.call(s,n,void 0)}:function(s,n){if("string"==typeof s)return"string"!=typeof n||1!=n.length?-1:s.indexOf(n,0);for(let r=0;r<s.length;r++)if(r in s&&s[r]===n)return r;return-1},gn=Array.prototype.forEach?function(s,n,r){Array.prototype.forEach.call(s,n,r)}:function(s,n,r){const i=s.length,o="string"==typeof s?s.split(""):s;for(let a=0;a<i;a++)a in o&&n.call(r,o[a],a,s)};function Mr(s){return Array.prototype.concat.apply([],arguments)}function Fr(s){const n=s.length;if(0<n){const r=Array(n);for(let i=0;i<n;i++)r[i]=s[i];return r}return[]}function Vn(s){return/^[\s\xa0]*$/.test(s)}var Oe,Vs=String.prototype.trim?function(s){return s.trim()}:function(s){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(s)[1]};function We(s,n){return-1!=s.indexOf(n)}function Bn(s,n){return s<n?-1:s>n?1:0}e:{var qn=q.navigator;if(qn){var Ur=qn.userAgent;if(Ur){Oe=Ur;break e}}Oe=""}function Vr(s,n,r){for(const i in s)n.call(r,s[i],i,s)}function jn(s){const n={};for(const r in s)n[r]=s[r];return n}var nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ht(s,n){let r,i;for(let o=1;o<arguments.length;o++){for(r in i=arguments[o],i)s[r]=i[r];for(let a=0;a<nt.length;a++)r=nt[a],Object.prototype.hasOwnProperty.call(i,r)&&(s[r]=i[r])}}function Kn(s){return Kn[" "](s),s}Kn[" "]=kt;var $n,s,Br=We(Oe,"Opera"),Ot=We(Oe,"Trident")||We(Oe,"MSIE"),Bs=We(Oe,"Edge"),Gn=Bs||Ot,qs=We(Oe,"Gecko")&&!(We(Oe.toLowerCase(),"webkit")&&!We(Oe,"Edge"))&&!(We(Oe,"Trident")||We(Oe,"MSIE"))&&!We(Oe,"Edge"),Lt=We(Oe.toLowerCase(),"webkit")&&!We(Oe,"Edge");function qr(){var s=q.document;return s?s.documentMode:void 0}e:{var jr="",Kr=(s=Oe,qs?/rv:([^\);]+)(\)|;)/.exec(s):Bs?/Edge\/([\d\.]+)/.exec(s):Ot?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(s):Lt?/WebKit\/(\S+)/.exec(s):Br?/(?:Version)[ \/]?(\S+)/.exec(s):void 0);if(Kr&&(jr=Kr?Kr[1]:""),Ot){var zn=qr();if(null!=zn&&zn>parseFloat(jr)){$n=String(zn);break e}}$n=jr}var rt={};function Gr(){return n=rt,Object.prototype.hasOwnProperty.call(n,9)?n[9]:n[9]=function(){let s=0;const n=Vs(String($n)).split("."),r=Vs("9").split("."),i=Math.max(n.length,r.length);for(let u=0;0==s&&u<i;u++){var o=n[u]||"",a=r[u]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;s=Bn(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||Bn(0==o[2].length,0==a[2].length)||Bn(o[2],a[2]),o=o[3],a=a[3]}while(0==s)}return 0<=s}();var n}var Ji=q.document&&Ot&&(qr()||parseInt($n,10))||void 0,At=function(){if(!q.addEventListener||!Object.defineProperty)return!1;var s=!1,n=Object.defineProperty({},"passive",{get:function(){s=!0}});try{q.addEventListener("test",kt,n),q.removeEventListener("test",kt,n)}catch(r){}return s}();function Ee(s,n){this.type=s,this.g=this.target=n,this.defaultPrevented=!1}function Qt(s,n){if(Ee.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s){var r=this.type=s.type,i=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;if(this.target=s.target||s.srcElement,this.g=n,n=s.relatedTarget){if(qs){e:{try{Kn(n.nodeName);var o=!0;break e}catch(a){}o=!1}o||(n=null)}}else"mouseover"==r?n=s.fromElement:"mouseout"==r&&(n=s.toElement);this.relatedTarget=n,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType="string"==typeof s.pointerType?s.pointerType:js[s.pointerType]||"",this.state=s.state,this.i=s,s.defaultPrevented&&Qt.Z.h.call(this)}}Ee.prototype.h=function(){this.defaultPrevented=!0},ie(Qt,Ee);var js={2:"touch",3:"pen",4:"mouse"};Qt.prototype.h=function(){Qt.Z.h.call(this);var s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var Bt="closure_listenable_"+(1e6*Math.random()|0),Xi=0;function eo(s,n,r,i,o){this.listener=s,this.proxy=null,this.src=n,this.type=r,this.capture=!!i,this.ia=o,this.key=++Xi,this.ca=this.fa=!1}function Zn(s){s.ca=!0,s.listener=null,s.proxy=null,s.src=null,s.ia=null}function Hn(s){this.src=s,this.g={},this.h=0}function v(s,n){var r=n.type;if(r in s.g){var a,i=s.g[r],o=Us(i,n);(a=0<=o)&&Array.prototype.splice.call(i,o,1),a&&(Zn(n),0==s.g[r].length&&(delete s.g[r],s.h--))}}function f(s,n,r,i){for(var o=0;o<s.length;++o){var a=s[o];if(!a.ca&&a.listener==n&&a.capture==!!r&&a.ia==i)return o}return-1}Hn.prototype.add=function(s,n,r,i,o){var a=s.toString();(s=this.g[a])||(s=this.g[a]=[],this.h++);var u=f(s,n,i,o);return-1<u?(n=s[u],r||(n.fa=!1)):((n=new eo(n,this.src,a,!!i,o)).fa=r,s.push(n)),n};var m="closure_lm_"+(1e6*Math.random()|0),T={};function O(s,n,r,i,o){if(i&&i.once)return oe(s,n,r,i,o);if(Array.isArray(n)){for(var a=0;a<n.length;a++)O(s,n[a],r,i,o);return null}return r=to(r),s&&s[Bt]?s.N(n,r,j(i)?!!i.capture:!!i,o):G(s,n,r,!1,i,o)}function G(s,n,r,i,o,a){if(!n)throw Error("Invalid event type");var u=j(o)?!!o.capture:!!o,c=Et(s);if(c||(s[m]=c=new Hn(s)),(r=c.add(n,r,i,u,a)).proxy)return r;if(i=function(){var n=ae;return function s(r){return n.call(s.src,s.listener,r)}}(),r.proxy=i,i.src=s,i.listener=r,s.addEventListener)At||(o=u),void 0===o&&(o=!1),s.addEventListener(n.toString(),i,o);else if(s.attachEvent)s.attachEvent(pt(n.toString()),i);else{if(!s.addListener||!s.removeListener)throw Error("addEventListener and attachEvent are unavailable.");s.addListener(i)}return r}function oe(s,n,r,i,o){if(Array.isArray(n)){for(var a=0;a<n.length;a++)oe(s,n[a],r,i,o);return null}return r=to(r),s&&s[Bt]?s.O(n,r,j(i)?!!i.capture:!!i,o):G(s,n,r,!0,i,o)}function Le(s,n,r,i,o){if(Array.isArray(n))for(var a=0;a<n.length;a++)Le(s,n[a],r,i,o);else i=j(i)?!!i.capture:!!i,r=to(r),s&&s[Bt]?(s=s.i,(n=String(n).toString())in s.g&&-1<(r=f(a=s.g[n],r,i,o))&&(Zn(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete s.g[n],s.h--))):s&&(s=Et(s))&&(n=s.g[n.toString()],s=-1,n&&(s=f(n,r,i,o)),(r=-1<s?n[s]:null)&&at(r))}function at(s){if("number"!=typeof s&&s&&!s.ca){var n=s.src;if(n&&n[Bt])v(n.i,s);else{var r=s.type,i=s.proxy;n.removeEventListener?n.removeEventListener(r,i,s.capture):n.detachEvent?n.detachEvent(pt(r),i):n.addListener&&n.removeListener&&n.removeListener(i),(r=Et(n))?(v(r,s),0==r.h&&(r.src=null,n[m]=null)):Zn(s)}}}function pt(s){return s in T?T[s]:T[s]="on"+s}function ae(s,n){if(s.ca)s=!0;else{n=new Qt(n,this);var r=s.listener,i=s.ia||s.src;s.fa&&at(s),s=r.call(i,n)}return s}function Et(s){return(s=s[m])instanceof Hn?s:null}var Qn="__closure_events_fn_"+(1e9*Math.random()>>>0);function to(s){return"function"==typeof s?s:(s[Qn]||(s[Qn]=function(n){return s.handleEvent(n)}),s[Qn])}function Be(){Ve.call(this),this.i=new Hn(this),this.P=this,this.I=null}function Ze(s,n){var r,i=s.I;if(i)for(r=[];i;i=i.I)r.push(i);if(s=s.P,i=n.type||n,"string"==typeof n)n=new Ee(n,s);else if(n instanceof Ee)n.target=n.target||s;else{var o=n;Ht(n=new Ee(i,s),o)}if(o=!0,r)for(var a=r.length-1;0<=a;a--){var u=n.g=r[a];o=Ks(u,i,!0,n)&&o}if(o=Ks(u=n.g=s,i,!0,n)&&o,o=Ks(u,i,!1,n)&&o,r)for(a=0;a<r.length;a++)o=Ks(u=n.g=r[a],i,!1,n)&&o}function Ks(s,n,r,i){if(!(n=s.i.g[String(n)]))return!0;n=n.concat();for(var o=!0,a=0;a<n.length;++a){var u=n[a];if(u&&!u.ca&&u.capture==r){var c=u.listener,l=u.ia||u.src;u.fa&&v(s.i,u),o=!1!==c.call(l,i)&&o}}return o&&!i.defaultPrevented}ie(Be,Ve),Be.prototype[Bt]=!0,Be.prototype.removeEventListener=function(s,n,r,i){Le(this,s,n,r,i)},Be.prototype.M=function(){if(Be.Z.M.call(this),this.i){var n,s=this.i;for(n in s.g){for(var r=s.g[n],i=0;i<r.length;i++)Zn(r[i]);delete s.g[n],s.h--}}this.I=null},Be.prototype.N=function(s,n,r,i){return this.i.add(String(s),n,!1,r,i)},Be.prototype.O=function(s,n,r,i){return this.i.add(String(s),n,!0,r,i)};var no=q.JSON.stringify;function Bd(){var s=Mu;let n=null;return s.g&&(n=s.g,s.g=s.g.next,s.g||(s.h=null),n.next=null),n}var so,Pu=new class{constructor(s,n){this.i=s,this.j=n,this.h=0,this.g=null}get(){let s;return 0<this.h?(this.h--,s=this.g,this.g=s.next,s.next=null):s=this.i(),s}}(()=>new jd,s=>s.reset());class jd{constructor(){this.next=this.g=this.h=null}set(n,r){this.h=n,this.g=r,this.next=null}reset(){this.next=this.g=this.h=null}}function Kd(s){q.setTimeout(()=>{throw s},0)}function ro(s,n){so||function(){var s=q.Promise.resolve(void 0);so=function(){s.then($d)}}(),io||(so(),io=!0),Mu.add(s,n)}var io=!1,Mu=new class{constructor(){this.h=this.g=null}add(n,r){const i=Pu.get();i.set(n,r),this.h?this.h.next=i:this.g=i,this.h=i}};function $d(){for(var s;s=Bd();){try{s.h.call(s.g)}catch(r){Kd(r)}var n=Pu;n.j(s),100>n.h&&(n.h++,s.next=n.g,n.g=s)}io=!1}function Gs(s,n){Be.call(this),this.h=s||1,this.g=n||q,this.j=K(this.kb,this),this.l=Date.now()}function oo(s){s.da=!1,s.S&&(s.g.clearTimeout(s.S),s.S=null)}function ao(s,n,r){if("function"==typeof s)r&&(s=K(s,r));else{if(!s||"function"!=typeof s.handleEvent)throw Error("Invalid listener argument");s=K(s.handleEvent,s)}return 2147483647<Number(n)?-1:q.setTimeout(s,n||0)}function Fu(s){s.g=ao(()=>{s.g=null,s.i&&(s.i=!1,Fu(s))},s.j);const n=s.h;s.h=null,s.m.apply(null,n)}ie(Gs,Be),(R=Gs.prototype).da=!1,R.S=null,R.kb=function(){if(this.da){var s=Date.now()-this.l;0<s&&s<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-s):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Ze(this,"tick"),this.da&&(oo(this),this.start()))}},R.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},R.M=function(){Gs.Z.M.call(this),oo(this),delete this.g};class zd extends Ve{constructor(n,r){super(),this.m=n,this.j=r,this.h=null,this.i=!1,this.g=null}l(n){this.h=arguments,this.g?this.i=!0:Fu(this)}M(){super.M(),this.g&&(q.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function $r(s){Ve.call(this),this.h=s,this.g={}}ie($r,Ve);var Uu=[];function Vu(s,n,r,i){Array.isArray(r)||(r&&(Uu[0]=r.toString()),r=Uu);for(var o=0;o<r.length;o++){var a=O(n,r[o],i||s.handleEvent,!1,s.h||s);if(!a)break;s.g[a.key]=a}}function Bu(s){Vr(s.g,function(n,r){this.g.hasOwnProperty(r)&&at(n)},s),s.g={}}function $s(){this.g=!0}function Yn(s,n,r,i){s.info(function(){return"XMLHTTP TEXT ("+n+"): "+function(s,n){if(!s.g)return n;if(!n)return null;try{var r=JSON.parse(n);if(r)for(s=0;s<r.length;s++)if(Array.isArray(r[s])){var i=r[s];if(!(2>i.length)){var o=i[1];if(Array.isArray(o)&&!(1>o.length)){var a=o[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var u=1;u<o.length;u++)o[u]=""}}}return no(r)}catch(c){return n}}(s,r)+(i?" "+i:"")})}$r.prototype.M=function(){$r.Z.M.call(this),Bu(this)},$r.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},$s.prototype.Aa=function(){this.g=!1},$s.prototype.info=function(){};var pn={},qu=null;function zs(){return qu=qu||new Be}function ju(s){Ee.call(this,pn.Ma,s)}function zr(s){const n=zs();Ze(n,new ju(n,s))}function Ku(s,n){Ee.call(this,pn.STAT_EVENT,s),this.stat=n}function ut(s){const n=zs();Ze(n,new Ku(n,s))}function Gu(s,n){Ee.call(this,pn.Na,s),this.size=n}function Wr(s,n){if("function"!=typeof s)throw Error("Fn must not be null and must be a function");return q.setTimeout(function(){s()},n)}pn.Ma="serverreachability",ie(ju,Ee),pn.STAT_EVENT="statevent",ie(Ku,Ee),pn.Na="timingevent",ie(Gu,Ee);var Ws={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},$u={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function uo(){}function Wu(){}uo.prototype.h=null;var ho,Zr={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function co(){Ee.call(this,"d")}function lo(){Ee.call(this,"c")}function Zs(){}function Hr(s,n,r,i){this.l=s,this.j=n,this.m=r,this.X=i||1,this.V=new $r(this),this.P=Yd,this.W=new Gs(s=Gn?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Zu}function Zu(){this.i=null,this.g="",this.h=!1}ie(co,Ee),ie(lo,Ee),ie(Zs,uo),Zs.prototype.g=function(){return new XMLHttpRequest},Zs.prototype.i=function(){return{}},ho=new Zs;var Yd=45e3,fo={},Hs={};function go(s,n,r){s.K=1,s.v=ei(qt(n)),s.s=r,s.U=!0,Hu(s,null)}function Hu(s,n){s.F=Date.now(),Qr(s),s.A=qt(s.v);var r=s.A,i=s.X;Array.isArray(i)||(i=[String(i)]),sc(r.h,"t",i),s.C=0,r=s.l.H,s.h=new Zu,s.g=Ac(s.l,r?n:null,!s.s),0<s.O&&(s.L=new zd(K(s.Ia,s,s.g),s.O)),Vu(s.V,s.g,"readystatechange",s.gb),n=s.H?jn(s.H):{},s.s?(s.u||(s.u="POST"),n["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.A,s.u,s.s,n)):(s.u="GET",s.g.ea(s.A,s.u,null,n)),zr(1),function(s,n,r,i,o,a){s.info(function(){if(s.g)if(a)for(var u="",c=a.split("&"),l=0;l<c.length;l++){var h=c[l].split("=");if(1<h.length){var d=h[0];h=h[1];var g=d.split("_");u=2<=g.length&&"type"==g[1]?u+(d+"=")+h+"&":u+(d+"=redacted&")}}else u=null;else u=a;return"XMLHTTP REQ ("+i+") [attempt "+o+"]: "+n+"\n"+r+"\n"+u})}(s.j,s.u,s.A,s.m,s.X,s.s)}function Qu(s){return!!s.g&&"GET"==s.u&&2!=s.K&&s.l.Ba}function Yu(s,n,r){let o,i=!0;for(;!s.I&&s.C<r.length;){if(o=Jd(s,r),o==Hs){4==n&&(s.o=4,ut(14),i=!1),Yn(s.j,s.m,null,"[Incomplete Response]");break}if(o==fo){s.o=4,ut(15),Yn(s.j,s.m,r,"[Invalid Chunk]"),i=!1;break}Yn(s.j,s.m,o,null),mo(s,o)}Qu(s)&&o!=Hs&&o!=fo&&(s.h.g="",s.C=0),4!=n||0!=r.length||s.h.h||(s.o=1,ut(16),i=!1),s.i=s.i&&i,i?0<r.length&&!s.aa&&(s.aa=!0,(n=s.l).g==s&&n.$&&!n.L&&(n.h.info("Great, no buffering proxy detected. Bytes received: "+r.length),bo(n),n.L=!0,ut(11))):(Yn(s.j,s.m,r,"[Invalid Chunked Response]"),yn(s),Yr(s))}function Jd(s,n){var r=s.C,i=n.indexOf("\n",r);return-1==i?Hs:(r=Number(n.substring(r,i)),isNaN(r)?fo:(i+=1)+r>n.length?Hs:(n=n.substr(i,r),s.C=i+r,n))}function Qr(s){s.Y=Date.now()+s.P,Ju(s,s.P)}function Ju(s,n){if(null!=s.B)throw Error("WatchDog timer not null");s.B=Wr(K(s.eb,s),n)}function Qs(s){s.B&&(q.clearTimeout(s.B),s.B=null)}function Yr(s){0==s.l.G||s.I||Tc(s.l,s)}function yn(s){Qs(s);var n=s.L;n&&"function"==typeof n.na&&n.na(),s.L=null,oo(s.W),Bu(s.V),s.g&&(n=s.g,s.g=null,n.abort(),n.na())}function mo(s,n){try{var r=s.l;if(0!=r.G&&(r.g==s||vo(r.i,s)))if(r.I=s.N,!s.J&&vo(r.i,s)&&3==r.G){try{var i=r.Ca.g.parse(n)}catch(h){i=null}if(Array.isArray(i)&&3==i.length){var o=i;if(0==o[0])e:if(r.u)r.ta=o[1],0<r.ta-r.U&&37500>o[2]&&r.N&&0==r.A&&!r.v&&(r.v=Wr(K(r.ab,r),6e3));else{if(r.g){if(!(r.g.F+3e3<s.F))break e;oi(r),si(r)}xo(r),ut(18)}if(1>=ac(r.i)&&r.ka){try{r.ka()}catch(h){}r.ka=void 0}}else _n(r,11)}else if((s.J||r.g==s)&&oi(r),!Vn(n))for(o=r.Ca.g.parse(n),n=0;n<o.length;n++){let h=o[n];if(r.U=h[0],h=h[1],2==r.G)if("c"==h[0]){r.J=h[1],r.la=h[2];const d=h[3];null!=d&&(r.ma=d,r.h.info("VER="+r.ma));const g=h[4];null!=g&&(r.za=g,r.h.info("SVER="+r.za));const _=h[5];null!=_&&"number"==typeof _&&0<_&&(r.K=i=1.5*_,r.h.info("backChannelRequestTimeoutMs_="+i)),i=r;const E=s.g;if(E){const b=E.g?E.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(b){var a=i.i;!a.g&&(We(b,"spdy")||We(b,"quic")||We(b,"h2"))&&(a.j=a.l,a.g=new Set,a.h&&(wo(a,a.h),a.h=null))}if(i.D){const M=E.g?E.g.getResponseHeader("X-HTTP-Session-Id"):null;M&&(i.sa=M,ye(i.F,i.D,M))}}r.G=3,r.j&&r.j.xa(),r.$&&(r.O=Date.now()-s.F,r.h.info("Handshake RTT: "+r.O+"ms"));var u=s;if((i=r).oa=bc(i,i.H?i.la:null,i.W),u.J){uc(i.i,u);var c=u,l=i.K;l&&c.setTimeout(l),c.B&&(Qs(c),Qr(c)),i.g=u}else Ic(i);0<r.l.length&&ii(r)}else"stop"!=h[0]&&"close"!=h[0]||_n(r,7);else 3==r.G&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?_n(r,7):To(r):"noop"!=h[0]&&r.j&&r.j.wa(h),r.A=0)}zr(4)}catch(h){}}function po(s,n){if(s.forEach&&"function"==typeof s.forEach)s.forEach(n,void 0);else if(Rt(s)||"string"==typeof s)gn(s,n,void 0);else{if(s.T&&"function"==typeof s.T)var r=s.T();else if(s.R&&"function"==typeof s.R)r=void 0;else if(Rt(s)||"string"==typeof s){r=[];for(var i=s.length,o=0;o<i;o++)r.push(o)}else for(o in r=[],i=0,s)r[i++]=o;o=(i=function(s){if(s.R&&"function"==typeof s.R)return s.R();if("string"==typeof s)return s.split("");if(Rt(s)){for(var n=[],r=s.length,i=0;i<r;i++)n.push(s[i]);return n}for(i in n=[],r=0,s)n[r++]=s[i];return n}(s)).length;for(var a=0;a<o;a++)n.call(void 0,i[a],r&&r[a],s)}}function Jn(s,n){this.h={},this.g=[],this.i=0;var r=arguments.length;if(1<r){if(r%2)throw Error("Uneven number of arguments");for(var i=0;i<r;i+=2)this.set(arguments[i],arguments[i+1])}else if(s)if(s instanceof Jn)for(r=s.T(),i=0;i<r.length;i++)this.set(r[i],s.get(r[i]));else for(i in s)this.set(i,s[i])}function yo(s){if(s.i!=s.g.length){for(var n=0,r=0;n<s.g.length;){var i=s.g[n];vn(s.h,i)&&(s.g[r++]=i),n++}s.g.length=r}if(s.i!=s.g.length){var o={};for(r=n=0;n<s.g.length;)vn(o,i=s.g[n])||(s.g[r++]=i,o[i]=1),n++;s.g.length=r}}function vn(s,n){return Object.prototype.hasOwnProperty.call(s,n)}(R=Hr.prototype).setTimeout=function(s){this.P=s},R.gb=function(s){s=s.target;const n=this.L;n&&3==jt(s)?n.l():this.Ia(s)},R.Ia=function(s){try{if(s==this.g)e:{const d=jt(this.g);var n=this.g.Da();const g=this.g.ba();if(!(3>d)&&(3!=d||Gn||this.g&&(this.h.h||this.g.ga()||pc(this.g)))){this.I||4!=d||7==n||zr(8==n||0>=g?3:2),Qs(this);var r=this.g.ba();this.N=r;t:if(Qu(this)){var i=pc(this.g);s="";var o=i.length,a=4==jt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){yn(this),Yr(this);var u="";break t}this.h.i=new q.TextDecoder}for(n=0;n<o;n++)this.h.h=!0,s+=this.h.i.decode(i[n],{stream:a&&n==o-1});i.splice(0,o),this.h.g+=s,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==r,function(s,n,r,i,o,a,u){s.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+o+"]: "+n+"\n"+r+"\n"+a+" "+u})}(this.j,this.u,this.A,this.m,this.X,d,r),this.i){if(this.$&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Vn(c)){var h=c;break t}}h=null}if(!(r=h)){this.i=!1,this.o=3,ut(12),yn(this),Yr(this);break e}Yn(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,mo(this,r)}this.U?(Yu(this,d,u),Gn&&this.i&&3==d&&(Vu(this.V,this.W,"tick",this.fb),this.W.start())):(Yn(this.j,this.m,u,null),mo(this,u)),4==d&&yn(this),this.i&&!this.I&&(4==d?Tc(this.l,this):(this.i=!1,Qr(this)))}else 400==r&&0<u.indexOf("Unknown SID")?(this.o=3,ut(12)):(this.o=0,ut(13)),yn(this),Yr(this)}}}catch(d){}},R.fb=function(){if(this.g){var s=jt(this.g),n=this.g.ga();this.C<n.length&&(Qs(this),Yu(this,s,n),this.i&&4!=s&&Qr(this))}},R.cancel=function(){this.I=!0,yn(this)},R.eb=function(){this.B=null;const s=Date.now();0<=s-this.Y?(function(s,n){s.info(function(){return"TIMEOUT: "+n})}(this.j,this.A),2!=this.K&&(zr(3),ut(17)),yn(this),this.o=2,Yr(this)):Ju(this,this.Y-s)},(R=Jn.prototype).R=function(){yo(this);for(var s=[],n=0;n<this.g.length;n++)s.push(this.h[this.g[n]]);return s},R.T=function(){return yo(this),this.g.concat()},R.get=function(s,n){return vn(this.h,s)?this.h[s]:n},R.set=function(s,n){vn(this.h,s)||(this.i++,this.g.push(s)),this.h[s]=n},R.forEach=function(s,n){for(var r=this.T(),i=0;i<r.length;i++){var o=r[i],a=this.get(o);s.call(n,a,o,this)}};var Xu=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function wn(s,n){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,s instanceof wn){this.g=void 0!==n?n:s.g,Ys(this,s.j),this.s=s.s,Js(this,s.i),Xs(this,s.m),this.l=s.l,n=s.h;var r=new es;r.i=n.i,n.g&&(r.g=new Jn(n.g),r.h=n.h),ec(this,r),this.o=s.o}else s&&(r=String(s).match(Xu))?(this.g=!!n,Ys(this,r[1]||"",!0),this.s=Jr(r[2]||""),Js(this,r[3]||"",!0),Xs(this,r[4]),this.l=Jr(r[5]||"",!0),ec(this,r[6]||"",!0),this.o=Jr(r[7]||"")):(this.g=!!n,this.h=new es(null,this.g))}function qt(s){return new wn(s)}function Ys(s,n,r){s.j=r?Jr(n,!0):n,s.j&&(s.j=s.j.replace(/:$/,""))}function Js(s,n,r){s.i=r?Jr(n,!0):n}function Xs(s,n){if(n){if(n=Number(n),isNaN(n)||0>n)throw Error("Bad port number "+n);s.m=n}else s.m=null}function ec(s,n,r){n instanceof es?(s.h=n,function(s,n){n&&!s.j&&(Yt(s),s.i=null,s.g.forEach(function(r,i){var o=i.toLowerCase();i!=o&&(nc(this,i),sc(this,o,r))},s)),s.j=n}(s.h,s.g)):(r||(n=Xr(n,af)),s.h=new es(n,s.g))}function ye(s,n,r){s.h.set(n,r)}function ei(s){return ye(s,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),s}function Jr(s,n){return s?n?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function Xr(s,n,r){return"string"==typeof s?(s=encodeURI(s).replace(n,rf),r&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function rf(s){return"%"+((s=s.charCodeAt(0))>>4&15).toString(16)+(15&s).toString(16)}wn.prototype.toString=function(){var s=[],n=this.j;n&&s.push(Xr(n,tc,!0),":");var r=this.i;return(r||"file"==n)&&(s.push("//"),(n=this.s)&&s.push(Xr(n,tc,!0),"@"),s.push(encodeURIComponent(String(r)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.m)&&s.push(":",String(r))),(r=this.l)&&(this.i&&"/"!=r.charAt(0)&&s.push("/"),s.push(Xr(r,"/"==r.charAt(0)?of:sf,!0))),(r=this.h.toString())&&s.push("?",r),(r=this.o)&&s.push("#",Xr(r,uf)),s.join("")};var tc=/[#\/\?@]/g,sf=/[#\?:]/g,of=/[#\?]/g,af=/[#\?@]/g,uf=/#/g;function es(s,n){this.h=this.g=null,this.i=s||null,this.j=!!n}function Yt(s){s.g||(s.g=new Jn,s.h=0,s.i&&function(s,n){if(s){s=s.split("&");for(var r=0;r<s.length;r++){var i=s[r].indexOf("="),o=null;if(0<=i){var a=s[r].substring(0,i);o=s[r].substring(i+1)}else a=s[r];n(a,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(s.i,function(n,r){s.add(decodeURIComponent(n.replace(/\+/g," ")),r)}))}function nc(s,n){Yt(s),n=Xn(s,n),vn(s.g.h,n)&&(s.i=null,s.h-=s.g.get(n).length,vn((s=s.g).h,n)&&(delete s.h[n],s.i--,s.g.length>2*s.i&&yo(s)))}function rc(s,n){return Yt(s),n=Xn(s,n),vn(s.g.h,n)}function sc(s,n,r){nc(s,n),0<r.length&&(s.i=null,s.g.set(Xn(s,n),Fr(r)),s.h+=r.length)}function Xn(s,n){return n=String(n),s.j&&(n=n.toLowerCase()),n}function ic(s){this.l=s||hf,s=q.PerformanceNavigationTiming?0<(s=q.performance.getEntriesByType("navigation")).length&&("hq"==s[0].nextHopProtocol||"h2"==s[0].nextHopProtocol):!!(q.g&&q.g.Ea&&q.g.Ea()&&q.g.Ea().Zb),this.j=s?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(R=es.prototype).add=function(s,n){Yt(this),this.i=null,s=Xn(this,s);var r=this.g.get(s);return r||this.g.set(s,r=[]),r.push(n),this.h+=1,this},R.forEach=function(s,n){Yt(this),this.g.forEach(function(r,i){gn(r,function(o){s.call(n,o,i,this)},this)},this)},R.T=function(){Yt(this);for(var s=this.g.R(),n=this.g.T(),r=[],i=0;i<n.length;i++)for(var o=s[i],a=0;a<o.length;a++)r.push(n[i]);return r},R.R=function(s){Yt(this);var n=[];if("string"==typeof s)rc(this,s)&&(n=Mr(n,this.g.get(Xn(this,s))));else{s=this.g.R();for(var r=0;r<s.length;r++)n=Mr(n,s[r])}return n},R.set=function(s,n){return Yt(this),this.i=null,rc(this,s=Xn(this,s))&&(this.h-=this.g.get(s).length),this.g.set(s,[n]),this.h+=1,this},R.get=function(s,n){return s&&0<(s=this.R(s)).length?String(s[0]):n},R.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var s=[],n=this.g.T(),r=0;r<n.length;r++){var i=n[r],o=encodeURIComponent(String(i));i=this.R(i);for(var a=0;a<i.length;a++){var u=o;""!==i[a]&&(u+="="+encodeURIComponent(String(i[a]))),s.push(u)}}return this.i=s.join("&")};var hf=10;function oc(s){return!!s.h||!!s.g&&s.g.size>=s.j}function ac(s){return s.h?1:s.g?s.g.size:0}function vo(s,n){return s.h?s.h==n:!!s.g&&s.g.has(n)}function wo(s,n){s.g?s.g.add(n):s.h=n}function uc(s,n){s.h&&s.h==n?s.h=null:s.g&&s.g.has(n)&&s.g.delete(n)}function cc(s){if(null!=s.h)return s.i.concat(s.h.D);if(null!=s.g&&0!==s.g.size){let n=s.i;for(const r of s.g.values())n=n.concat(r.D);return n}return Fr(s.i)}function _o(){}function df(){this.g=new _o}function ff(s,n,r){const i=r||"";try{po(s,function(o,a){let u=o;j(o)&&(u=no(o)),n.push(i+a+"="+encodeURIComponent(u))})}catch(o){throw n.push(i+"type="+encodeURIComponent("_badmap")),o}}function ti(s,n,r,i,o){try{n.onload=null,n.onerror=null,n.onabort=null,n.ontimeout=null,o(i)}catch(a){}}function ts(s){this.l=s.$b||null,this.j=s.ib||!1}function ni(s,n){Be.call(this),this.D=s,this.u=n,this.m=void 0,this.readyState=Io,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ic.prototype.cancel=function(){if(this.i=cc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const s of this.g.values())s.cancel();this.g.clear()}},_o.prototype.stringify=function(s){return q.JSON.stringify(s,void 0)},_o.prototype.parse=function(s){return q.JSON.parse(s,void 0)},ie(ts,uo),ts.prototype.g=function(){return new ni(this.l,this.j)},ts.prototype.i=function(s){return function(){return s}}({}),ie(ni,Be);var Io=0;function lc(s){s.j.read().then(s.Sa.bind(s)).catch(s.ha.bind(s))}function ns(s){s.readyState=4,s.l=null,s.j=null,s.A=null,rs(s)}function rs(s){s.onreadystatechange&&s.onreadystatechange.call(s)}(R=ni.prototype).open=function(s,n){if(this.readyState!=Io)throw this.abort(),Error("Error reopening a connection");this.C=s,this.B=n,this.readyState=1,rs(this)},R.send=function(s){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const n={headers:this.v,method:this.C,credentials:this.m,cache:void 0};s&&(n.body=s),(this.D||q).fetch(new Request(this.B,n)).then(this.Va.bind(this),this.ha.bind(this))},R.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ns(this)),this.readyState=Io},R.Va=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,rs(this)),this.g&&(this.readyState=3,rs(this),this.g)))if("arraybuffer"===this.responseType)s.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==q.ReadableStream&&"body"in s){if(this.j=s.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;lc(this)}else s.text().then(this.Ua.bind(this),this.ha.bind(this))},R.Sa=function(s){if(this.g){if(this.u&&s.value)this.response.push(s.value);else if(!this.u){var n=s.value?s.value:new Uint8Array(0);(n=this.A.decode(n,{stream:!s.done}))&&(this.response=this.responseText+=n)}s.done?ns(this):rs(this),3==this.readyState&&lc(this)}},R.Ua=function(s){this.g&&(this.response=this.responseText=s,ns(this))},R.Ta=function(s){this.g&&(this.response=s,ns(this))},R.ha=function(){this.g&&ns(this)},R.setRequestHeader=function(s,n){this.v.append(s,n)},R.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},R.getAllResponseHeaders=function(){if(!this.h)return"";const s=[],n=this.h.entries();for(var r=n.next();!r.done;)s.push((r=r.value)[0]+": "+r[1]),r=n.next();return s.join("\r\n")},Object.defineProperty(ni.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(s){this.m=s?"include":"same-origin"}});var mf=q.JSON.parse;function Ne(s){Be.call(this),this.headers=new Jn,this.u=s||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=hc,this.K=this.L=!1}ie(Ne,Be);var hc="",pf=/^https?$/i,yf=["POST","PUT"];function wf(s){return"content-type"==s.toLowerCase()}function dc(s,n){s.h=!1,s.g&&(s.l=!0,s.g.abort(),s.l=!1),s.j=n,s.m=5,fc(s),ri(s)}function fc(s){s.D||(s.D=!0,Ze(s,"complete"),Ze(s,"error"))}function gc(s){if(s.h&&void 0!==mt&&(!s.C[1]||4!=jt(s)||2!=s.ba()))if(s.v&&4==jt(s))ao(s.Fa,0,s);else if(Ze(s,"readystatechange"),4==jt(s)){s.h=!1;try{const c=s.ba();e:switch(c){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var n=!0;break e;default:n=!1}var r;if(!(r=n)){var i;if(i=0===c){var o=String(s.H).match(Xu)[1]||null;if(!o&&q.self&&q.self.location){var a=q.self.location.protocol;o=a.substr(0,a.length-1)}i=!pf.test(o?o.toLowerCase():"")}r=i}if(r)Ze(s,"complete"),Ze(s,"success");else{s.m=6;try{var u=2<jt(s)?s.g.statusText:""}catch(l){u=""}s.j=u+" ["+s.ba()+"]",fc(s)}}finally{ri(s)}}}function ri(s,n){if(s.g){mc(s);const r=s.g,i=s.C[0]?kt:null;s.g=null,s.C=null,n||Ze(s,"ready");try{r.onreadystatechange=i}catch(o){}}}function mc(s){s.g&&s.K&&(s.g.ontimeout=null),s.A&&(q.clearTimeout(s.A),s.A=null)}function jt(s){return s.g?s.g.readyState:0}function pc(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.J){case hc:case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch(n){return null}}function Eo(s,n,r){e:{for(i in r){var i=!1;break e}i=!0}i||(r=function(s){let n="";return Vr(s,function(r,i){n+=i,n+=":",n+=r,n+="\r\n"}),n}(r),"string"==typeof s?null!=r&&encodeURIComponent(String(r)):ye(s,n,r))}function ss(s,n,r){return r&&r.internalChannelParams&&r.internalChannelParams[s]||n}function yc(s){this.za=0,this.l=[],this.h=new $s,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=ss("failFast",!1,s),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=ss("baseRetryDelayMs",5e3,s),this.$a=ss("retryDelaySeedMs",1e4,s),this.Ya=ss("forwardChannelMaxRetries",2,s),this.ra=ss("forwardChannelRequestTimeoutMs",2e4,s),this.qa=s&&s.xmlHttpFactory||void 0,this.Ba=s&&s.Yb||!1,this.K=void 0,this.H=s&&s.supportsCrossDomainXhr||!1,this.J="",this.i=new ic(s&&s.concurrentRequestLimit),this.Ca=new df,this.ja=s&&s.fastHandshake||!1,this.Ra=s&&s.Wb||!1,s&&s.Aa&&this.h.Aa(),s&&s.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&s&&s.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!s||!1!==s.Xb}function To(s){if(vc(s),3==s.G){var n=s.V++,r=qt(s.F);ye(r,"SID",s.J),ye(r,"RID",n),ye(r,"TYPE","terminate"),is(s,r),(n=new Hr(s,s.h,n,void 0)).K=2,n.v=ei(qt(r)),r=!1,q.navigator&&q.navigator.sendBeacon&&(r=q.navigator.sendBeacon(n.v.toString(),"")),!r&&q.Image&&((new Image).src=n.v,r=!0),r||(n.g=Ac(n.l,null),n.g.ea(n.v)),n.F=Date.now(),Qr(n)}xc(s)}function si(s){s.g&&(bo(s),s.g.cancel(),s.g=null)}function vc(s){si(s),s.u&&(q.clearTimeout(s.u),s.u=null),oi(s),s.i.cancel(),s.m&&("number"==typeof s.m&&q.clearTimeout(s.m),s.m=null)}function So(s,n){s.l.push(new class{constructor(s,n){this.h=s,this.g=n}}(s.Za++,n)),3==s.G&&ii(s)}function ii(s){oc(s.i)||s.m||(s.m=!0,ro(s.Ha,s),s.C=0)}function wc(s,n){var r;r=n?n.m:s.V++;const i=qt(s.F);ye(i,"SID",s.J),ye(i,"RID",r),ye(i,"AID",s.U),is(s,i),s.o&&s.s&&Eo(i,s.o,s.s),r=new Hr(s,s.h,r,s.C+1),null===s.o&&(r.H=s.s),n&&(s.l=n.D.concat(s.l)),n=_c(s,r,1e3),r.setTimeout(Math.round(.5*s.ra)+Math.round(.5*s.ra*Math.random())),wo(s.i,r),go(r,i,n)}function is(s,n){s.j&&po({},function(r,i){ye(n,i,r)})}function _c(s,n,r){r=Math.min(s.l.length,r);var i=s.j?K(s.j.Oa,s.j,s):null;e:{var o=s.l;let a=-1;for(;;){const u=["count="+r];-1==a?0<r?(a=o[0].h,u.push("ofs="+a)):a=0:u.push("ofs="+a);let c=!0;for(let l=0;l<r;l++){let h=o[l].h;const d=o[l].g;if(h-=a,0>h)a=Math.max(0,o[l].h-100),c=!1;else try{ff(d,u,"req"+h+"_")}catch(g){i&&i(d)}}if(c){i=u.join("&");break e}}}return s=s.l.splice(0,r),n.D=s,i}function Ic(s){s.g||s.u||(s.Y=1,ro(s.Ga,s),s.A=0)}function xo(s){return!(s.g||s.u||3<=s.A||(s.Y++,s.u=Wr(K(s.Ga,s),Sc(s,s.A)),s.A++,0))}function bo(s){null!=s.B&&(q.clearTimeout(s.B),s.B=null)}function Ec(s){s.g=new Hr(s,s.h,"rpc",s.Y),null===s.o&&(s.g.H=s.s),s.g.O=0;var n=qt(s.oa);ye(n,"RID","rpc"),ye(n,"SID",s.J),ye(n,"CI",s.N?"0":"1"),ye(n,"AID",s.U),is(s,n),ye(n,"TYPE","xmlhttp"),s.o&&s.s&&Eo(n,s.o,s.s),s.K&&s.g.setTimeout(s.K);var r=s.g;s=s.la,r.K=1,r.v=ei(qt(n)),r.s=null,r.U=!0,Hu(r,s)}function oi(s){null!=s.v&&(q.clearTimeout(s.v),s.v=null)}function Tc(s,n){var r=null;if(s.g==n){oi(s),bo(s),s.g=null;var i=2}else{if(!vo(s.i,n))return;r=n.D,uc(s.i,n),i=1}if(s.I=n.N,0!=s.G)if(n.i)if(1==i){r=n.s?n.s.length:0,n=Date.now()-n.F;var o=s.C;Ze(i=zs(),new Gu(i,r,n,o)),ii(s)}else Ic(s);else if(3==(o=n.o)||0==o&&0<s.I||!(1==i&&function(s,n){return!(ac(s.i)>=s.i.j-(s.m?1:0)||(s.m?(s.l=n.D.concat(s.l),0):1==s.G||2==s.G||s.C>=(s.Xa?0:s.Ya)||(s.m=Wr(K(s.Ha,s,n),Sc(s,s.C)),s.C++,0)))}(s,n)||2==i&&xo(s)))switch(r&&0<r.length&&(n=s.i,n.i=n.i.concat(r)),o){case 1:_n(s,5);break;case 4:_n(s,10);break;case 3:_n(s,6);break;default:_n(s,2)}}function Sc(s,n){let r=s.Pa+Math.floor(Math.random()*s.$a);return s.j||(r*=2),r*n}function _n(s,n){if(s.h.info("Error code "+n),2==n){var r=null;s.j&&(r=null);var i=K(s.jb,s);r||(r=new wn("//www.google.com/images/cleardot.gif"),q.location&&"http"==q.location.protocol||Ys(r,"https"),ei(r)),function(s,n){const r=new $s;if(q.Image){const i=new Image;i.onload=fe(ti,r,i,"TestLoadImage: loaded",!0,n),i.onerror=fe(ti,r,i,"TestLoadImage: error",!1,n),i.onabort=fe(ti,r,i,"TestLoadImage: abort",!1,n),i.ontimeout=fe(ti,r,i,"TestLoadImage: timeout",!1,n),q.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=s}else n(!1)}(r.toString(),i)}else ut(2);s.G=0,s.j&&s.j.va(n),xc(s),vc(s)}function xc(s){s.G=0,s.I=-1,s.j&&((0!=cc(s.i).length||0!=s.l.length)&&(s.i.i.length=0,Fr(s.l),s.l.length=0),s.j.ua())}function bc(s,n,r){let i=function(s){return s instanceof wn?qt(s):new wn(s,void 0)}(r);if(""!=i.i)n&&Js(i,n+"."+i.i),Xs(i,i.m);else{const o=q.location;i=function(s,n,r,i){var o=new wn(null,void 0);return s&&Ys(o,s),n&&Js(o,n),r&&Xs(o,r),i&&(o.l=i),o}(o.protocol,n?n+"."+o.hostname:o.hostname,+o.port,r)}return s.aa&&Vr(s.aa,function(o,a){ye(i,a,o)}),r=s.sa,(n=s.D)&&r&&ye(i,n,r),ye(i,"VER",s.ma),is(s,i),i}function Ac(s,n,r){if(n&&!s.H)throw Error("Can't create secondary domain capable XhrIo object.");return(n=new Ne(r&&s.Ba&&!s.qa?new ts({ib:!0}):s.qa)).L=s.H,n}function Nc(){}function ai(){if(Ot&&!(10<=Number(Ji)))throw Error("Environmental error: no available transport.")}function yt(s,n){Be.call(this),this.g=new yc(n),this.l=s,this.h=n&&n.messageUrlParams||null,s=n&&n.messageHeaders||null,n&&n.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.s=s,s=n&&n.initMessageHeaders||null,n&&n.messageContentType&&(s?s["X-WebChannel-Content-Type"]=n.messageContentType:s={"X-WebChannel-Content-Type":n.messageContentType}),n&&n.ya&&(s?s["X-WebChannel-Client-Profile"]=n.ya:s={"X-WebChannel-Client-Profile":n.ya}),this.g.P=s,(s=n&&n.httpHeadersOverwriteParam)&&!Vn(s)&&(this.g.o=s),this.A=n&&n.supportsCrossDomainXhr||!1,this.v=n&&n.sendRawJson||!1,(n=n&&n.httpSessionIdParam)&&!Vn(n)&&(this.g.D=n,null!==(s=this.h)&&n in s&&n in(s=this.h)&&delete s[n]),this.j=new er(this)}function Cc(s){co.call(this);var n=s.__sm__;if(n){e:{for(const r in n){s=r;break e}s=void 0}(this.i=s)&&(s=this.i,n=null!==n&&s in n?n[s]:void 0),this.data=n}else this.data=s}function Dc(){lo.call(this),this.status=1}function er(s){this.g=s}(R=Ne.prototype).ea=function(s,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+s);n=n?n.toUpperCase():"GET",this.H=s,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ho.g(),this.C=function(s){return s.h||(s.h=s.i())}(this.u?this.u:ho),this.g.onreadystatechange=K(this.Fa,this);try{this.F=!0,this.g.open(n,String(s),!0),this.F=!1}catch(a){return void dc(this,a)}s=r||"";const o=new Jn(this.headers);i&&po(i,function(a,u){o.set(u,a)}),i=function(s){e:{var n=wf;const r=s.length,i="string"==typeof s?s.split(""):s;for(let o=0;o<r;o++)if(o in i&&n.call(void 0,i[o],o,s)){n=o;break e}n=-1}return 0>n?null:"string"==typeof s?s.charAt(n):s[n]}(o.T()),r=q.FormData&&s instanceof q.FormData,!(0<=Us(yf,n))||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(a,u){this.g.setRequestHeader(u,a)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{mc(this),0<this.B&&((this.K=function(s){return Ot&&Gr()&&"number"==typeof s.timeout&&void 0!==s.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=K(this.pa,this)):this.A=ao(this.pa,this.B,this)),this.v=!0,this.g.send(s),this.v=!1}catch(a){dc(this,a)}},R.pa=function(){void 0!==mt&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ze(this,"timeout"),this.abort(8))},R.abort=function(s){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=s||7,Ze(this,"complete"),Ze(this,"abort"),ri(this))},R.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ri(this,!0)),Ne.Z.M.call(this)},R.Fa=function(){this.s||(this.F||this.v||this.l?gc(this):this.cb())},R.cb=function(){gc(this)},R.ba=function(){try{return 2<jt(this)?this.g.status:-1}catch(s){return-1}},R.ga=function(){try{return this.g?this.g.responseText:""}catch(s){return""}},R.Qa=function(s){if(this.g){var n=this.g.responseText;return s&&0==n.indexOf(s)&&(n=n.substring(s.length)),mf(n)}},R.Da=function(){return this.m},R.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(R=yc.prototype).ma=8,R.G=1,R.hb=function(s){try{this.h.info("Origin Trials invoked: "+s)}catch(n){}},R.Ha=function(s){if(this.m)if(this.m=null,1==this.G){if(!s){this.V=Math.floor(1e5*Math.random()),s=this.V++;const o=new Hr(this,this.h,s,void 0);let a=this.s;if(this.P&&(a?(a=jn(a),Ht(a,this.P)):a=this.P),null===this.o&&(o.H=a),this.ja)e:{for(var n=0,r=0;r<this.l.length;r++){var i=this.l[r];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(n+=i)){n=r;break e}if(4096===n||r===this.l.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=_c(this,o,n),ye(r=qt(this.F),"RID",s),ye(r,"CVER",22),this.D&&ye(r,"X-HTTP-Session-Id",this.D),is(this,r),this.o&&a&&Eo(r,this.o,a),wo(this.i,o),this.Ra&&ye(r,"TYPE","init"),this.ja?(ye(r,"$req",n),ye(r,"SID","null"),o.$=!0,go(o,r,null)):go(o,r,n),this.G=2}}else 3==this.G&&(s?wc(this,s):0==this.l.length||oc(this.i)||wc(this))},R.Ga=function(){if(this.u=null,Ec(this),this.$&&!(this.L||null==this.g||0>=this.O)){var s=2*this.O;this.h.info("BP detection timer enabled: "+s),this.B=Wr(K(this.bb,this),s)}},R.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ut(10),si(this),Ec(this))},R.ab=function(){null!=this.v&&(this.v=null,si(this),xo(this),ut(19))},R.jb=function(s){s?(this.h.info("Successfully pinged google.com"),ut(2)):(this.h.info("Failed to ping google.com"),ut(1))},(R=Nc.prototype).xa=function(){},R.wa=function(){},R.va=function(){},R.ua=function(){},R.Oa=function(){},ai.prototype.g=function(s,n){return new yt(s,n)},ie(yt,Be),yt.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var s=this.g,n=this.l,r=this.h||void 0;s.Wa&&(s.h.info("Origin Trials enabled."),ro(K(s.hb,s,n))),ut(0),s.W=n,s.aa=r||{},s.N=s.X,s.F=bc(s,null,s.W),ii(s)},yt.prototype.close=function(){To(this.g)},yt.prototype.u=function(s){if("string"==typeof s){var n={};n.__data__=s,So(this.g,n)}else this.v?((n={}).__data__=no(s),So(this.g,n)):So(this.g,s)},yt.prototype.M=function(){this.g.j=null,delete this.j,To(this.g),delete this.g,yt.Z.M.call(this)},ie(Cc,co),ie(Dc,lo),ie(er,Nc),er.prototype.xa=function(){Ze(this.g,"a")},er.prototype.wa=function(s){Ze(this.g,new Cc(s))},er.prototype.va=function(s){Ze(this.g,new Dc(s))},er.prototype.ua=function(){Ze(this.g,"b")},ai.prototype.createWebChannel=ai.prototype.g,yt.prototype.send=yt.prototype.u,yt.prototype.open=yt.prototype.m,yt.prototype.close=yt.prototype.close,Ws.NO_ERROR=0,Ws.TIMEOUT=8,Ws.HTTP_ERROR=6,$u.COMPLETE="complete",Wu.EventType=Zr,Zr.OPEN="a",Zr.CLOSE="b",Zr.ERROR="c",Zr.MESSAGE="d",Be.prototype.listen=Be.prototype.N,Ne.prototype.listenOnce=Ne.prototype.O,Ne.prototype.getLastError=Ne.prototype.La,Ne.prototype.getLastErrorCode=Ne.prototype.Da,Ne.prototype.getStatus=Ne.prototype.ba,Ne.prototype.getResponseJson=Ne.prototype.Qa,Ne.prototype.getResponseText=Ne.prototype.ga,Ne.prototype.send=Ne.prototype.ea;var Ef=ze.createWebChannelTransport=function(){return new ai},Tf=ze.getStatEventTarget=function(){return zs()},Ao=ze.ErrorCode=Ws,Sf=ze.EventType=$u,xf=ze.Event=pn,kc=ze.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},bf=ze.FetchXmlHttpFactory=ts,ui=ze.WebChannel=Wu,Af=ze.XhrIo=Ne;class He{constructor(n){this.uid=n}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(n){return n.uid===this.uid}}He.UNAUTHENTICATED=new He(null),He.GOOGLE_CREDENTIALS=new He("google-credentials-uid"),He.FIRST_PARTY=new He("first-party-uid"),He.MOCK_USER=new He("mock-user");let tr="9.1.0";const Jt=new tt.Yd("@firebase/firestore");function No(){return Jt.logLevel}function N(s,...n){if(Jt.logLevel<=tt.in.DEBUG){const r=n.map(Co);Jt.debug(`Firestore (${tr}): ${s}`,...r)}}function Ce(s,...n){if(Jt.logLevel<=tt.in.ERROR){const r=n.map(Co);Jt.error(`Firestore (${tr}): ${s}`,...r)}}function os(s,...n){if(Jt.logLevel<=tt.in.WARN){const r=n.map(Co);Jt.warn(`Firestore (${tr}): ${s}`,...r)}}function Co(s){if("string"==typeof s)return s;try{return JSON.stringify(s)}catch(r){return s}}function B(s="Unexpected state"){const n=`FIRESTORE (${tr}) INTERNAL ASSERTION FAILED: `+s;throw Ce(n),new Error(n)}function z(s,n){s||B()}function k(s,n){return s}const w={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class x extends Error{constructor(n,r){super(r),this.code=n,this.message=r,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class qe{constructor(){this.promise=new Promise((n,r)=>{this.resolve=n,this.reject=r})}}class Rc{constructor(n,r){this.user=r,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${n}`}}class Df{getToken(){return Promise.resolve(null)}invalidateToken(){}start(n,r){n.enqueueRetryable(()=>r(He.UNAUTHENTICATED))}shutdown(){}}class kf{constructor(n){this.token=n,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(n,r){this.changeListener=r,n.enqueueRetryable(()=>r(this.token.user))}shutdown(){this.changeListener=null}}class Rf{constructor(n){this.t=n,this.currentUser=He.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(n,r){var i=this;let o=this.i;const a=h=>this.i!==o?(o=this.i,r(h)):Promise.resolve();let u=new qe;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new qe,n.enqueueRetryable(()=>a(this.currentUser))};const c=()=>{const h=u;n.enqueueRetryable((0,I.Z)(function*(){yield h.promise,yield a(i.currentUser)}))},l=h=>{N("FirebaseCredentialsProvider","Auth detected"),this.auth=h,this.auth.addAuthTokenListener(this.o),c()};this.t.onInit(h=>l(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?l(h):(N("FirebaseCredentialsProvider","Auth not yet detected"),u.resolve(),u=new qe)}},0),c()}getToken(){const n=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(i=>this.i!==n?(N("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(z("string"==typeof i.accessToken),new Rc(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const n=this.auth&&this.auth.getUid();return z(null===n||"string"==typeof n),new He(n)}}class Of{constructor(n,r,i){this.h=n,this.l=r,this.m=i,this.type="FirstParty",this.user=He.FIRST_PARTY}get authHeaders(){const n={"X-Goog-AuthUser":this.l},r=this.h.auth.getAuthHeaderValueForFirstParty([]);return r&&(n.Authorization=r),this.m&&(n["X-Goog-Iam-Authorization-Token"]=this.m),n}}class Lf{constructor(n,r,i){this.h=n,this.l=r,this.m=i}getToken(){return Promise.resolve(new Of(this.h,this.l,this.m))}start(n,r){n.enqueueRetryable(()=>r(He.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class vt{constructor(n,r){this.previousValue=n,r&&(r.sequenceNumberHandler=i=>this.g(i),this.p=i=>r.writeSequenceNumber(i))}g(n){return this.previousValue=Math.max(n,this.previousValue),this.previousValue}next(){const n=++this.previousValue;return this.p&&this.p(n),n}}function Pf(s){const n="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(s);if(n&&"function"==typeof n.getRandomValues)n.getRandomValues(r);else for(let i=0;i<s;i++)r[i]=Math.floor(256*Math.random());return r}vt.T=-1;class Oc{static I(){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/n.length)*n.length;let i="";for(;i.length<20;){const o=Pf(40);for(let a=0;a<o.length;++a)i.length<20&&o[a]<r&&(i+=n.charAt(o[a]%n.length))}return i}}function te(s,n){return s<n?-1:s>n?1:0}function nr(s,n,r){return s.length===n.length&&s.every((i,o)=>r(i,n[o]))}function Lc(s){return s+"\0"}class je{constructor(n,r){if(this.seconds=n,this.nanoseconds=r,r<0)throw new x(w.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new x(w.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(n<-62135596800)throw new x(w.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n);if(n>=253402300800)throw new x(w.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n)}static now(){return je.fromMillis(Date.now())}static fromDate(n){return je.fromMillis(n.getTime())}static fromMillis(n){const r=Math.floor(n/1e3),i=Math.floor(1e6*(n-1e3*r));return new je(r,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(n){return this.seconds===n.seconds?te(this.nanoseconds,n.nanoseconds):te(this.seconds,n.seconds)}isEqual(n){return n.seconds===this.seconds&&n.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Q{constructor(n){this.timestamp=n}static fromTimestamp(n){return new Q(n)}static min(){return new Q(new je(0,0))}compareTo(n){return this.timestamp._compareTo(n.timestamp)}isEqual(n){return this.timestamp.isEqual(n.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Pc(s){let n=0;for(const r in s)Object.prototype.hasOwnProperty.call(s,r)&&n++;return n}function In(s,n){for(const r in s)Object.prototype.hasOwnProperty.call(s,r)&&n(r,s[r])}function Mc(s){for(const n in s)if(Object.prototype.hasOwnProperty.call(s,n))return!1;return!0}class as{constructor(n,r,i){void 0===r?r=0:r>n.length&&B(),void 0===i?i=n.length-r:i>n.length-r&&B(),this.segments=n,this.offset=r,this.len=i}get length(){return this.len}isEqual(n){return 0===as.comparator(this,n)}child(n){const r=this.segments.slice(this.offset,this.limit());return n instanceof as?n.forEach(i=>{r.push(i)}):r.push(n),this.construct(r)}limit(){return this.offset+this.length}popFirst(n){return this.construct(this.segments,this.offset+(n=void 0===n?1:n),this.length-n)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(n){return this.segments[this.offset+n]}isEmpty(){return 0===this.length}isPrefixOf(n){if(n.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==n.get(r))return!1;return!0}isImmediateParentOf(n){if(this.length+1!==n.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==n.get(r))return!1;return!0}forEach(n){for(let r=this.offset,i=this.limit();r<i;r++)n(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(n,r){const i=Math.min(n.length,r.length);for(let o=0;o<i;o++){const a=n.get(o),u=r.get(o);if(a<u)return-1;if(a>u)return 1}return n.length<r.length?-1:n.length>r.length?1:0}}class ue extends as{construct(n,r,i){return new ue(n,r,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...n){const r=[];for(const i of n){if(i.indexOf("//")>=0)throw new x(w.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);r.push(...i.split("/").filter(o=>o.length>0))}return new ue(r)}static emptyPath(){return new ue([])}}const Mf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Qe extends as{construct(n,r,i){return new Qe(n,r,i)}static isValidIdentifier(n){return Mf.test(n)}canonicalString(){return this.toArray().map(n=>(n=n.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Qe.isValidIdentifier(n)||(n="`"+n+"`"),n)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Qe(["__name__"])}static fromServerFormat(n){const r=[];let i="",o=0;const a=()=>{if(0===i.length)throw new x(w.INVALID_ARGUMENT,`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(i),i=""};let u=!1;for(;o<n.length;){const c=n[o];if("\\"===c){if(o+1===n.length)throw new x(w.INVALID_ARGUMENT,"Path has trailing escape character: "+n);const l=n[o+1];if("\\"!==l&&"."!==l&&"`"!==l)throw new x(w.INVALID_ARGUMENT,"Path has invalid escape sequence: "+n);i+=l,o+=2}else"`"===c?(u=!u,o++):"."!==c||u?(i+=c,o++):(a(),o++)}if(a(),u)throw new x(w.INVALID_ARGUMENT,"Unterminated ` in path: "+n);return new Qe(r)}static emptyPath(){return new Qe([])}}class rr{constructor(n){this.fields=n,n.sort(Qe.comparator)}covers(n){for(const r of this.fields)if(r.isPrefixOf(n))return!0;return!1}isEqual(n){return nr(this.fields,n.fields,(r,i)=>r.isEqual(i))}}class Ke{constructor(n){this.binaryString=n}static fromBase64String(n){const r=atob(n);return new Ke(r)}static fromUint8Array(n){const r=function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o}(n);return new Ke(r)}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(n){return te(this.binaryString,n.binaryString)}isEqual(n){return this.binaryString===n.binaryString}}Ke.EMPTY_BYTE_STRING=new Ke("");const Uf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Xt(s){if(z(!!s),"string"==typeof s){let n=0;const r=Uf.exec(s);if(z(!!r),r[1]){let o=r[1];o=(o+"000000000").substr(0,9),n=Number(o)}const i=new Date(s);return{seconds:Math.floor(i.getTime()/1e3),nanos:n}}return{seconds:De(s.seconds),nanos:De(s.nanos)}}function De(s){return"number"==typeof s?s:"string"==typeof s?Number(s):0}function sr(s){return"string"==typeof s?Ke.fromBase64String(s):Ke.fromUint8Array(s)}function Do(s){var n,r;return"server_timestamp"===(null===(r=((null===(n=null==s?void 0:s.mapValue)||void 0===n?void 0:n.fields)||{}).__type__)||void 0===r?void 0:r.stringValue)}function Fc(s){const n=s.mapValue.fields.__previous_value__;return Do(n)?Fc(n):n}function us(s){const n=Xt(s.mapValue.fields.__local_write_time__.timestampValue);return new je(n.seconds,n.nanos)}function En(s){return null==s}function ci(s){return 0===s&&1/s==-1/0}function Uc(s){return"number"==typeof s&&Number.isInteger(s)&&!ci(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}class U{constructor(n){this.path=n}static fromPath(n){return new U(ue.fromString(n))}static fromName(n){return new U(ue.fromString(n).popFirst(5))}hasCollectionId(n){return this.path.length>=2&&this.path.get(this.path.length-2)===n}isEqual(n){return null!==n&&0===ue.comparator(this.path,n.path)}toString(){return this.path.toString()}static comparator(n,r){return ue.comparator(n.path,r.path)}static isDocumentKey(n){return n.length%2==0}static fromSegments(n){return new U(new ue(n.slice()))}}function Tn(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?Do(s)?4:10:B()}function Pt(s,n){const r=Tn(s);if(r!==Tn(n))return!1;switch(r){case 0:return!0;case 1:return s.booleanValue===n.booleanValue;case 4:return us(s).isEqual(us(n));case 3:return function(i,o){if("string"==typeof i.timestampValue&&"string"==typeof o.timestampValue&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const a=Xt(i.timestampValue),u=Xt(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(s,n);case 5:return s.stringValue===n.stringValue;case 6:return o=n,sr(s.bytesValue).isEqual(sr(o.bytesValue));case 7:return s.referenceValue===n.referenceValue;case 8:return function(i,o){return De(i.geoPointValue.latitude)===De(o.geoPointValue.latitude)&&De(i.geoPointValue.longitude)===De(o.geoPointValue.longitude)}(s,n);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return De(i.integerValue)===De(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const a=De(i.doubleValue),u=De(o.doubleValue);return a===u?ci(a)===ci(u):isNaN(a)&&isNaN(u)}return!1}(s,n);case 9:return nr(s.arrayValue.values||[],n.arrayValue.values||[],Pt);case 10:return function(i,o){const a=i.mapValue.fields||{},u=o.mapValue.fields||{};if(Pc(a)!==Pc(u))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(void 0===u[c]||!Pt(a[c],u[c])))return!1;return!0}(s,n);default:return B()}var o}function cs(s,n){return void 0!==(s.values||[]).find(r=>Pt(r,n))}function ir(s,n){const r=Tn(s),i=Tn(n);if(r!==i)return te(r,i);switch(r){case 0:return 0;case 1:return te(s.booleanValue,n.booleanValue);case 2:return function(o,a){const u=De(o.integerValue||o.doubleValue),c=De(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(s,n);case 3:return Vc(s.timestampValue,n.timestampValue);case 4:return Vc(us(s),us(n));case 5:return te(s.stringValue,n.stringValue);case 6:return function(o,a){const u=sr(o),c=sr(a);return u.compareTo(c)}(s.bytesValue,n.bytesValue);case 7:return function(o,a){const u=o.split("/"),c=a.split("/");for(let l=0;l<u.length&&l<c.length;l++){const h=te(u[l],c[l]);if(0!==h)return h}return te(u.length,c.length)}(s.referenceValue,n.referenceValue);case 8:return function(o,a){const u=te(De(o.latitude),De(a.latitude));return 0!==u?u:te(De(o.longitude),De(a.longitude))}(s.geoPointValue,n.geoPointValue);case 9:return function(o,a){const u=o.values||[],c=a.values||[];for(let l=0;l<u.length&&l<c.length;++l){const h=ir(u[l],c[l]);if(h)return h}return te(u.length,c.length)}(s.arrayValue,n.arrayValue);case 10:return function(o,a){const u=o.fields||{},c=Object.keys(u),l=a.fields||{},h=Object.keys(l);c.sort(),h.sort();for(let d=0;d<c.length&&d<h.length;++d){const g=te(c[d],h[d]);if(0!==g)return g;const _=ir(u[c[d]],l[h[d]]);if(0!==_)return _}return te(c.length,h.length)}(s.mapValue,n.mapValue);default:throw B()}}function Vc(s,n){if("string"==typeof s&&"string"==typeof n&&s.length===n.length)return te(s,n);const r=Xt(s),i=Xt(n),o=te(r.seconds,i.seconds);return 0!==o?o:te(r.nanos,i.nanos)}function ko(s){return Ro(s)}function Ro(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?function(i){const o=Xt(i);return`time(${o.seconds},${o.nanos})`}(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?sr(s.bytesValue).toBase64():"referenceValue"in s?U.fromName(s.referenceValue).toString():"geoPointValue"in s?`geo(${(n=s.geoPointValue).latitude},${n.longitude})`:"arrayValue"in s?function(i){let o="[",a=!0;for(const u of i.values||[])a?a=!1:o+=",",o+=Ro(u);return o+"]"}(s.arrayValue):"mapValue"in s?function(i){const o=Object.keys(i.fields||{}).sort();let a="{",u=!0;for(const c of o)u?u=!1:a+=",",a+=`${c}:${Ro(i.fields[c])}`;return a+"}"}(s.mapValue):B();var n}function li(s,n){return{referenceValue:`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`}}function Oo(s){return!!s&&"integerValue"in s}function Lo(s){return!!s&&"arrayValue"in s}function Bc(s){return!!s&&"nullValue"in s}function qc(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function hi(s){return!!s&&"mapValue"in s}function ls(s){if(s.geoPointValue)return{geoPointValue:Object.assign({},s.geoPointValue)};if(s.timestampValue&&"object"==typeof s.timestampValue)return{timestampValue:Object.assign({},s.timestampValue)};if(s.mapValue){const n={mapValue:{fields:{}}};return In(s.mapValue.fields,(r,i)=>n.mapValue.fields[r]=ls(i)),n}if(s.arrayValue){const n={arrayValue:{values:[]}};for(let r=0;r<(s.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=ls(s.arrayValue.values[r]);return n}return Object.assign({},s)}class st{constructor(n){this.value=n}static empty(){return new st({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let r=this.value;for(let i=0;i<n.length-1;++i)if(r=(r.mapValue.fields||{})[n.get(i)],!hi(r))return null;return r=(r.mapValue.fields||{})[n.lastSegment()],r||null}}set(n,r){this.getFieldsMap(n.popLast())[n.lastSegment()]=ls(r)}setAll(n){let r=Qe.emptyPath(),i={},o=[];n.forEach((u,c)=>{if(!r.isImmediateParentOf(c)){const l=this.getFieldsMap(r);this.applyChanges(l,i,o),i={},o=[],r=c.popLast()}u?i[c.lastSegment()]=ls(u):o.push(c.lastSegment())});const a=this.getFieldsMap(r);this.applyChanges(a,i,o)}delete(n){const r=this.field(n.popLast());hi(r)&&r.mapValue.fields&&delete r.mapValue.fields[n.lastSegment()]}isEqual(n){return Pt(this.value,n.value)}getFieldsMap(n){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let i=0;i<n.length;++i){let o=r.mapValue.fields[n.get(i)];hi(o)&&o.mapValue.fields||(o={mapValue:{fields:{}}},r.mapValue.fields[n.get(i)]=o),r=o}return r.mapValue.fields}applyChanges(n,r,i){In(r,(o,a)=>n[o]=a);for(const o of i)delete n[o]}clone(){return new st(ls(this.value))}}function jc(s){const n=[];return In(s.fields,(r,i)=>{const o=new Qe([r]);if(hi(i)){const a=jc(i.mapValue).fields;if(0===a.length)n.push(o);else for(const u of a)n.push(o.child(u))}else n.push(o)}),new rr(n)}class ve{constructor(n,r,i,o,a){this.key=n,this.documentType=r,this.version=i,this.data=o,this.documentState=a}static newInvalidDocument(n){return new ve(n,0,Q.min(),st.empty(),0)}static newFoundDocument(n,r,i){return new ve(n,1,r,i,0)}static newNoDocument(n,r){return new ve(n,2,r,st.empty(),0)}static newUnknownDocument(n,r){return new ve(n,3,r,st.empty(),2)}convertToFoundDocument(n,r){return this.version=n,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(n){return this.version=n,this.documentType=2,this.data=st.empty(),this.documentState=0,this}convertToUnknownDocument(n){return this.version=n,this.documentType=3,this.data=st.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(n){return n instanceof ve&&this.key.isEqual(n.key)&&this.version.isEqual(n.version)&&this.documentType===n.documentType&&this.documentState===n.documentState&&this.data.isEqual(n.data)}clone(){return new ve(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Vf{constructor(n,r=null,i=[],o=[],a=null,u=null,c=null){this.path=n,this.collectionGroup=r,this.orderBy=i,this.filters=o,this.limit=a,this.startAt=u,this.endAt=c,this.A=null}}function Kc(s,n=null,r=[],i=[],o=null,a=null,u=null){return new Vf(s,n,r,i,o,a,u)}function hs(s){const n=k(s);if(null===n.A){let r=n.path.canonicalString();null!==n.collectionGroup&&(r+="|cg:"+n.collectionGroup),r+="|f:",r+=n.filters.map(i=>function(s){return s.field.canonicalString()+s.op.toString()+ko(s.value)}(i)).join(","),r+="|ob:",r+=n.orderBy.map(i=>{return(o=i).field.canonicalString()+o.dir;var o}).join(","),En(n.limit)||(r+="|l:",r+=n.limit),n.startAt&&(r+="|lb:",r+=gi(n.startAt)),n.endAt&&(r+="|ub:",r+=gi(n.endAt)),n.A=r}return n.A}function di(s,n){if(s.limit!==n.limit||s.orderBy.length!==n.orderBy.length)return!1;for(let o=0;o<s.orderBy.length;o++)if(!Hf(s.orderBy[o],n.orderBy[o]))return!1;if(s.filters.length!==n.filters.length)return!1;for(let o=0;o<s.filters.length;o++)if((r=s.filters[o]).op!==(i=n.filters[o]).op||!r.field.isEqual(i.field)||!Pt(r.value,i.value))return!1;var r,i;return s.collectionGroup===n.collectionGroup&&!!s.path.isEqual(n.path)&&!!zc(s.startAt,n.startAt)&&zc(s.endAt,n.endAt)}function fi(s){return U.isDocumentKey(s.path)&&null===s.collectionGroup&&0===s.filters.length}class ct extends class{}{constructor(n,r,i){super(),this.field=n,this.op=r,this.value=i}static create(n,r,i){return n.isKeyField()?"in"===r||"not-in"===r?this.R(n,r,i):new jf(n,r,i):"array-contains"===r?new $f(n,i):"in"===r?new zf(n,i):"not-in"===r?new Wf(n,i):"array-contains-any"===r?new Zf(n,i):new ct(n,r,i)}static R(n,r,i){return"in"===r?new Kf(n,i):new Gf(n,i)}matches(n){const r=n.data.field(this.field);return"!="===this.op?null!==r&&this.P(ir(r,this.value)):null!==r&&Tn(this.value)===Tn(r)&&this.P(ir(r,this.value))}P(n){switch(this.op){case"<":return n<0;case"<=":return n<=0;case"==":return 0===n;case"!=":return 0!==n;case">":return n>0;case">=":return n>=0;default:return B()}}v(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class jf extends ct{constructor(n,r,i){super(n,r,i),this.key=U.fromName(i.referenceValue)}matches(n){const r=U.comparator(n.key,this.key);return this.P(r)}}class Kf extends ct{constructor(n,r){super(n,"in",r),this.keys=Gc(0,r)}matches(n){return this.keys.some(r=>r.isEqual(n.key))}}class Gf extends ct{constructor(n,r){super(n,"not-in",r),this.keys=Gc(0,r)}matches(n){return!this.keys.some(r=>r.isEqual(n.key))}}function Gc(s,n){var r;return((null===(r=n.arrayValue)||void 0===r?void 0:r.values)||[]).map(i=>U.fromName(i.referenceValue))}class $f extends ct{constructor(n,r){super(n,"array-contains",r)}matches(n){const r=n.data.field(this.field);return Lo(r)&&cs(r.arrayValue,this.value)}}class zf extends ct{constructor(n,r){super(n,"in",r)}matches(n){const r=n.data.field(this.field);return null!==r&&cs(this.value.arrayValue,r)}}class Wf extends ct{constructor(n,r){super(n,"not-in",r)}matches(n){if(cs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const r=n.data.field(this.field);return null!==r&&!cs(this.value.arrayValue,r)}}class Zf extends ct{constructor(n,r){super(n,"array-contains-any",r)}matches(n){const r=n.data.field(this.field);return!(!Lo(r)||!r.arrayValue.values)&&r.arrayValue.values.some(i=>cs(this.value.arrayValue,i))}}class ds{constructor(n,r){this.position=n,this.before=r}}function gi(s){return`${s.before?"b":"a"}:${s.position.map(n=>ko(n)).join(",")}`}class or{constructor(n,r="asc"){this.field=n,this.dir=r}}function Hf(s,n){return s.dir===n.dir&&s.field.isEqual(n.field)}function $c(s,n,r){let i=0;for(let o=0;o<s.position.length;o++){const a=n[o],u=s.position[o];if(i=a.field.isKeyField()?U.comparator(U.fromName(u.referenceValue),r.key):ir(u,r.data.field(a.field)),"desc"===a.dir&&(i*=-1),0!==i)break}return s.before?i<=0:i<0}function zc(s,n){if(null===s)return null===n;if(null===n||s.before!==n.before||s.position.length!==n.position.length)return!1;for(let r=0;r<s.position.length;r++)if(!Pt(s.position[r],n.position[r]))return!1;return!0}class Kt{constructor(n,r=null,i=[],o=[],a=null,u="F",c=null,l=null){this.path=n,this.collectionGroup=r,this.explicitOrderBy=i,this.filters=o,this.limit=a,this.limitType=u,this.startAt=c,this.endAt=l,this.V=null,this.S=null}}function Wc(s,n,r,i,o,a,u,c){return new Kt(s,n,r,i,o,a,u,c)}function ar(s){return new Kt(s)}function mi(s){return!En(s.limit)&&"F"===s.limitType}function pi(s){return!En(s.limit)&&"L"===s.limitType}function Po(s){return s.explicitOrderBy.length>0?s.explicitOrderBy[0].field:null}function Mo(s){for(const n of s.filters)if(n.v())return n.field;return null}function Fo(s){return null!==s.collectionGroup}function ur(s){const n=k(s);if(null===n.V){n.V=[];const r=Mo(n),i=Po(n);if(null!==r&&null===i)r.isKeyField()||n.V.push(new or(r)),n.V.push(new or(Qe.keyField(),"asc"));else{let o=!1;for(const a of n.explicitOrderBy)n.V.push(a),a.field.isKeyField()&&(o=!0);if(!o){const a=n.explicitOrderBy.length>0?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.V.push(new or(Qe.keyField(),a))}}}return n.V}function Tt(s){const n=k(s);if(!n.S)if("F"===n.limitType)n.S=Kc(n.path,n.collectionGroup,ur(n),n.filters,n.limit,n.startAt,n.endAt);else{const r=[];for(const a of ur(n))r.push(new or(a.field,"desc"===a.dir?"asc":"desc"));const i=n.endAt?new ds(n.endAt.position,!n.endAt.before):null,o=n.startAt?new ds(n.startAt.position,!n.startAt.before):null;n.S=Kc(n.path,n.collectionGroup,r,n.filters,n.limit,i,o)}return n.S}function Zc(s,n,r){return new Kt(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),n,r,s.startAt,s.endAt)}function fs(s,n){return di(Tt(s),Tt(n))&&s.limitType===n.limitType}function Hc(s){return`${hs(Tt(s))}|lt:${s.limitType}`}function Uo(s){return`Query(target=${function(s){let n=s.path.canonicalString();return null!==s.collectionGroup&&(n+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(n+=`, filters: [${s.filters.map(r=>{return`${(i=r).field.canonicalString()} ${i.op} ${ko(i.value)}`;var i}).join(", ")}]`),En(s.limit)||(n+=", limit: "+s.limit),s.orderBy.length>0&&(n+=`, orderBy: [${s.orderBy.map(r=>{return`${(i=r).field.canonicalString()} (${i.dir})`;var i}).join(", ")}]`),s.startAt&&(n+=", startAt: "+gi(s.startAt)),s.endAt&&(n+=", endAt: "+gi(s.endAt)),`Target(${n})`}(Tt(s))}; limitType=${s.limitType})`}function gs(s,n){return n.isFoundDocument()&&function(r,i){const o=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):U.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(s,n)&&function(r,i){for(const o of r.explicitOrderBy)if(!o.field.isKeyField()&&null===i.data.field(o.field))return!1;return!0}(s,n)&&function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0}(s,n)&&(i=n,!((r=s).startAt&&!$c(r.startAt,ur(r),i)||r.endAt&&$c(r.endAt,ur(r),i)));var r,i}function Qc(s){return(n,r)=>{let i=!1;for(const o of ur(s)){const a=Qf(o,n,r);if(0!==a)return a;i=i||o.field.isKeyField()}return 0}}function Qf(s,n,r){const i=s.field.isKeyField()?U.comparator(n.key,r.key):function(o,a,u){const c=a.data.field(o),l=u.data.field(o);return null!==c&&null!==l?ir(c,l):B()}(s.field,n,r);switch(s.dir){case"asc":return i;case"desc":return-1*i;default:return B()}}function Yc(s,n){if(s.D){if(isNaN(n))return{doubleValue:"NaN"};if(n===1/0)return{doubleValue:"Infinity"};if(n===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ci(n)?"-0":n}}function Jc(s){return{integerValue:""+s}}function Xc(s,n){return Uc(n)?Jc(n):Yc(s,n)}class yi{constructor(){this._=void 0}}function Yf(s,n,r){return s instanceof cr?function(i,o){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&(a.fields.__previous_value__=o),{mapValue:a}}(r,n):s instanceof Sn?tl(s,n):s instanceof xn?nl(s,n):function(i,o){const a=el(i,o),u=rl(a)+rl(i.C);return Oo(a)&&Oo(i.C)?Jc(u):Yc(i.N,u)}(s,n)}function Jf(s,n,r){return s instanceof Sn?tl(s,n):s instanceof xn?nl(s,n):r}function el(s,n){return s instanceof lr?Oo(r=n)||(i=r)&&"doubleValue"in i?n:{integerValue:0}:null;var i,r}class cr extends yi{}class Sn extends yi{constructor(n){super(),this.elements=n}}function tl(s,n){const r=sl(n);for(const i of s.elements)r.some(o=>Pt(o,i))||r.push(i);return{arrayValue:{values:r}}}class xn extends yi{constructor(n){super(),this.elements=n}}function nl(s,n){let r=sl(n);for(const i of s.elements)r=r.filter(o=>!Pt(o,i));return{arrayValue:{values:r}}}class lr extends yi{constructor(n,r){super(),this.N=n,this.C=r}}function rl(s){return De(s.integerValue||s.doubleValue)}function sl(s){return Lo(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}class ms{constructor(n,r){this.field=n,this.transform=r}}class eg{constructor(n,r){this.version=n,this.transformResults=r}}class ke{constructor(n,r){this.updateTime=n,this.exists=r}static none(){return new ke}static exists(n){return new ke(void 0,n)}static updateTime(n){return new ke(n)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(n){return this.exists===n.exists&&(this.updateTime?!!n.updateTime&&this.updateTime.isEqual(n.updateTime):!n.updateTime)}}function vi(s,n){return void 0!==s.updateTime?n.isFoundDocument()&&n.version.isEqual(s.updateTime):void 0===s.exists||s.exists===n.isFoundDocument()}class wi{}function tg(s,n,r){s instanceof ps?function(i,o,a){const u=i.value.clone(),c=ul(i.fieldTransforms,o,a.transformResults);u.setAll(c),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(s,n,r):s instanceof en?function(i,o,a){if(!vi(i.precondition,o))return void o.convertToUnknownDocument(a.version);const u=ul(i.fieldTransforms,o,a.transformResults),c=o.data;c.setAll(al(i)),c.setAll(u),o.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(s,n,r):n.convertToNoDocument(r.version).setHasCommittedMutations()}function Vo(s,n,r){var o;s instanceof ps?function(i,o,a){if(!vi(i.precondition,o))return;const u=i.value.clone(),c=cl(i.fieldTransforms,a,o);u.setAll(c),o.convertToFoundDocument(ol(o),u).setHasLocalMutations()}(s,n,r):s instanceof en?function(i,o,a){if(!vi(i.precondition,o))return;const u=cl(i.fieldTransforms,a,o),c=o.data;c.setAll(al(i)),c.setAll(u),o.convertToFoundDocument(ol(o),c).setHasLocalMutations()}(s,n,r):vi(s.precondition,o=n)&&o.convertToNoDocument(Q.min())}function ng(s,n){let r=null;for(const i of s.fieldTransforms){const o=n.data.field(i.field),a=el(i.transform,o||null);null!=a&&(null==r&&(r=st.empty()),r.set(i.field,a))}return r||null}function il(s,n){return s.type===n.type&&!!s.key.isEqual(n.key)&&!!s.precondition.isEqual(n.precondition)&&(i=n.fieldTransforms,!!(void 0===(r=s.fieldTransforms)&&void 0===i||r&&i&&nr(r,i,(o,a)=>function(s,n){return s.field.isEqual(n.field)&&(i=n.transform,(r=s.transform)instanceof Sn&&i instanceof Sn||r instanceof xn&&i instanceof xn?nr(r.elements,i.elements,Pt):r instanceof lr&&i instanceof lr?Pt(r.C,i.C):r instanceof cr&&i instanceof cr);var r,i}(o,a))))&&(0===s.type?s.value.isEqual(n.value):1!==s.type||s.data.isEqual(n.data)&&s.fieldMask.isEqual(n.fieldMask));var r,i}function ol(s){return s.isFoundDocument()?s.version:Q.min()}class ps extends wi{constructor(n,r,i,o=[]){super(),this.key=n,this.value=r,this.precondition=i,this.fieldTransforms=o,this.type=0}}class en extends wi{constructor(n,r,i,o,a=[]){super(),this.key=n,this.data=r,this.fieldMask=i,this.precondition=o,this.fieldTransforms=a,this.type=1}}function al(s){const n=new Map;return s.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const i=s.data.field(r);n.set(r,i)}}),n}function ul(s,n,r){const i=new Map;z(s.length===r.length);for(let o=0;o<r.length;o++){const a=s[o],u=a.transform,c=n.data.field(a.field);i.set(a.field,Jf(u,c,r[o]))}return i}function cl(s,n,r){const i=new Map;for(const o of s){const a=o.transform,u=r.data.field(o.field);i.set(o.field,Yf(a,u,n))}return i}class ys extends wi{constructor(n,r){super(),this.key=n,this.precondition=r,this.type=2,this.fieldTransforms=[]}}class Bo extends wi{constructor(n,r){super(),this.key=n,this.precondition=r,this.type=3,this.fieldTransforms=[]}}class rg{constructor(n){this.count=n}}var Re,re;function ll(s){switch(s){case w.OK:return B();case w.CANCELLED:case w.UNKNOWN:case w.DEADLINE_EXCEEDED:case w.RESOURCE_EXHAUSTED:case w.INTERNAL:case w.UNAVAILABLE:case w.UNAUTHENTICATED:return!1;case w.INVALID_ARGUMENT:case w.NOT_FOUND:case w.ALREADY_EXISTS:case w.PERMISSION_DENIED:case w.FAILED_PRECONDITION:case w.ABORTED:case w.OUT_OF_RANGE:case w.UNIMPLEMENTED:case w.DATA_LOSS:return!0;default:return B()}}function hl(s){if(void 0===s)return Ce("GRPC error has no .code"),w.UNKNOWN;switch(s){case Re.OK:return w.OK;case Re.CANCELLED:return w.CANCELLED;case Re.UNKNOWN:return w.UNKNOWN;case Re.DEADLINE_EXCEEDED:return w.DEADLINE_EXCEEDED;case Re.RESOURCE_EXHAUSTED:return w.RESOURCE_EXHAUSTED;case Re.INTERNAL:return w.INTERNAL;case Re.UNAVAILABLE:return w.UNAVAILABLE;case Re.UNAUTHENTICATED:return w.UNAUTHENTICATED;case Re.INVALID_ARGUMENT:return w.INVALID_ARGUMENT;case Re.NOT_FOUND:return w.NOT_FOUND;case Re.ALREADY_EXISTS:return w.ALREADY_EXISTS;case Re.PERMISSION_DENIED:return w.PERMISSION_DENIED;case Re.FAILED_PRECONDITION:return w.FAILED_PRECONDITION;case Re.ABORTED:return w.ABORTED;case Re.OUT_OF_RANGE:return w.OUT_OF_RANGE;case Re.UNIMPLEMENTED:return w.UNIMPLEMENTED;case Re.DATA_LOSS:return w.DATA_LOSS;default:return B()}}(re=Re||(Re={}))[re.OK=0]="OK",re[re.CANCELLED=1]="CANCELLED",re[re.UNKNOWN=2]="UNKNOWN",re[re.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",re[re.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",re[re.NOT_FOUND=5]="NOT_FOUND",re[re.ALREADY_EXISTS=6]="ALREADY_EXISTS",re[re.PERMISSION_DENIED=7]="PERMISSION_DENIED",re[re.UNAUTHENTICATED=16]="UNAUTHENTICATED",re[re.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",re[re.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",re[re.ABORTED=10]="ABORTED",re[re.OUT_OF_RANGE=11]="OUT_OF_RANGE",re[re.UNIMPLEMENTED=12]="UNIMPLEMENTED",re[re.INTERNAL=13]="INTERNAL",re[re.UNAVAILABLE=14]="UNAVAILABLE",re[re.DATA_LOSS=15]="DATA_LOSS";class Pe{constructor(n,r){this.comparator=n,this.root=r||Ye.EMPTY}insert(n,r){return new Pe(this.comparator,this.root.insert(n,r,this.comparator).copy(null,null,Ye.BLACK,null,null))}remove(n){return new Pe(this.comparator,this.root.remove(n,this.comparator).copy(null,null,Ye.BLACK,null,null))}get(n){let r=this.root;for(;!r.isEmpty();){const i=this.comparator(n,r.key);if(0===i)return r.value;i<0?r=r.left:i>0&&(r=r.right)}return null}indexOf(n){let r=0,i=this.root;for(;!i.isEmpty();){const o=this.comparator(n,i.key);if(0===o)return r+i.left.size;o<0?i=i.left:(r+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(n){return this.root.inorderTraversal(n)}forEach(n){this.inorderTraversal((r,i)=>(n(r,i),!1))}toString(){const n=[];return this.inorderTraversal((r,i)=>(n.push(`${r}:${i}`),!1)),`{${n.join(", ")}}`}reverseTraversal(n){return this.root.reverseTraversal(n)}getIterator(){return new _i(this.root,null,this.comparator,!1)}getIteratorFrom(n){return new _i(this.root,n,this.comparator,!1)}getReverseIterator(){return new _i(this.root,null,this.comparator,!0)}getReverseIteratorFrom(n){return new _i(this.root,n,this.comparator,!0)}}class _i{constructor(n,r,i,o){this.isReverse=o,this.nodeStack=[];let a=1;for(;!n.isEmpty();)if(a=r?i(n.key,r):1,o&&(a*=-1),a<0)n=this.isReverse?n.left:n.right;else{if(0===a){this.nodeStack.push(n);break}this.nodeStack.push(n),n=this.isReverse?n.right:n.left}}getNext(){let n=this.nodeStack.pop();const r={key:n.key,value:n.value};if(this.isReverse)for(n=n.left;!n.isEmpty();)this.nodeStack.push(n),n=n.right;else for(n=n.right;!n.isEmpty();)this.nodeStack.push(n),n=n.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const n=this.nodeStack[this.nodeStack.length-1];return{key:n.key,value:n.value}}}class Ye{constructor(n,r,i,o,a){this.key=n,this.value=r,this.color=null!=i?i:Ye.RED,this.left=null!=o?o:Ye.EMPTY,this.right=null!=a?a:Ye.EMPTY,this.size=this.left.size+1+this.right.size}copy(n,r,i,o,a){return new Ye(null!=n?n:this.key,null!=r?r:this.value,null!=i?i:this.color,null!=o?o:this.left,null!=a?a:this.right)}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,r,i){let o=this;const a=i(n,o.key);return o=a<0?o.copy(null,null,null,o.left.insert(n,r,i),null):0===a?o.copy(null,r,null,null,null):o.copy(null,null,null,null,o.right.insert(n,r,i)),o.fixUp()}removeMin(){if(this.left.isEmpty())return Ye.EMPTY;let n=this;return n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.removeMin(),null),n.fixUp()}remove(n,r){let i,o=this;if(r(n,o.key)<0)o.left.isEmpty()||o.left.isRed()||o.left.left.isRed()||(o=o.moveRedLeft()),o=o.copy(null,null,null,o.left.remove(n,r),null);else{if(o.left.isRed()&&(o=o.rotateRight()),o.right.isEmpty()||o.right.isRed()||o.right.left.isRed()||(o=o.moveRedRight()),0===r(n,o.key)){if(o.right.isEmpty())return Ye.EMPTY;i=o.right.min(),o=o.copy(i.key,i.value,null,null,o.right.removeMin())}o=o.copy(null,null,null,null,o.right.remove(n,r))}return o.fixUp()}isRed(){return this.color}fixUp(){let n=this;return n.right.isRed()&&!n.left.isRed()&&(n=n.rotateLeft()),n.left.isRed()&&n.left.left.isRed()&&(n=n.rotateRight()),n.left.isRed()&&n.right.isRed()&&(n=n.colorFlip()),n}moveRedLeft(){let n=this.colorFlip();return n.right.left.isRed()&&(n=n.copy(null,null,null,null,n.right.rotateRight()),n=n.rotateLeft(),n=n.colorFlip()),n}moveRedRight(){let n=this.colorFlip();return n.left.left.isRed()&&(n=n.rotateRight(),n=n.colorFlip()),n}rotateLeft(){const n=this.copy(null,null,Ye.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight(){const n=this.copy(null,null,Ye.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip(){const n=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,r)}checkMaxDepth(){const n=this.check();return Math.pow(2,n)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw B();const n=this.left.check();if(n!==this.right.check())throw B();return n+(this.isRed()?0:1)}}Ye.EMPTY=null,Ye.RED=!0,Ye.BLACK=!1,Ye.EMPTY=new class{constructor(){this.size=0}get key(){throw B()}get value(){throw B()}get color(){throw B()}get left(){throw B()}get right(){throw B()}copy(s,n,r,i,o){return this}insert(s,n,r){return new Ye(s,n)}remove(s,n){return this}isEmpty(){return!0}inorderTraversal(s){return!1}reverseTraversal(s){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Te{constructor(n){this.comparator=n,this.data=new Pe(this.comparator)}has(n){return null!==this.data.get(n)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(n){return this.data.indexOf(n)}forEach(n){this.data.inorderTraversal((r,i)=>(n(r),!1))}forEachInRange(n,r){const i=this.data.getIteratorFrom(n[0]);for(;i.hasNext();){const o=i.getNext();if(this.comparator(o.key,n[1])>=0)return;r(o.key)}}forEachWhile(n,r){let i;for(i=void 0!==r?this.data.getIteratorFrom(r):this.data.getIterator();i.hasNext();)if(!n(i.getNext().key))return}firstAfterOrEqual(n){const r=this.data.getIteratorFrom(n);return r.hasNext()?r.getNext().key:null}getIterator(){return new dl(this.data.getIterator())}getIteratorFrom(n){return new dl(this.data.getIteratorFrom(n))}add(n){return this.copy(this.data.remove(n).insert(n,!0))}delete(n){return this.has(n)?this.copy(this.data.remove(n)):this}isEmpty(){return this.data.isEmpty()}unionWith(n){let r=this;return r.size<n.size&&(r=n,n=this),n.forEach(i=>{r=r.add(i)}),r}isEqual(n){if(!(n instanceof Te)||this.size!==n.size)return!1;const r=this.data.getIterator(),i=n.data.getIterator();for(;r.hasNext();){const o=r.getNext().key,a=i.getNext().key;if(0!==this.comparator(o,a))return!1}return!0}toArray(){const n=[];return this.forEach(r=>{n.push(r)}),n}toString(){const n=[];return this.forEach(r=>n.push(r)),"SortedSet("+n.toString()+")"}copy(n){const r=new Te(this.comparator);return r.data=n,r}}class dl{constructor(n){this.iter=n}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const sg=new Pe(U.comparator);function St(){return sg}const ig=new Pe(U.comparator);function qo(){return ig}const og=new Pe(U.comparator);function fl(){return og}const ag=new Te(U.comparator);function ce(...s){let n=ag;for(const r of s)n=n.add(r);return n}const ug=new Te(te);function Ii(){return ug}class vs{constructor(n,r,i,o,a){this.snapshotVersion=n,this.targetChanges=r,this.targetMismatches=i,this.documentUpdates=o,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(n,r){const i=new Map;return i.set(n,ws.createSynthesizedTargetChangeForCurrentChange(n,r)),new vs(Q.min(),i,Ii(),St(),ce())}}class ws{constructor(n,r,i,o,a){this.resumeToken=n,this.current=r,this.addedDocuments=i,this.modifiedDocuments=o,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(n,r){return new ws(Ke.EMPTY_BYTE_STRING,r,ce(),ce(),ce())}}class Ei{constructor(n,r,i,o){this.k=n,this.removedTargetIds=r,this.key=i,this.$=o}}class gl{constructor(n,r){this.targetId=n,this.O=r}}class ml{constructor(n,r,i=Ke.EMPTY_BYTE_STRING,o=null){this.state=n,this.targetIds=r,this.resumeToken=i,this.cause=o}}class pl{constructor(){this.F=0,this.M=vl(),this.L=Ke.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}get current(){return this.B}get resumeToken(){return this.L}get q(){return 0!==this.F}get K(){return this.U}j(n){n.approximateByteSize()>0&&(this.U=!0,this.L=n)}W(){let n=ce(),r=ce(),i=ce();return this.M.forEach((o,a)=>{switch(a){case 0:n=n.add(o);break;case 2:r=r.add(o);break;case 1:i=i.add(o);break;default:B()}}),new ws(this.L,this.B,n,r,i)}G(){this.U=!1,this.M=vl()}H(n,r){this.U=!0,this.M=this.M.insert(n,r)}J(n){this.U=!0,this.M=this.M.remove(n)}Y(){this.F+=1}X(){this.F-=1}Z(){this.U=!0,this.B=!0}}class cg{constructor(n){this.tt=n,this.et=new Map,this.nt=St(),this.st=yl(),this.it=new Te(te)}rt(n){for(const r of n.k)n.$&&n.$.isFoundDocument()?this.ot(r,n.$):this.at(r,n.key,n.$);for(const r of n.removedTargetIds)this.at(r,n.key,n.$)}ct(n){this.forEachTarget(n,r=>{const i=this.ut(r);switch(n.state){case 0:this.ht(r)&&i.j(n.resumeToken);break;case 1:i.X(),i.q||i.G(),i.j(n.resumeToken);break;case 2:i.X(),i.q||this.removeTarget(r);break;case 3:this.ht(r)&&(i.Z(),i.j(n.resumeToken));break;case 4:this.ht(r)&&(this.lt(r),i.j(n.resumeToken));break;default:B()}})}forEachTarget(n,r){n.targetIds.length>0?n.targetIds.forEach(r):this.et.forEach((i,o)=>{this.ht(o)&&r(o)})}ft(n){const r=n.targetId,i=n.O.count,o=this.dt(r);if(o){const a=o.target;if(fi(a))if(0===i){const u=new U(a.path);this.at(r,u,ve.newNoDocument(u,Q.min()))}else z(1===i);else this.wt(r)!==i&&(this.lt(r),this.it=this.it.add(r))}}_t(n){const r=new Map;this.et.forEach((a,u)=>{const c=this.dt(u);if(c){if(a.current&&fi(c.target)){const l=new U(c.target.path);null!==this.nt.get(l)||this.gt(u,l)||this.at(u,l,ve.newNoDocument(l,n))}a.K&&(r.set(u,a.W()),a.G())}});let i=ce();this.st.forEach((a,u)=>{let c=!0;u.forEachWhile(l=>{const h=this.dt(l);return!h||2===h.purpose||(c=!1,!1)}),c&&(i=i.add(a))});const o=new vs(n,r,this.it,this.nt,i);return this.nt=St(),this.st=yl(),this.it=new Te(te),o}ot(n,r){if(!this.ht(n))return;const i=this.gt(n,r.key)?2:0;this.ut(n).H(r.key,i),this.nt=this.nt.insert(r.key,r),this.st=this.st.insert(r.key,this.yt(r.key).add(n))}at(n,r,i){if(!this.ht(n))return;const o=this.ut(n);this.gt(n,r)?o.H(r,1):o.J(r),this.st=this.st.insert(r,this.yt(r).delete(n)),i&&(this.nt=this.nt.insert(r,i))}removeTarget(n){this.et.delete(n)}wt(n){const r=this.ut(n).W();return this.tt.getRemoteKeysForTarget(n).size+r.addedDocuments.size-r.removedDocuments.size}Y(n){this.ut(n).Y()}ut(n){let r=this.et.get(n);return r||(r=new pl,this.et.set(n,r)),r}yt(n){let r=this.st.get(n);return r||(r=new Te(te),this.st=this.st.insert(n,r)),r}ht(n){const r=null!==this.dt(n);return r||N("WatchChangeAggregator","Detected inactive target",n),r}dt(n){const r=this.et.get(n);return r&&r.q?null:this.tt.Et(n)}lt(n){this.et.set(n,new pl),this.tt.getRemoteKeysForTarget(n).forEach(r=>{this.at(n,r,null)})}gt(n,r){return this.tt.getRemoteKeysForTarget(n).has(r)}}function yl(){return new Pe(U.comparator)}function vl(){return new Pe(U.comparator)}const lg={asc:"ASCENDING",desc:"DESCENDING"},hg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class dg{constructor(n,r){this.databaseId=n,this.D=r}}function _s(s,n){return s.D?`${new Date(1e3*n.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+n.nanoseconds).slice(-9)}Z`:{seconds:""+n.seconds,nanos:n.nanoseconds}}function wl(s,n){return s.D?n.toBase64():n.toUint8Array()}function fg(s,n){return _s(s,n.toTimestamp())}function Ge(s){return z(!!s),Q.fromTimestamp(function(n){const r=Xt(n);return new je(r.seconds,r.nanos)}(s))}function jo(s,n){return(r=s,new ue(["projects",r.projectId,"databases",r.database])).child("documents").child(n).canonicalString();var r}function _l(s){const n=ue.fromString(s);return z(Rl(n)),n}function Is(s,n){return jo(s.databaseId,n.path)}function Mt(s,n){const r=_l(n);if(r.get(1)!==s.databaseId.projectId)throw new x(w.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+s.databaseId.projectId);if(r.get(3)!==s.databaseId.database)throw new x(w.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+s.databaseId.database);return new U(El(r))}function Ko(s,n){return jo(s.databaseId,n)}function Il(s){const n=_l(s);return 4===n.length?ue.emptyPath():El(n)}function Es(s){return new ue(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function El(s){return z(s.length>4&&"documents"===s.get(4)),s.popFirst(5)}function Tl(s,n,r){return{name:Is(s,n),fields:r.value.mapValue.fields}}function Sl(s,n,r){const i=Mt(s,n.name),o=Ge(n.updateTime),a=new st({mapValue:{fields:n.fields}}),u=ve.newFoundDocument(i,o,a);return r&&u.setHasCommittedMutations(),r?u.setHasCommittedMutations():u}function Ti(s,n){let r;if(n instanceof ps)r={update:Tl(s,n.key,n.value)};else if(n instanceof ys)r={delete:Is(s,n.key)};else if(n instanceof en)r={update:Tl(s,n.key,n.data),updateMask:Eg(n.fieldMask)};else{if(!(n instanceof Bo))return B();r={verify:Is(s,n.key)}}return n.fieldTransforms.length>0&&(r.updateTransforms=n.fieldTransforms.map(i=>function(o,a){const u=a.transform;if(u instanceof cr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Sn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof xn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof lr)return{fieldPath:a.field.canonicalString(),increment:u.C};throw B()}(0,i))),n.precondition.isNone||(r.currentDocument=void 0!==(o=n.precondition).updateTime?{updateTime:fg(s,o.updateTime)}:void 0!==o.exists?{exists:o.exists}:B()),r;var o}function xl(s,n){const r=n.currentDocument?void 0!==(o=n.currentDocument).updateTime?ke.updateTime(Ge(o.updateTime)):void 0!==o.exists?ke.exists(o.exists):ke.none():ke.none(),i=n.updateTransforms?n.updateTransforms.map(o=>function(a,u){let c=null;"setToServerValue"in u?(z("REQUEST_TIME"===u.setToServerValue),c=new cr):"appendMissingElements"in u?c=new Sn(u.appendMissingElements.values||[]):"removeAllFromArray"in u?c=new xn(u.removeAllFromArray.values||[]):"increment"in u?c=new lr(a,u.increment):B();const l=Qe.fromServerFormat(u.fieldPath);return new ms(l,c)}(s,o)):[];var o;if(n.update){const o=Mt(s,n.update.name),a=new st({mapValue:{fields:n.update.fields}});if(n.updateMask){const u=new rr((n.updateMask.fieldPaths||[]).map(h=>Qe.fromServerFormat(h)));return new en(o,a,u,r,i)}return new ps(o,a,r,i)}if(n.delete){const o=Mt(s,n.delete);return new ys(o,r)}if(n.verify){const o=Mt(s,n.verify);return new Bo(o,r)}return B()}function bl(s,n){return{documents:[Ko(s,n.path)]}}function Al(s,n){const r={structuredQuery:{}},i=n.path;null!==n.collectionGroup?(r.parent=Ko(s,i),r.structuredQuery.from=[{collectionId:n.collectionGroup,allDescendants:!0}]):(r.parent=Ko(s,i.popLast()),r.structuredQuery.from=[{collectionId:i.lastSegment()}]);const o=function(c){if(0===c.length)return;const l=c.map(h=>function(d){if("=="===d.op){if(qc(d.value))return{unaryFilter:{field:hr(d.field),op:"IS_NAN"}};if(Bc(d.value))return{unaryFilter:{field:hr(d.field),op:"IS_NULL"}}}else if("!="===d.op){if(qc(d.value))return{unaryFilter:{field:hr(d.field),op:"IS_NOT_NAN"}};if(Bc(d.value))return{unaryFilter:{field:hr(d.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hr(d.field),op:wg(d.op),value:d.value}}}(h));return 1===l.length?l[0]:{compositeFilter:{op:"AND",filters:l}}}(n.filters);o&&(r.structuredQuery.where=o);const a=function(c){if(0!==c.length)return c.map(l=>{return{field:hr((h=l).field),direction:vg(h.dir)};var h})}(n.orderBy);a&&(r.structuredQuery.orderBy=a);const u=(l=n.limit,s.D||En(l)?l:{value:l});var l;return null!==u&&(r.structuredQuery.limit=u),n.startAt&&(r.structuredQuery.startAt=Dl(n.startAt)),n.endAt&&(r.structuredQuery.endAt=Dl(n.endAt)),r}function Nl(s){let n=Il(s.parent);const r=s.structuredQuery,i=r.from?r.from.length:0;let o=null;if(i>0){z(1===i);const d=r.from[0];d.allDescendants?o=d.collectionId:n=n.child(d.collectionId)}let a=[];r.where&&(a=Cl(r.where));let u=[];r.orderBy&&(u=r.orderBy.map(d=>{return new or(dr((g=d).field),function(_){switch(_){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(g.direction));var g}));let c=null;r.limit&&(c=function(d){let g;return g="object"==typeof d?d.value:d,En(g)?null:g}(r.limit));let l=null;r.startAt&&(l=kl(r.startAt));let h=null;return r.endAt&&(h=kl(r.endAt)),Wc(n,o,u,a,c,"F",l,h)}function Cl(s){return s?void 0!==s.unaryFilter?[Ig(s)]:void 0!==s.fieldFilter?[_g(s)]:void 0!==s.compositeFilter?s.compositeFilter.filters.map(n=>Cl(n)).reduce((n,r)=>n.concat(r)):B():[]}function Dl(s){return{before:s.before,values:s.position}}function kl(s){return new ds(s.values||[],!!s.before)}function vg(s){return lg[s]}function wg(s){return hg[s]}function hr(s){return{fieldPath:s.canonicalString()}}function dr(s){return Qe.fromServerFormat(s.fieldPath)}function _g(s){return ct.create(dr(s.fieldFilter.field),function(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return B()}}(s.fieldFilter.op),s.fieldFilter.value)}function Ig(s){switch(s.unaryFilter.op){case"IS_NAN":const n=dr(s.unaryFilter.field);return ct.create(n,"==",{doubleValue:NaN});case"IS_NULL":const r=dr(s.unaryFilter.field);return ct.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=dr(s.unaryFilter.field);return ct.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=dr(s.unaryFilter.field);return ct.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return B()}}function Eg(s){const n=[];return s.fields.forEach(r=>n.push(r.canonicalString())),{fieldPaths:n}}function Rl(s){return s.length>=4&&"projects"===s.get(0)&&"databases"===s.get(2)}function Nt(s){let n="";for(let r=0;r<s.length;r++)n.length>0&&(n=Ol(n)),n=Tg(s.get(r),n);return Ol(n)}function Tg(s,n){let r=n;const i=s.length;for(let o=0;o<i;o++){const a=s.charAt(o);switch(a){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=a}}return r}function Ol(s){return s+"\x01\x01"}function Gt(s){const n=s.length;if(z(n>=2),2===n)return z("\x01"===s.charAt(0)&&"\x01"===s.charAt(1)),ue.emptyPath();const r=n-2,i=[];let o="";for(let a=0;a<n;){const u=s.indexOf("\x01",a);switch((u<0||u>r)&&B(),s.charAt(u+1)){case"\x01":const c=s.substring(a,u);let l;0===o.length?l=c:(o+=c,l=o,o=""),i.push(l);break;case"\x10":o+=s.substring(a,u),o+="\0";break;case"\x11":o+=s.substring(a,u+1);break;default:B()}a=u+2}return new ue(i)}class Sg{constructor(n,r){this.seconds=n,this.nanoseconds=r}}class wt{constructor(n,r,i){this.ownerId=n,this.allowTabSynchronization=r,this.leaseTimestampMs=i}}wt.store="owner",wt.key="owner";class tn{constructor(n,r,i){this.userId=n,this.lastAcknowledgedBatchId=r,this.lastStreamToken=i}}tn.store="mutationQueues",tn.keyPath="userId";class me{constructor(n,r,i,o,a){this.userId=n,this.batchId=r,this.localWriteTimeMs=i,this.baseMutations=o,this.mutations=a}}me.store="mutations",me.keyPath="batchId",me.userMutationsIndex="userMutationsIndex",me.userMutationsKeyPath=["userId","batchId"];class it{constructor(){}static prefixForUser(n){return[n]}static prefixForPath(n,r){return[n,Nt(r)]}static key(n,r,i){return[n,Nt(r),i]}}it.store="documentMutations",it.PLACEHOLDER=new it;class xg{constructor(n,r){this.path=n,this.readTime=r}}class bg{constructor(n,r){this.path=n,this.version=r}}class Se{constructor(n,r,i,o,a,u){this.unknownDocument=n,this.noDocument=r,this.document=i,this.hasCommittedMutations=o,this.readTime=a,this.parentPath=u}}Se.store="remoteDocuments",Se.readTimeIndex="readTimeIndex",Se.readTimeIndexPath="readTime",Se.collectionReadTimeIndex="collectionReadTimeIndex",Se.collectionReadTimeIndexPath=["parentPath","readTime"];class Ft{constructor(n){this.byteSize=n}}Ft.store="remoteDocumentGlobal",Ft.key="remoteDocumentGlobalKey";class dt{constructor(n,r,i,o,a,u,c){this.targetId=n,this.canonicalId=r,this.readTime=i,this.resumeToken=o,this.lastListenSequenceNumber=a,this.lastLimboFreeSnapshotVersion=u,this.query=c}}dt.store="targets",dt.keyPath="targetId",dt.queryTargetsIndexName="queryTargetsIndex",dt.queryTargetsKeyPath=["canonicalId","targetId"];class Je{constructor(n,r,i){this.targetId=n,this.path=r,this.sequenceNumber=i}}Je.store="targetDocuments",Je.keyPath=["targetId","path"],Je.documentTargetsIndex="documentTargetsIndex",Je.documentTargetsKeyPath=["path","targetId"];class _t{constructor(n,r,i,o){this.highestTargetId=n,this.highestListenSequenceNumber=r,this.lastRemoteSnapshotVersion=i,this.targetCount=o}}_t.key="targetGlobalKey",_t.store="targetGlobal";class bn{constructor(n,r){this.collectionId=n,this.parent=r}}bn.store="collectionParents",bn.keyPath=["collectionId","parent"];class $t{constructor(n,r,i,o){this.clientId=n,this.updateTimeMs=r,this.networkEnabled=i,this.inForeground=o}}$t.store="clientMetadata",$t.keyPath="clientId";class fr{constructor(n,r,i){this.bundleId=n,this.createTime=r,this.version=i}}fr.store="bundles",fr.keyPath="bundleId";class gr{constructor(n,r,i){this.name=n,this.readTime=r,this.bundledQuery=i}}gr.store="namedQueries",gr.keyPath="name";const Ag=[tn.store,me.store,it.store,Se.store,dt.store,wt.store,_t.store,Je.store,$t.store,Ft.store,bn.store,fr.store,gr.store],Ll="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Pl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(n){this.onCommittedListeners.push(n)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(n=>n())}}class S{constructor(n){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,n(r=>{this.isDone=!0,this.result=r,this.nextCallback&&this.nextCallback(r)},r=>{this.isDone=!0,this.error=r,this.catchCallback&&this.catchCallback(r)})}catch(n){return this.next(void 0,n)}next(n,r){return this.callbackAttached&&B(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(n,this.result):new S((i,o)=>{this.nextCallback=a=>{this.wrapSuccess(n,a).next(i,o)},this.catchCallback=a=>{this.wrapFailure(r,a).next(i,o)}})}toPromise(){return new Promise((n,r)=>{this.next(n,r)})}wrapUserFunction(n){try{const r=n();return r instanceof S?r:S.resolve(r)}catch(r){return S.reject(r)}}wrapSuccess(n,r){return n?this.wrapUserFunction(()=>n(r)):S.resolve(r)}wrapFailure(n,r){return n?this.wrapUserFunction(()=>n(r)):S.reject(r)}static resolve(n){return new S((r,i)=>{r(n)})}static reject(n){return new S((r,i)=>{i(n)})}static waitFor(n){return new S((r,i)=>{let o=0,a=0,u=!1;n.forEach(c=>{++o,c.next(()=>{++a,u&&a===o&&r()},l=>i(l))}),u=!0,a===o&&r()})}static or(n){let r=S.resolve(!1);for(const i of n)r=r.next(o=>o?S.resolve(o):i());return r}static forEach(n,r){const i=[];return n.forEach((o,a)=>{i.push(r.call(this,o,a))}),this.waitFor(i)}}class Si{constructor(n,r){this.action=n,this.transaction=r,this.aborted=!1,this.Tt=new qe,this.transaction.oncomplete=()=>{this.Tt.resolve()},this.transaction.onabort=()=>{r.error?this.Tt.reject(new Ts(n,r.error)):this.Tt.resolve()},this.transaction.onerror=i=>{const o=Go(i.target.error);this.Tt.reject(new Ts(n,o))}}static open(n,r,i,o){try{return new Si(r,n.transaction(o,i))}catch(a){throw new Ts(r,a)}}get It(){return this.Tt.promise}abort(n){n&&this.Tt.reject(n),this.aborted||(N("SimpleDb","Aborting transaction:",n?n.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(n){const r=this.transaction.objectStore(n);return new Cg(r)}}class Ct{constructor(n,r,i){this.name=n,this.version=r,this.At=i,12.2===Ct.Rt((0,Y.z$)())&&Ce("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(n){return N("SimpleDb","Removing database:",n),Nn(window.indexedDB.deleteDatabase(n)).toPromise()}static bt(){if(!(0,Y.hl)())return!1;if(Ct.Pt())return!0;const n=(0,Y.z$)(),r=Ct.Rt(n),i=0<r&&r<10,o=Ct.vt(n),a=0<o&&o<4.5;return!(n.indexOf("MSIE ")>0||n.indexOf("Trident/")>0||n.indexOf("Edge/")>0||i||a)}static Pt(){var n;return"undefined"!=typeof process&&"YES"===(null===(n=process.env)||void 0===n?void 0:n.Vt)}static St(n,r){return n.store(r)}static Rt(n){const r=n.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=r?r[1].split("_").slice(0,2).join("."):"-1";return Number(i)}static vt(n){const r=n.match(/Android ([\d.]+)/i),i=r?r[1].split(".").slice(0,2).join("."):"-1";return Number(i)}Dt(n){var r=this;return(0,I.Z)(function*(){return r.db||(N("SimpleDb","Opening database:",r.name),r.db=yield new Promise((i,o)=>{const a=indexedDB.open(r.name,r.version);a.onsuccess=u=>{i(u.target.result)},a.onblocked=()=>{o(new Ts(n,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=u=>{const c=u.target.error;o("VersionError"===c.name?new x(w.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===c.name?new x(w.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+c):new Ts(n,c))},a.onupgradeneeded=u=>{N("SimpleDb",'Database "'+r.name+'" requires upgrade from version:',u.oldVersion),r.At.Ct(u.target.result,a.transaction,u.oldVersion,r.version).next(()=>{N("SimpleDb","Database upgrade to version "+r.version+" complete")})}})),r.Nt&&(r.db.onversionchange=i=>r.Nt(i)),r.db})()}xt(n){this.Nt=n,this.db&&(this.db.onversionchange=r=>n(r))}runTransaction(n,r,i,o){var a=this;return(0,I.Z)(function*(){const u="readonly"===r;let c=0;for(;;){++c;try{a.db=yield a.Dt(n);const l=Si.open(a.db,n,u?"readonly":"readwrite",i),h=o(l).catch(d=>(l.abort(d),S.reject(d))).toPromise();return h.catch(()=>{}),yield l.It,h}catch(l){const h="FirebaseError"!==l.name&&c<3;if(N("SimpleDb","Transaction failed with error:",l.message,"Retrying:",h),a.close(),!h)return Promise.reject(l)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Ng{constructor(n){this.kt=n,this.$t=!1,this.Ot=null}get isDone(){return this.$t}get Ft(){return this.Ot}set cursor(n){this.kt=n}done(){this.$t=!0}Mt(n){this.Ot=n}delete(){return Nn(this.kt.delete())}}class Ts extends x{constructor(n,r){super(w.UNAVAILABLE,`IndexedDB transaction '${n}' failed: ${r}`),this.name="IndexedDbTransactionError"}}function An(s){return"IndexedDbTransactionError"===s.name}class Cg{constructor(n){this.store=n}put(n,r){let i;return void 0!==r?(N("SimpleDb","PUT",this.store.name,n,r),i=this.store.put(r,n)):(N("SimpleDb","PUT",this.store.name,"<auto-key>",n),i=this.store.put(n)),Nn(i)}add(n){return N("SimpleDb","ADD",this.store.name,n,n),Nn(this.store.add(n))}get(n){return Nn(this.store.get(n)).next(r=>(void 0===r&&(r=null),N("SimpleDb","GET",this.store.name,n,r),r))}delete(n){return N("SimpleDb","DELETE",this.store.name,n),Nn(this.store.delete(n))}count(){return N("SimpleDb","COUNT",this.store.name),Nn(this.store.count())}Lt(n,r){const i=this.cursor(this.options(n,r)),o=[];return this.Bt(i,(a,u)=>{o.push(u)}).next(()=>o)}Ut(n,r){N("SimpleDb","DELETE ALL",this.store.name);const i=this.options(n,r);i.qt=!1;const o=this.cursor(i);return this.Bt(o,(a,u,c)=>c.delete())}Kt(n,r){let i;r?i=n:(i={},r=n);const o=this.cursor(i);return this.Bt(o,r)}jt(n){const r=this.cursor({});return new S((i,o)=>{r.onerror=a=>{const u=Go(a.target.error);o(u)},r.onsuccess=a=>{const u=a.target.result;u?n(u.primaryKey,u.value).next(c=>{c?u.continue():i()}):i()}})}Bt(n,r){const i=[];return new S((o,a)=>{n.onerror=u=>{a(u.target.error)},n.onsuccess=u=>{const c=u.target.result;if(!c)return void o();const l=new Ng(c),h=r(c.primaryKey,c.value,l);if(h instanceof S){const d=h.catch(g=>(l.done(),S.reject(g)));i.push(d)}l.isDone?o():null===l.Ft?c.continue():c.continue(l.Ft)}}).next(()=>S.waitFor(i))}options(n,r){let i;return void 0!==n&&("string"==typeof n?i=n:r=n),{index:i,range:r}}cursor(n){let r="next";if(n.reverse&&(r="prev"),n.index){const i=this.store.index(n.index);return n.qt?i.openKeyCursor(n.range,r):i.openCursor(n.range,r)}return this.store.openCursor(n.range,r)}}function Nn(s){return new S((n,r)=>{s.onsuccess=i=>{n(i.target.result)},s.onerror=i=>{const o=Go(i.target.error);r(o)}})}let Ml=!1;function Go(s){const n=Ct.Rt((0,Y.z$)());if(n>=12.2&&n<13){const r="An internal error was encountered in the Indexed Database server";if(s.message.indexOf(r)>=0){const i=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${r}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ml||(Ml=!0,setTimeout(()=>{throw i},0)),i}}return s}class Fl extends Pl{constructor(n,r){super(),this.Qt=n,this.currentSequenceNumber=r}}function ft(s,n){const r=k(s);return Ct.St(r.Qt,n)}class $o{constructor(n,r,i,o){this.batchId=n,this.localWriteTime=r,this.baseMutations=i,this.mutations=o}applyToRemoteDocument(n,r){const i=r.mutationResults;for(let o=0;o<this.mutations.length;o++){const a=this.mutations[o];a.key.isEqual(n.key)&&tg(a,n,i[o])}}applyToLocalView(n){for(const r of this.baseMutations)r.key.isEqual(n.key)&&Vo(r,n,this.localWriteTime);for(const r of this.mutations)r.key.isEqual(n.key)&&Vo(r,n,this.localWriteTime)}applyToLocalDocumentSet(n){this.mutations.forEach(r=>{const i=n.get(r.key),o=i;this.applyToLocalView(o),i.isValidDocument()||o.convertToNoDocument(Q.min())})}keys(){return this.mutations.reduce((n,r)=>n.add(r.key),ce())}isEqual(n){return this.batchId===n.batchId&&nr(this.mutations,n.mutations,(r,i)=>il(r,i))&&nr(this.baseMutations,n.baseMutations,(r,i)=>il(r,i))}}class zo{constructor(n,r,i,o){this.batch=n,this.commitVersion=r,this.mutationResults=i,this.docVersions=o}static from(n,r,i){z(n.mutations.length===i.length);let o=fl();const a=n.mutations;for(let u=0;u<a.length;u++)o=o.insert(a[u].key,i[u].version);return new zo(n,r,i,o)}}class nn{constructor(n,r,i,o,a=Q.min(),u=Q.min(),c=Ke.EMPTY_BYTE_STRING){this.target=n,this.targetId=r,this.purpose=i,this.sequenceNumber=o,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=c}withSequenceNumber(n){return new nn(this.target,this.targetId,this.purpose,n,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(n,r){return new nn(this.target,this.targetId,this.purpose,this.sequenceNumber,r,this.lastLimboFreeSnapshotVersion,n)}withLastLimboFreeSnapshotVersion(n){return new nn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,n,this.resumeToken)}}class Ul{constructor(n){this.Wt=n}}function Wo(s,n){if(n.document)return Sl(s.Wt,n.document,!!n.hasCommittedMutations);if(n.noDocument){const r=U.fromSegments(n.noDocument.path),i=pr(n.noDocument.readTime),o=ve.newNoDocument(r,i);return n.hasCommittedMutations?o.setHasCommittedMutations():o}if(n.unknownDocument){const r=U.fromSegments(n.unknownDocument.path),i=pr(n.unknownDocument.version);return ve.newUnknownDocument(r,i)}return B()}function Vl(s,n,r){const i=Zo(r),o=n.key.path.popLast().toArray();if(n.isFoundDocument()){const a={name:Is(c=s.Wt,(l=n).key),fields:l.data.value.mapValue.fields,updateTime:_s(c,l.version.toTimestamp())};return new Se(null,null,a,n.hasCommittedMutations,i,o)}var c,l;if(n.isNoDocument()){const a=n.key.path.toArray(),u=mr(n.version),c=n.hasCommittedMutations;return new Se(null,new xg(a,u),null,c,i,o)}if(n.isUnknownDocument()){const a=n.key.path.toArray(),u=mr(n.version);return new Se(new bg(a,u),null,null,!0,i,o)}return B()}function Zo(s){const n=s.toTimestamp();return[n.seconds,n.nanoseconds]}function Bl(s){const n=new je(s[0],s[1]);return Q.fromTimestamp(n)}function mr(s){const n=s.toTimestamp();return new Sg(n.seconds,n.nanoseconds)}function pr(s){const n=new je(s.seconds,s.nanoseconds);return Q.fromTimestamp(n)}function yr(s,n){const r=(n.baseMutations||[]).map(a=>xl(s.Wt,a));for(let a=0;a<n.mutations.length-1;++a){const u=n.mutations[a];a+1<n.mutations.length&&void 0!==n.mutations[a+1].transform&&(u.updateTransforms=n.mutations[a+1].transform.fieldTransforms,n.mutations.splice(a+1,1),++a)}const i=n.mutations.map(a=>xl(s.Wt,a)),o=je.fromMillis(n.localWriteTimeMs);return new $o(n.batchId,o,r,i)}function Ss(s){const n=pr(s.readTime),r=void 0!==s.lastLimboFreeSnapshotVersion?pr(s.lastLimboFreeSnapshotVersion):Q.min();let i;var o;return void 0!==s.query.documents?(z(1===(o=s.query).documents.length),i=Tt(ar(Il(o.documents[0])))):i=Tt(Nl(s.query)),new nn(i,s.targetId,0,s.lastListenSequenceNumber,n,r,Ke.fromBase64String(s.resumeToken))}function ql(s,n){const r=mr(n.snapshotVersion),i=mr(n.lastLimboFreeSnapshotVersion);let o;o=fi(n.target)?bl(s.Wt,n.target):Al(s.Wt,n.target);const a=n.resumeToken.toBase64();return new dt(n.targetId,hs(n.target),r,a,n.sequenceNumber,i,o)}function Ho(s){const n=Nl({parent:s.parent,structuredQuery:s.structuredQuery});return"LAST"===s.limitType?Zc(n,n.limit,"L"):n}class Dg{getBundleMetadata(n,r){return jl(n).get(r).next(i=>{if(i)return{id:(o=i).bundleId,createTime:pr(o.createTime),version:o.version};var o})}saveBundleMetadata(n,r){return jl(n).put({bundleId:(i=r).id,createTime:mr(Ge(i.createTime)),version:i.version});var i}getNamedQuery(n,r){return Kl(n).get(r).next(i=>{if(i)return{name:(o=i).name,query:Ho(o.bundledQuery),readTime:pr(o.readTime)};var o})}saveNamedQuery(n,r){return Kl(n).put({name:(i=r).name,readTime:mr(Ge(i.readTime)),bundledQuery:i.bundledQuery});var i}}function jl(s){return ft(s,fr.store)}function Kl(s){return ft(s,gr.store)}class kg{constructor(){this.Gt=new Qo}addToCollectionParentIndex(n,r){return this.Gt.add(r),S.resolve()}getCollectionParents(n,r){return S.resolve(this.Gt.getEntries(r))}}class Qo{constructor(){this.index={}}add(n){const r=n.lastSegment(),i=n.popLast(),o=this.index[r]||new Te(ue.comparator),a=!o.has(i);return this.index[r]=o.add(i),a}has(n){const r=n.lastSegment(),i=n.popLast(),o=this.index[r];return o&&o.has(i)}getEntries(n){return(this.index[n]||new Te(ue.comparator)).toArray()}}class Rg{constructor(){this.zt=new Qo}addToCollectionParentIndex(n,r){if(!this.zt.has(r)){const i=r.lastSegment(),o=r.popLast();n.addOnCommittedListener(()=>{this.zt.add(r)});const a={collectionId:i,parent:Nt(o)};return Gl(n).put(a)}return S.resolve()}getCollectionParents(n,r){const i=[],o=IDBKeyRange.bound([r,""],[Lc(r),""],!1,!0);return Gl(n).Lt(o).next(a=>{for(const u of a){if(u.collectionId!==r)break;i.push(Gt(u.parent))}return i})}}function Gl(s){return ft(s,bn.store)}const $l={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class gt{constructor(n,r,i){this.cacheSizeCollectionThreshold=n,this.percentileToCollect=r,this.maximumSequenceNumbersToCollect=i}static withCacheSize(n){return new gt(n,gt.DEFAULT_COLLECTION_PERCENTILE,gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function zl(s,n,r){const i=s.store(me.store),o=s.store(it.store),a=[],u=IDBKeyRange.only(r.batchId);let c=0;const l=i.Kt({range:u},(d,g,_)=>(c++,_.delete()));a.push(l.next(()=>{z(1===c)}));const h=[];for(const d of r.mutations){const g=it.key(n,d.key.path,r.batchId);a.push(o.delete(g)),h.push(d.key)}return S.waitFor(a).next(()=>h)}function xi(s){if(!s)return 0;let n;if(s.document)n=s.document;else if(s.unknownDocument)n=s.unknownDocument;else{if(!s.noDocument)throw B();n=s.noDocument}return JSON.stringify(n).length}gt.DEFAULT_COLLECTION_PERCENTILE=10,gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,gt.DEFAULT=new gt(41943040,gt.DEFAULT_COLLECTION_PERCENTILE,gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),gt.DISABLED=new gt(-1,0,0);class Yo{constructor(n,r,i,o){this.userId=n,this.N=r,this.Ht=i,this.referenceDelegate=o,this.Jt={}}static Yt(n,r,i,o){z(""!==n.uid);const a=n.isAuthenticated()?n.uid:"";return new Yo(a,r,i,o)}checkEmpty(n){let r=!0;const i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return rn(n).Kt({index:me.userMutationsIndex,range:i},(o,a,u)=>{r=!1,u.done()}).next(()=>r)}addMutationBatch(n,r,i,o){const a=vr(n),u=rn(n);return u.add({}).next(c=>{z("number"==typeof c);const l=new $o(c,r,i,o),h=function(_,E,b){const M=b.baseMutations.map(ge=>Ti(_.Wt,ge)),W=b.mutations.map(ge=>Ti(_.Wt,ge));return new me(E,b.batchId,b.localWriteTime.toMillis(),M,W)}(this.N,this.userId,l),d=[];let g=new Te((_,E)=>te(_.canonicalString(),E.canonicalString()));for(const _ of o){const E=it.key(this.userId,_.key.path,c);g=g.add(_.key.path.popLast()),d.push(u.put(h)),d.push(a.put(E,it.PLACEHOLDER))}return g.forEach(_=>{d.push(this.Ht.addToCollectionParentIndex(n,_))}),n.addOnCommittedListener(()=>{this.Jt[c]=l.keys()}),S.waitFor(d).next(()=>l)})}lookupMutationBatch(n,r){return rn(n).get(r).next(i=>i?(z(i.userId===this.userId),yr(this.N,i)):null)}Xt(n,r){return this.Jt[r]?S.resolve(this.Jt[r]):this.lookupMutationBatch(n,r).next(i=>{if(i){const o=i.keys();return this.Jt[r]=o,o}return null})}getNextMutationBatchAfterBatchId(n,r){const i=r+1,o=IDBKeyRange.lowerBound([this.userId,i]);let a=null;return rn(n).Kt({index:me.userMutationsIndex,range:o},(u,c,l)=>{c.userId===this.userId&&(z(c.batchId>=i),a=yr(this.N,c)),l.done()}).next(()=>a)}getHighestUnacknowledgedBatchId(n){const r=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let i=-1;return rn(n).Kt({index:me.userMutationsIndex,range:r,reverse:!0},(o,a,u)=>{i=a.batchId,u.done()}).next(()=>i)}getAllMutationBatches(n){const r=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return rn(n).Lt(me.userMutationsIndex,r).next(i=>i.map(o=>yr(this.N,o)))}getAllMutationBatchesAffectingDocumentKey(n,r){const i=it.prefixForPath(this.userId,r.path),o=IDBKeyRange.lowerBound(i),a=[];return vr(n).Kt({range:o},(u,c,l)=>{const[h,d,g]=u,_=Gt(d);if(h===this.userId&&r.path.isEqual(_))return rn(n).get(g).next(E=>{if(!E)throw B();z(E.userId===this.userId),a.push(yr(this.N,E))});l.done()}).next(()=>a)}getAllMutationBatchesAffectingDocumentKeys(n,r){let i=new Te(te);const o=[];return r.forEach(a=>{const u=it.prefixForPath(this.userId,a.path),c=IDBKeyRange.lowerBound(u),l=vr(n).Kt({range:c},(h,d,g)=>{const[_,E,b]=h,M=Gt(E);_===this.userId&&a.path.isEqual(M)?i=i.add(b):g.done()});o.push(l)}),S.waitFor(o).next(()=>this.Zt(n,i))}getAllMutationBatchesAffectingQuery(n,r){const i=r.path,o=i.length+1,a=it.prefixForPath(this.userId,i),u=IDBKeyRange.lowerBound(a);let c=new Te(te);return vr(n).Kt({range:u},(l,h,d)=>{const[g,_,E]=l,b=Gt(_);g===this.userId&&i.isPrefixOf(b)?b.length===o&&(c=c.add(E)):d.done()}).next(()=>this.Zt(n,c))}Zt(n,r){const i=[],o=[];return r.forEach(a=>{o.push(rn(n).get(a).next(u=>{if(null===u)throw B();z(u.userId===this.userId),i.push(yr(this.N,u))}))}),S.waitFor(o).next(()=>i)}removeMutationBatch(n,r){return zl(n.Qt,this.userId,r).next(i=>(n.addOnCommittedListener(()=>{this.te(r.batchId)}),S.forEach(i,o=>this.referenceDelegate.markPotentiallyOrphaned(n,o))))}te(n){delete this.Jt[n]}performConsistencyCheck(n){return this.checkEmpty(n).next(r=>{if(!r)return S.resolve();const i=IDBKeyRange.lowerBound(it.prefixForUser(this.userId)),o=[];return vr(n).Kt({range:i},(a,u,c)=>{if(a[0]===this.userId){const l=Gt(a[1]);o.push(l)}else c.done()}).next(()=>{z(0===o.length)})})}containsKey(n,r){return Wl(n,this.userId,r)}ee(n){return Zl(n).get(this.userId).next(r=>r||new tn(this.userId,-1,""))}}function Wl(s,n,r){const i=it.prefixForPath(n,r.path),o=i[1],a=IDBKeyRange.lowerBound(i);let u=!1;return vr(s).Kt({range:a,qt:!0},(c,l,h)=>{const[d,g,_]=c;d===n&&g===o&&(u=!0),h.done()}).next(()=>u)}function rn(s){return ft(s,me.store)}function vr(s){return ft(s,it.store)}function Zl(s){return ft(s,tn.store)}class Cn{constructor(n){this.ne=n}next(){return this.ne+=2,this.ne}static se(){return new Cn(0)}static ie(){return new Cn(-1)}}class Og{constructor(n,r){this.referenceDelegate=n,this.N=r}allocateTargetId(n){return this.re(n).next(r=>{const i=new Cn(r.highestTargetId);return r.highestTargetId=i.next(),this.oe(n,r).next(()=>r.highestTargetId)})}getLastRemoteSnapshotVersion(n){return this.re(n).next(r=>Q.fromTimestamp(new je(r.lastRemoteSnapshotVersion.seconds,r.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(n){return this.re(n).next(r=>r.highestListenSequenceNumber)}setTargetsMetadata(n,r,i){return this.re(n).next(o=>(o.highestListenSequenceNumber=r,i&&(o.lastRemoteSnapshotVersion=i.toTimestamp()),r>o.highestListenSequenceNumber&&(o.highestListenSequenceNumber=r),this.oe(n,o)))}addTargetData(n,r){return this.ae(n,r).next(()=>this.re(n).next(i=>(i.targetCount+=1,this.ce(r,i),this.oe(n,i))))}updateTargetData(n,r){return this.ae(n,r)}removeTargetData(n,r){return this.removeMatchingKeysForTargetId(n,r.targetId).next(()=>wr(n).delete(r.targetId)).next(()=>this.re(n)).next(i=>(z(i.targetCount>0),i.targetCount-=1,this.oe(n,i)))}removeTargets(n,r,i){let o=0;const a=[];return wr(n).Kt((u,c)=>{const l=Ss(c);l.sequenceNumber<=r&&null===i.get(l.targetId)&&(o++,a.push(this.removeTargetData(n,l)))}).next(()=>S.waitFor(a)).next(()=>o)}forEachTarget(n,r){return wr(n).Kt((i,o)=>{const a=Ss(o);r(a)})}re(n){return Hl(n).get(_t.key).next(r=>(z(null!==r),r))}oe(n,r){return Hl(n).put(_t.key,r)}ae(n,r){return wr(n).put(ql(this.N,r))}ce(n,r){let i=!1;return n.targetId>r.highestTargetId&&(r.highestTargetId=n.targetId,i=!0),n.sequenceNumber>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=n.sequenceNumber,i=!0),i}getTargetCount(n){return this.re(n).next(r=>r.targetCount)}getTargetData(n,r){const i=hs(r),o=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]);let a=null;return wr(n).Kt({range:o,index:dt.queryTargetsIndexName},(u,c,l)=>{const h=Ss(c);di(r,h.target)&&(a=h,l.done())}).next(()=>a)}addMatchingKeys(n,r,i){const o=[],a=sn(n);return r.forEach(u=>{const c=Nt(u.path);o.push(a.put(new Je(i,c))),o.push(this.referenceDelegate.addReference(n,i,u))}),S.waitFor(o)}removeMatchingKeys(n,r,i){const o=sn(n);return S.forEach(r,a=>{const u=Nt(a.path);return S.waitFor([o.delete([i,u]),this.referenceDelegate.removeReference(n,i,a)])})}removeMatchingKeysForTargetId(n,r){const i=sn(n),o=IDBKeyRange.bound([r],[r+1],!1,!0);return i.delete(o)}getMatchingKeysForTargetId(n,r){const i=IDBKeyRange.bound([r],[r+1],!1,!0),o=sn(n);let a=ce();return o.Kt({range:i,qt:!0},(u,c,l)=>{const h=Gt(u[1]),d=new U(h);a=a.add(d)}).next(()=>a)}containsKey(n,r){const i=Nt(r.path),o=IDBKeyRange.bound([i],[Lc(i)],!1,!0);let a=0;return sn(n).Kt({index:Je.documentTargetsIndex,qt:!0,range:o},([u,c],l,h)=>{0!==u&&(a++,h.done())}).next(()=>a>0)}Et(n,r){return wr(n).get(r).next(i=>i?Ss(i):null)}}function wr(s){return ft(s,dt.store)}function Hl(s){return ft(s,_t.store)}function sn(s){return ft(s,Je.store)}function Dn(s){return Jo.apply(this,arguments)}function Jo(){return(Jo=(0,I.Z)(function*(s){if(s.code!==w.FAILED_PRECONDITION||s.message!==Ll)throw s;N("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}function Ql([s,n],[r,i]){const o=te(s,r);return 0===o?te(n,i):o}class Lg{constructor(n){this.ue=n,this.buffer=new Te(Ql),this.he=0}le(){return++this.he}fe(n){const r=[n,this.le()];if(this.buffer.size<this.ue)this.buffer=this.buffer.add(r);else{const i=this.buffer.last();Ql(r,i)<0&&(this.buffer=this.buffer.delete(i).add(r))}}get maxValue(){return this.buffer.last()[0]}}class Pg{constructor(n,r){this.garbageCollector=n,this.asyncQueue=r,this.de=!1,this.we=null}start(n){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this._e(n)}stop(){this.we&&(this.we.cancel(),this.we=null)}get started(){return null!==this.we}_e(n){var r=this;const i=this.de?3e5:6e4;N("LruGarbageCollector",`Garbage collection scheduled in ${i}ms`),this.we=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",i,(0,I.Z)(function*(){r.we=null,r.de=!0;try{yield n.collectGarbage(r.garbageCollector)}catch(o){An(o)?N("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",o):yield Dn(o)}yield r._e(n)}))}}class Mg{constructor(n,r){this.me=n,this.params=r}calculateTargetCount(n,r){return this.me.ge(n).next(i=>Math.floor(r/100*i))}nthSequenceNumber(n,r){if(0===r)return S.resolve(vt.T);const i=new Lg(r);return this.me.forEachTarget(n,o=>i.fe(o.sequenceNumber)).next(()=>this.me.ye(n,o=>i.fe(o))).next(()=>i.maxValue)}removeTargets(n,r,i){return this.me.removeTargets(n,r,i)}removeOrphanedDocuments(n,r){return this.me.removeOrphanedDocuments(n,r)}collect(n,r){return-1===this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve($l)):this.getCacheSize(n).next(i=>i<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),$l):this.pe(n,r))}getCacheSize(n){return this.me.getCacheSize(n)}pe(n,r){let i,o,a,u,c,l,h;const d=Date.now();return this.calculateTargetCount(n,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),o=this.params.maximumSequenceNumbersToCollect):o=g,u=Date.now(),this.nthSequenceNumber(n,o))).next(g=>(i=g,c=Date.now(),this.removeTargets(n,i,r))).next(g=>(a=g,l=Date.now(),this.removeOrphanedDocuments(n,i))).next(g=>(h=Date.now(),No()<=tt.in.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${u-d}ms\n\tDetermined least recently used ${o} in `+(c-u)+`ms\n\tRemoved ${a} targets in `+(l-c)+`ms\n\tRemoved ${g} documents in `+(h-l)+`ms\nTotal Duration: ${h-d}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:o,targetsRemoved:a,documentsRemoved:g})))}}class Fg{constructor(n,r){this.db=n,this.garbageCollector=new Mg(this,r)}ge(n){const r=this.Ee(n);return this.db.getTargetCache().getTargetCount(n).next(i=>r.next(o=>i+o))}Ee(n){let r=0;return this.ye(n,i=>{r++}).next(()=>r)}forEachTarget(n,r){return this.db.getTargetCache().forEachTarget(n,r)}ye(n,r){return this.Te(n,(i,o)=>r(o))}addReference(n,r,i){return bi(n,i)}removeReference(n,r,i){return bi(n,i)}removeTargets(n,r,i){return this.db.getTargetCache().removeTargets(n,r,i)}markPotentiallyOrphaned(n,r){return bi(n,r)}Ie(n,r){return function(i,o){let a=!1;return Zl(i).jt(u=>Wl(i,u,o).next(c=>(c&&(a=!0),S.resolve(!c)))).next(()=>a)}(n,r)}removeOrphanedDocuments(n,r){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),o=[];let a=0;return this.Te(n,(u,c)=>{if(c<=r){const l=this.Ie(n,u).next(h=>{if(!h)return a++,i.getEntry(n,u).next(()=>(i.removeEntry(u),sn(n).delete([0,Nt(u.path)])))});o.push(l)}}).next(()=>S.waitFor(o)).next(()=>i.apply(n)).next(()=>a)}removeTarget(n,r){const i=r.withSequenceNumber(n.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(n,i)}updateLimboDocument(n,r){return bi(n,r)}Te(n,r){const i=sn(n);let o,a=vt.T;return i.Kt({index:Je.documentTargetsIndex},([u,c],{path:l,sequenceNumber:h})=>{0===u?(a!==vt.T&&r(new U(Gt(o)),a),a=h,o=l):a=vt.T}).next(()=>{a!==vt.T&&r(new U(Gt(o)),a)})}getCacheSize(n){return this.db.getRemoteDocumentCache().getSize(n)}}function bi(s,n){return sn(s).put((i=s.currentSequenceNumber,new Je(0,Nt(n.path),i)));var i}class _r{constructor(n,r){this.mapKeyFn=n,this.equalsFn=r,this.inner={}}get(n){const r=this.mapKeyFn(n),i=this.inner[r];if(void 0!==i)for(const[o,a]of i)if(this.equalsFn(o,n))return a}has(n){return void 0!==this.get(n)}set(n,r){const i=this.mapKeyFn(n),o=this.inner[i];if(void 0!==o){for(let a=0;a<o.length;a++)if(this.equalsFn(o[a][0],n))return void(o[a]=[n,r]);o.push([n,r])}else this.inner[i]=[[n,r]]}delete(n){const r=this.mapKeyFn(n),i=this.inner[r];if(void 0===i)return!1;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],n))return 1===i.length?delete this.inner[r]:i.splice(o,1),!0;return!1}forEach(n){In(this.inner,(r,i)=>{for(const[o,a]of i)n(o,a)})}isEmpty(){return Mc(this.inner)}}class Yl{constructor(){this.changes=new _r(n=>n.toString(),(n,r)=>n.isEqual(r)),this.changesApplied=!1}getReadTime(n){const r=this.changes.get(n);return r?r.readTime:Q.min()}addEntry(n,r){this.assertNotApplied(),this.changes.set(n.key,{document:n,readTime:r})}removeEntry(n,r=null){this.assertNotApplied(),this.changes.set(n,{document:ve.newInvalidDocument(n),readTime:r})}getEntry(n,r){this.assertNotApplied();const i=this.changes.get(r);return void 0!==i?S.resolve(i.document):this.getFromCache(n,r)}getEntries(n,r){return this.getAllFromCache(n,r)}apply(n){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(n)}assertNotApplied(){}}class Ug{constructor(n,r){this.N=n,this.Ht=r}addEntry(n,r,i){return on(n).put(Ai(r),i)}removeEntry(n,r){const i=on(n),o=Ai(r);return i.delete(o)}updateMetadata(n,r){return this.getMetadata(n).next(i=>(i.byteSize+=r,this.Ae(n,i)))}getEntry(n,r){return on(n).get(Ai(r)).next(i=>this.Re(r,i))}be(n,r){return on(n).get(Ai(r)).next(i=>({document:this.Re(r,i),size:xi(i)}))}getEntries(n,r){let i=St();return this.Pe(n,r,(o,a)=>{const u=this.Re(o,a);i=i.insert(o,u)}).next(()=>i)}ve(n,r){let i=St(),o=new Pe(U.comparator);return this.Pe(n,r,(a,u)=>{const c=this.Re(a,u);i=i.insert(a,c),o=o.insert(a,xi(u))}).next(()=>({documents:i,Ve:o}))}Pe(n,r,i){if(r.isEmpty())return S.resolve();const o=IDBKeyRange.bound(r.first().path.toArray(),r.last().path.toArray()),a=r.getIterator();let u=a.getNext();return on(n).Kt({range:o},(c,l,h)=>{const d=U.fromSegments(c);for(;u&&U.comparator(u,d)<0;)i(u,null),u=a.getNext();u&&u.isEqual(d)&&(i(u,l),u=a.hasNext()?a.getNext():null),u?h.Mt(u.path.toArray()):h.done()}).next(()=>{for(;u;)i(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(n,r,i){let o=St();const a=r.path.length+1,u={};if(i.isEqual(Q.min())){const c=r.path.toArray();u.range=IDBKeyRange.lowerBound(c)}else{const c=r.path.toArray(),l=Zo(i);u.range=IDBKeyRange.lowerBound([c,l],!0),u.index=Se.collectionReadTimeIndex}return on(n).Kt(u,(c,l,h)=>{if(c.length!==a)return;const d=Wo(this.N,l);r.path.isPrefixOf(d.key.path)?gs(r,d)&&(o=o.insert(d.key,d)):h.done()}).next(()=>o)}newChangeBuffer(n){return new Vg(this,!!n&&n.trackRemovals)}getSize(n){return this.getMetadata(n).next(r=>r.byteSize)}getMetadata(n){return Jl(n).get(Ft.key).next(r=>(z(!!r),r))}Ae(n,r){return Jl(n).put(Ft.key,r)}Re(n,r){if(r){const i=Wo(this.N,r);if(!i.isNoDocument()||!i.version.isEqual(Q.min()))return i}return ve.newInvalidDocument(n)}}class Vg extends Yl{constructor(n,r){super(),this.Se=n,this.trackRemovals=r,this.De=new _r(i=>i.toString(),(i,o)=>i.isEqual(o))}applyChanges(n){const r=[];let i=0,o=new Te((a,u)=>te(a.canonicalString(),u.canonicalString()));return this.changes.forEach((a,u)=>{const c=this.De.get(a);if(u.document.isValidDocument()){const l=Vl(this.Se.N,u.document,this.getReadTime(a));o=o.add(a.path.popLast()),i+=xi(l)-c,r.push(this.Se.addEntry(n,a,l))}else if(i-=c,this.trackRemovals){const l=Vl(this.Se.N,ve.newNoDocument(a,Q.min()),this.getReadTime(a));r.push(this.Se.addEntry(n,a,l))}else r.push(this.Se.removeEntry(n,a))}),o.forEach(a=>{r.push(this.Se.Ht.addToCollectionParentIndex(n,a))}),r.push(this.Se.updateMetadata(n,i)),S.waitFor(r)}getFromCache(n,r){return this.Se.be(n,r).next(i=>(this.De.set(r,i.size),i.document))}getAllFromCache(n,r){return this.Se.ve(n,r).next(({documents:i,Ve:o})=>(o.forEach((a,u)=>{this.De.set(a,u)}),i))}}function Jl(s){return ft(s,Ft.store)}function on(s){return ft(s,Se.store)}function Ai(s){return s.path.toArray()}class Bg{constructor(n){this.N=n}Ct(n,r,i,o){z(i<o&&i>=0&&o<=11);const a=new Si("createOrUpgrade",r);var c;i<1&&o>=1&&(n.createObjectStore(wt.store),(c=n).createObjectStore(tn.store,{keyPath:tn.keyPath}),c.createObjectStore(me.store,{keyPath:me.keyPath,autoIncrement:!0}).createIndex(me.userMutationsIndex,me.userMutationsKeyPath,{unique:!0}),c.createObjectStore(it.store),Xl(n),function(c){c.createObjectStore(Se.store)}(n));let u=S.resolve();return i<3&&o>=3&&(0!==i&&(function(c){c.deleteObjectStore(Je.store),c.deleteObjectStore(dt.store),c.deleteObjectStore(_t.store)}(n),Xl(n)),u=u.next(()=>function(c){const l=c.store(_t.store),h=new _t(0,0,Q.min().toTimestamp(),0);return l.put(_t.key,h)}(a))),i<4&&o>=4&&(0!==i&&(u=u.next(()=>function(c,l){return l.store(me.store).Lt().next(h=>{c.deleteObjectStore(me.store),c.createObjectStore(me.store,{keyPath:me.keyPath,autoIncrement:!0}).createIndex(me.userMutationsIndex,me.userMutationsKeyPath,{unique:!0});const d=l.store(me.store),g=h.map(_=>d.put(_));return S.waitFor(g)})}(n,a))),u=u.next(()=>{!function(c){c.createObjectStore($t.store,{keyPath:$t.keyPath})}(n)})),i<5&&o>=5&&(u=u.next(()=>this.Ce(a))),i<6&&o>=6&&(u=u.next(()=>(function(c){c.createObjectStore(Ft.store)}(n),this.Ne(a)))),i<7&&o>=7&&(u=u.next(()=>this.xe(a))),i<8&&o>=8&&(u=u.next(()=>this.ke(n,a))),i<9&&o>=9&&(u=u.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(n),function(c){const l=c.objectStore(Se.store);l.createIndex(Se.readTimeIndex,Se.readTimeIndexPath,{unique:!1}),l.createIndex(Se.collectionReadTimeIndex,Se.collectionReadTimeIndexPath,{unique:!1})}(r)})),i<10&&o>=10&&(u=u.next(()=>this.$e(a))),i<11&&o>=11&&(u=u.next(()=>{(function(c){c.createObjectStore(fr.store,{keyPath:fr.keyPath})})(n),function(c){c.createObjectStore(gr.store,{keyPath:gr.keyPath})}(n)})),u}Ne(n){let r=0;return n.store(Se.store).Kt((i,o)=>{r+=xi(o)}).next(()=>{const i=new Ft(r);return n.store(Ft.store).put(Ft.key,i)})}Ce(n){const r=n.store(tn.store),i=n.store(me.store);return r.Lt().next(o=>S.forEach(o,a=>{const u=IDBKeyRange.bound([a.userId,-1],[a.userId,a.lastAcknowledgedBatchId]);return i.Lt(me.userMutationsIndex,u).next(c=>S.forEach(c,l=>{z(l.userId===a.userId);const h=yr(this.N,l);return zl(n,a.userId,h).next(()=>{})}))}))}xe(n){const r=n.store(Je.store),i=n.store(Se.store);return n.store(_t.store).get(_t.key).next(o=>{const a=[];return i.Kt((u,c)=>{const l=new ue(u),h=[0,Nt(l)];a.push(r.get(h).next(d=>d?S.resolve():r.put(new Je(0,Nt(l),o.highestListenSequenceNumber))))}).next(()=>S.waitFor(a))})}ke(n,r){n.createObjectStore(bn.store,{keyPath:bn.keyPath});const i=r.store(bn.store),o=new Qo,a=u=>{if(o.add(u)){const c=u.lastSegment(),l=u.popLast();return i.put({collectionId:c,parent:Nt(l)})}};return r.store(Se.store).Kt({qt:!0},(u,c)=>{const l=new ue(u);return a(l.popLast())}).next(()=>r.store(it.store).Kt({qt:!0},([u,c,l],h)=>{const d=Gt(c);return a(d.popLast())}))}$e(n){const r=n.store(dt.store);return r.Kt((i,o)=>{const a=Ss(o),u=ql(this.N,a);return r.put(u)})}}function Xl(s){s.createObjectStore(Je.store,{keyPath:Je.keyPath}).createIndex(Je.documentTargetsIndex,Je.documentTargetsKeyPath,{unique:!0}),s.createObjectStore(dt.store,{keyPath:dt.keyPath}).createIndex(dt.queryTargetsIndexName,dt.queryTargetsKeyPath,{unique:!0}),s.createObjectStore(_t.store)}const Xo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class ea{constructor(n,r,i,o,a,u,c,l,h,d){if(this.allowTabSynchronization=n,this.persistenceKey=r,this.clientId=i,this.Oe=a,this.window=u,this.document=c,this.Fe=h,this.Me=d,this.Le=null,this.Be=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ue=null,this.inForeground=!1,this.qe=null,this.Ke=null,this.je=Number.NEGATIVE_INFINITY,this.Qe=g=>Promise.resolve(),!ea.bt())throw new x(w.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Fg(this,o),this.We=r+"main",this.N=new Ul(l),this.Ge=new Ct(this.We,11,new Bg(this.N)),this.ze=new Og(this.referenceDelegate,this.N),this.Ht=new Rg,this.He=new Ug(this.N,this.Ht),this.Je=new Dg,this.window&&this.window.localStorage?this.Ye=this.window.localStorage:(this.Ye=null,!1===d&&Ce("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Xe().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(w.FAILED_PRECONDITION,Xo);return this.Ze(),this.tn(),this.en(),this.runTransaction("getHighestListenSequenceNumber","readonly",n=>this.ze.getHighestSequenceNumber(n))}).then(n=>{this.Le=new vt(n,this.Fe)}).then(()=>{this.Be=!0}).catch(n=>(this.Ge&&this.Ge.close(),Promise.reject(n)))}nn(n){var r=this;return this.Qe=function(){var i=(0,I.Z)(function*(o){if(r.started)return n(o)});return function(o){return i.apply(this,arguments)}}(),n(this.isPrimary)}setDatabaseDeletedListener(n){this.Ge.xt(function(){var r=(0,I.Z)(function*(i){null===i.newVersion&&(yield n())});return function(i){return r.apply(this,arguments)}}())}setNetworkEnabled(n){var r=this;this.networkEnabled!==n&&(this.networkEnabled=n,this.Oe.enqueueAndForget((0,I.Z)(function*(){r.started&&(yield r.Xe())})))}Xe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",n=>Ni(n).put(new $t(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.sn(n).next(r=>{r||(this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)))})}).next(()=>this.rn(n)).next(r=>this.isPrimary&&!r?this.on(n).next(()=>!1):!!r&&this.an(n).next(()=>!0))).catch(n=>{if(An(n))return N("IndexedDbPersistence","Failed to extend owner lease: ",n),this.isPrimary;if(!this.allowTabSynchronization)throw n;return N("IndexedDbPersistence","Releasing owner lease after error during lease refresh",n),!1}).then(n=>{this.isPrimary!==n&&this.Oe.enqueueRetryable(()=>this.Qe(n)),this.isPrimary=n})}sn(n){return xs(n).get(wt.key).next(r=>S.resolve(this.cn(r)))}un(n){return Ni(n).delete(this.clientId)}hn(){var n=this;return(0,I.Z)(function*(){if(n.isPrimary&&!n.ln(n.je,18e5)){n.je=Date.now();const r=yield n.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",i=>{const o=ft(i,$t.store);return o.Lt().next(a=>{const u=n.fn(a,18e5),c=a.filter(l=>-1===u.indexOf(l));return S.forEach(c,l=>o.delete(l.clientId)).next(()=>c)})}).catch(()=>[]);if(n.Ye)for(const i of r)n.Ye.removeItem(n.dn(i.clientId))}})()}en(){this.Ke=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Xe().then(()=>this.hn()).then(()=>this.en()))}cn(n){return!!n&&n.ownerId===this.clientId}rn(n){return this.Me?S.resolve(!0):xs(n).get(wt.key).next(r=>{if(null!==r&&this.ln(r.leaseTimestampMs,5e3)&&!this.wn(r.ownerId)){if(this.cn(r)&&this.networkEnabled)return!0;if(!this.cn(r)){if(!r.allowTabSynchronization)throw new x(w.FAILED_PRECONDITION,Xo);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ni(n).Lt().next(i=>void 0===this.fn(i,5e3).find(o=>{if(this.clientId!==o.clientId){const u=!this.inForeground&&o.inForeground,c=this.networkEnabled===o.networkEnabled;if(!this.networkEnabled&&o.networkEnabled||u&&c)return!0}return!1}))}).next(r=>(this.isPrimary!==r&&N("IndexedDbPersistence",`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){var n=this;return(0,I.Z)(function*(){n.Be=!1,n._n(),n.Ke&&(n.Ke.cancel(),n.Ke=null),n.mn(),n.gn(),yield n.Ge.runTransaction("shutdown","readwrite",[wt.store,$t.store],r=>{const i=new Fl(r,vt.T);return n.on(i).next(()=>n.un(i))}),n.Ge.close(),n.yn()})()}fn(n,r){return n.filter(i=>this.ln(i.updateTimeMs,r)&&!this.wn(i.clientId))}pn(){return this.runTransaction("getActiveClients","readonly",n=>Ni(n).Lt().next(r=>this.fn(r,18e5).map(i=>i.clientId)))}get started(){return this.Be}getMutationQueue(n){return Yo.Yt(n,this.N,this.Ht,this.referenceDelegate)}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getIndexManager(){return this.Ht}getBundleCache(){return this.Je}runTransaction(n,r,i){let a;return N("IndexedDbPersistence","Starting transaction:",n),this.Ge.runTransaction(n,"readonly"===r?"readonly":"readwrite",Ag,u=>(a=new Fl(u,this.Le?this.Le.next():vt.T),"readwrite-primary"===r?this.sn(a).next(c=>!!c||this.rn(a)).next(c=>{if(!c)throw Ce(`Failed to obtain primary lease for action '${n}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)),new x(w.FAILED_PRECONDITION,Ll);return i(a)}).next(c=>this.an(a).next(()=>c)):this.En(a).next(()=>i(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}En(n){return xs(n).get(wt.key).next(r=>{if(null!==r&&this.ln(r.leaseTimestampMs,5e3)&&!this.wn(r.ownerId)&&!this.cn(r)&&!(this.Me||this.allowTabSynchronization&&r.allowTabSynchronization))throw new x(w.FAILED_PRECONDITION,Xo)})}an(n){const r=new wt(this.clientId,this.allowTabSynchronization,Date.now());return xs(n).put(wt.key,r)}static bt(){return Ct.bt()}on(n){const r=xs(n);return r.get(wt.key).next(i=>this.cn(i)?(N("IndexedDbPersistence","Releasing primary lease."),r.delete(wt.key)):S.resolve())}ln(n,r){const i=Date.now();return!(n<i-r||n>i&&(Ce(`Detected an update time that is in the future: ${n} > ${i}`),1))}Ze(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=()=>{this.Oe.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Xe()))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)}mn(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)}tn(){var n;"function"==typeof(null===(n=this.window)||void 0===n?void 0:n.addEventListener)&&(this.Ue=()=>{this._n(),(0,Y.G6)()&&navigator.appVersion.match("Version/14")&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ue))}gn(){this.Ue&&(this.window.removeEventListener("pagehide",this.Ue),this.Ue=null)}wn(n){var r;try{const i=null!==(null===(r=this.Ye)||void 0===r?void 0:r.getItem(this.dn(n)));return N("IndexedDbPersistence",`Client '${n}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return Ce("IndexedDbPersistence","Failed to get zombied client id.",i),!1}}_n(){if(this.Ye)try{this.Ye.setItem(this.dn(this.clientId),String(Date.now()))}catch(n){Ce("Failed to set zombie client id.",n)}}yn(){if(this.Ye)try{this.Ye.removeItem(this.dn(this.clientId))}catch(n){}}dn(n){return`firestore_zombie_${this.persistenceKey}_${n}`}}function xs(s){return ft(s,wt.store)}function Ni(s){return ft(s,$t.store)}function ta(s,n){let r=s.projectId;return s.isDefaultDatabase||(r+="."+s.database),"firestore/"+n+"/"+r+"/"}class qg{constructor(n,r){this.progress=n,this.Tn=r}}class eh{constructor(n,r,i){this.He=n,this.In=r,this.Ht=i}An(n,r){return this.In.getAllMutationBatchesAffectingDocumentKey(n,r).next(i=>this.Rn(n,r,i))}Rn(n,r,i){return this.He.getEntry(n,r).next(o=>{for(const a of i)a.applyToLocalView(o);return o})}bn(n,r){n.forEach((i,o)=>{for(const a of r)a.applyToLocalView(o)})}Pn(n,r){return this.He.getEntries(n,r).next(i=>this.vn(n,i).next(()=>i))}vn(n,r){return this.In.getAllMutationBatchesAffectingDocumentKeys(n,r).next(i=>this.bn(r,i))}getDocumentsMatchingQuery(n,r,i){return U.isDocumentKey((o=r).path)&&null===o.collectionGroup&&0===o.filters.length?this.Vn(n,r.path):Fo(r)?this.Sn(n,r,i):this.Dn(n,r,i);var o}Vn(n,r){return this.An(n,new U(r)).next(i=>{let o=qo();return i.isFoundDocument()&&(o=o.insert(i.key,i)),o})}Sn(n,r,i){const o=r.collectionGroup;let a=qo();return this.Ht.getCollectionParents(n,o).next(u=>S.forEach(u,c=>{const l=(h=r,d=c.child(o),new Kt(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt));var h,d;return this.Dn(n,l,i).next(h=>{h.forEach((d,g)=>{a=a.insert(d,g)})})}).next(()=>a))}Dn(n,r,i){let o,a;return this.He.getDocumentsMatchingQuery(n,r,i).next(u=>(o=u,this.In.getAllMutationBatchesAffectingQuery(n,r))).next(u=>(a=u,this.Cn(n,a,o).next(c=>{o=c;for(const l of a)for(const h of l.mutations){const d=h.key;let g=o.get(d);null==g&&(g=ve.newInvalidDocument(d),o=o.insert(d,g)),Vo(h,g,l.localWriteTime),g.isFoundDocument()||(o=o.remove(d))}}))).next(()=>(o.forEach((u,c)=>{gs(r,c)||(o=o.remove(u))}),o))}Cn(n,r,i){let o=ce();for(const u of r)for(const c of u.mutations)c instanceof en&&null===i.get(c.key)&&(o=o.add(c.key));let a=i;return this.He.getEntries(n,o).next(u=>(u.forEach((c,l)=>{l.isFoundDocument()&&(a=a.insert(c,l))}),a))}}class na{constructor(n,r,i,o){this.targetId=n,this.fromCache=r,this.Nn=i,this.xn=o}static kn(n,r){let i=ce(),o=ce();for(const a of r.docChanges)switch(a.type){case 0:i=i.add(a.doc.key);break;case 1:o=o.add(a.doc.key)}return new na(n,r.fromCache,i,o)}}class th{$n(n){this.On=n}getDocumentsMatchingQuery(n,r,i,o){return 0===(a=r).filters.length&&null===a.limit&&null==a.startAt&&null==a.endAt&&(0===a.explicitOrderBy.length||1===a.explicitOrderBy.length&&a.explicitOrderBy[0].field.isKeyField())||i.isEqual(Q.min())?this.Fn(n,r):this.On.Pn(n,o).next(a=>{const u=this.Mn(r,a);return(mi(r)||pi(r))&&this.Ln(r.limitType,u,o,i)?this.Fn(n,r):(No()<=tt.in.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Uo(r)),this.On.getDocumentsMatchingQuery(n,r,i).next(c=>(u.forEach(l=>{c=c.insert(l.key,l)}),c)))});var a}Mn(n,r){let i=new Te(Qc(n));return r.forEach((o,a)=>{gs(n,a)&&(i=i.add(a))}),i}Ln(n,r,i,o){if(i.size!==r.size)return!0;const a="F"===n?r.last():r.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(o)>0)}Fn(n,r){return No()<=tt.in.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",Uo(r)),this.On.getDocumentsMatchingQuery(n,r,Q.min())}}class jg{constructor(n,r,i,o){this.persistence=n,this.Bn=r,this.N=o,this.Un=new Pe(te),this.qn=new _r(a=>hs(a),di),this.Kn=Q.min(),this.In=n.getMutationQueue(i),this.jn=n.getRemoteDocumentCache(),this.ze=n.getTargetCache(),this.Qn=new eh(this.jn,this.In,this.persistence.getIndexManager()),this.Je=n.getBundleCache(),this.Bn.$n(this.Qn)}collectGarbage(n){return this.persistence.runTransaction("Collect garbage","readwrite-primary",r=>n.collect(r,this.Un))}}function nh(s,n,r,i){return new jg(s,n,r,i)}function rh(s,n){return ra.apply(this,arguments)}function ra(){return(ra=(0,I.Z)(function*(s,n){const r=k(s);let i=r.In,o=r.Qn;const a=yield r.persistence.runTransaction("Handle user change","readonly",u=>{let c;return r.In.getAllMutationBatches(u).next(l=>(c=l,i=r.persistence.getMutationQueue(n),o=new eh(r.jn,i,r.persistence.getIndexManager()),i.getAllMutationBatches(u))).next(l=>{const h=[],d=[];let g=ce();for(const _ of c){h.push(_.batchId);for(const E of _.mutations)g=g.add(E.key)}for(const _ of l){d.push(_.batchId);for(const E of _.mutations)g=g.add(E.key)}return o.Pn(u,g).next(_=>({Wn:_,removedBatchIds:h,addedBatchIds:d}))})});return r.In=i,r.Qn=o,r.Bn.$n(r.Qn),a})).apply(this,arguments)}function Kg(s,n){const r=k(s);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const o=n.batch.keys(),a=r.jn.newChangeBuffer({trackRemovals:!0});return function(u,c,l,h){const d=l.batch,g=d.keys();let _=S.resolve();return g.forEach(E=>{_=_.next(()=>h.getEntry(c,E)).next(b=>{const M=l.docVersions.get(E);z(null!==M),b.version.compareTo(M)<0&&(d.applyToRemoteDocument(b,l),b.isValidDocument()&&h.addEntry(b,l.commitVersion))})}),_.next(()=>u.In.removeMutationBatch(c,d))}(r,i,n,a).next(()=>a.apply(i)).next(()=>r.In.performConsistencyCheck(i)).next(()=>r.Qn.Pn(i,o))})}function sh(s){const n=k(s);return n.persistence.runTransaction("Get last remote snapshot version","readonly",r=>n.ze.getLastRemoteSnapshotVersion(r))}function Gg(s,n){const r=k(s),i=n.snapshotVersion;let o=r.Un;return r.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const u=r.jn.newChangeBuffer({trackRemovals:!0});o=r.Un;const c=[];n.targetChanges.forEach((h,d)=>{const g=o.get(d);if(!g)return;c.push(r.ze.removeMatchingKeys(a,h.removedDocuments,d).next(()=>r.ze.addMatchingKeys(a,h.addedDocuments,d)));const _=h.resumeToken;if(_.approximateByteSize()>0){const E=g.withResumeToken(_,i).withSequenceNumber(a.currentSequenceNumber);o=o.insert(d,E),b=g,W=h,z((M=E).resumeToken.approximateByteSize()>0),(0===b.resumeToken.approximateByteSize()||M.snapshotVersion.toMicroseconds()-b.snapshotVersion.toMicroseconds()>=3e8||W.addedDocuments.size+W.modifiedDocuments.size+W.removedDocuments.size>0)&&c.push(r.ze.updateTargetData(a,E))}var b,M,W});let l=St();if(n.documentUpdates.forEach((h,d)=>{n.resolvedLimboDocuments.has(h)&&c.push(r.persistence.referenceDelegate.updateLimboDocument(a,h))}),c.push(ih(a,u,n.documentUpdates,i,void 0).next(h=>{l=h})),!i.isEqual(Q.min())){const h=r.ze.getLastRemoteSnapshotVersion(a).next(d=>r.ze.setTargetsMetadata(a,a.currentSequenceNumber,i));c.push(h)}return S.waitFor(c).next(()=>u.apply(a)).next(()=>r.Qn.vn(a,l)).next(()=>l)}).then(a=>(r.Un=o,a))}function ih(s,n,r,i,o){let a=ce();return r.forEach(u=>a=a.add(u)),n.getEntries(s,a).next(u=>{let c=St();return r.forEach((l,h)=>{const d=u.get(l),g=(null==o?void 0:o.get(l))||i;h.isNoDocument()&&h.version.isEqual(Q.min())?(n.removeEntry(l,g),c=c.insert(l,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||0===h.version.compareTo(d.version)&&d.hasPendingWrites?(n.addEntry(h,g),c=c.insert(l,h)):N("LocalStore","Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",h.version)}),c})}function $g(s,n){const r=k(s);return r.persistence.runTransaction("Get next mutation batch","readonly",i=>(void 0===n&&(n=-1),r.In.getNextMutationBatchAfterBatchId(i,n)))}function Ir(s,n){const r=k(s);return r.persistence.runTransaction("Allocate target","readwrite",i=>{let o;return r.ze.getTargetData(i,n).next(a=>a?(o=a,S.resolve(o)):r.ze.allocateTargetId(i).next(u=>(o=new nn(n,u,0,i.currentSequenceNumber),r.ze.addTargetData(i,o).next(()=>o))))}).then(i=>{const o=r.Un.get(i.targetId);return(null===o||i.snapshotVersion.compareTo(o.snapshotVersion)>0)&&(r.Un=r.Un.insert(i.targetId,i),r.qn.set(n,i.targetId)),i})}function Er(s,n,r){return sa.apply(this,arguments)}function sa(){return(sa=(0,I.Z)(function*(s,n,r){const i=k(s),o=i.Un.get(n),a=r?"readwrite":"readwrite-primary";try{r||(yield i.persistence.runTransaction("Release target",a,u=>i.persistence.referenceDelegate.removeTarget(u,o)))}catch(u){if(!An(u))throw u;N("LocalStore",`Failed to update sequence numbers for target ${n}: ${u}`)}i.Un=i.Un.remove(n),i.qn.delete(o.target)})).apply(this,arguments)}function Ci(s,n,r){const i=k(s);let o=Q.min(),a=ce();return i.persistence.runTransaction("Execute query","readonly",u=>function(c,l,h){const d=k(c),g=d.qn.get(h);return void 0!==g?S.resolve(d.Un.get(g)):d.ze.getTargetData(l,h)}(i,u,Tt(n)).next(c=>{if(c)return o=c.lastLimboFreeSnapshotVersion,i.ze.getMatchingKeysForTargetId(u,c.targetId).next(l=>{a=l})}).next(()=>i.Bn.getDocumentsMatchingQuery(u,n,r?o:Q.min(),r?a:ce())).next(c=>({documents:c,Gn:a})))}function oh(s,n){const r=k(s),i=k(r.ze),o=r.Un.get(n);return o?Promise.resolve(o.target):r.persistence.runTransaction("Get target data","readonly",a=>i.Et(a,n).next(u=>u?u.target:null))}function ah(s){const n=k(s);return n.persistence.runTransaction("Get new document changes","readonly",r=>function(i,o,a){const u=k(i);let c=St(),l=Zo(a);const h=on(o),d=IDBKeyRange.lowerBound(l,!0);return h.Kt({index:Se.readTimeIndex,range:d},(g,_)=>{const E=Wo(u.N,_);c=c.insert(E.key,E),l=_.readTime}).next(()=>({Tn:c,readTime:Bl(l)}))}(n.jn,r,n.Kn)).then(({Tn:r,readTime:i})=>(n.Kn=i,r))}function ia(){return(ia=(0,I.Z)(function*(s){const n=k(s);return n.persistence.runTransaction("Synchronize last document change read time","readonly",r=>function(i){const o=on(i);let a=Q.min();return o.Kt({index:Se.readTimeIndex,reverse:!0},(u,c,l)=>{c.readTime&&(a=Bl(c.readTime)),l.done()}).next(()=>a)}(r)).then(r=>{n.Kn=r})})).apply(this,arguments)}function oa(){return(oa=(0,I.Z)(function*(s,n,r,i){const o=k(s);let a=ce(),u=St(),c=fl();for(const d of r){const g=n.zn(d.metadata.name);d.document&&(a=a.add(g)),u=u.insert(g,n.Hn(d)),c=c.insert(g,n.Jn(d.metadata.readTime))}const l=o.jn.newChangeBuffer({trackRemovals:!0}),h=yield Ir(o,(d=i,Tt(ar(ue.fromString(`__bundle__/docs/${d}`)))));var d;return o.persistence.runTransaction("Apply bundle documents","readwrite",d=>ih(d,l,u,Q.min(),c).next(g=>(l.apply(d),g)).next(g=>o.ze.removeMatchingKeysForTargetId(d,h.targetId).next(()=>o.ze.addMatchingKeys(d,a,h.targetId)).next(()=>o.Qn.vn(d,g)).next(()=>g)))})).apply(this,arguments)}function Zg(s,n){return aa.apply(this,arguments)}function aa(){return(aa=(0,I.Z)(function*(s,n,r=ce()){const i=yield Ir(s,Tt(Ho(n.bundledQuery))),o=k(s);return o.persistence.runTransaction("Save named query","readwrite",a=>{const u=Ge(n.readTime);if(i.snapshotVersion.compareTo(u)>=0)return o.Je.saveNamedQuery(a,n);const c=i.withResumeToken(Ke.EMPTY_BYTE_STRING,u);return o.Un=o.Un.insert(c.targetId,c),o.ze.updateTargetData(a,c).next(()=>o.ze.removeMatchingKeysForTargetId(a,i.targetId)).next(()=>o.ze.addMatchingKeys(a,r,i.targetId)).next(()=>o.Je.saveNamedQuery(a,n))})})).apply(this,arguments)}class Hg{constructor(n){this.N=n,this.Yn=new Map,this.Xn=new Map}getBundleMetadata(n,r){return S.resolve(this.Yn.get(r))}saveBundleMetadata(n,r){var i;return this.Yn.set(r.id,{id:(i=r).id,version:i.version,createTime:Ge(i.createTime)}),S.resolve()}getNamedQuery(n,r){return S.resolve(this.Xn.get(r))}saveNamedQuery(n,r){return this.Xn.set(r.name,{name:(i=r).name,query:Ho(i.bundledQuery),readTime:Ge(i.readTime)}),S.resolve();var i}}class ua{constructor(){this.Zn=new Te($e.ts),this.es=new Te($e.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(n,r){const i=new $e(n,r);this.Zn=this.Zn.add(i),this.es=this.es.add(i)}ss(n,r){n.forEach(i=>this.addReference(i,r))}removeReference(n,r){this.rs(new $e(n,r))}os(n,r){n.forEach(i=>this.removeReference(i,r))}cs(n){const r=new U(new ue([])),i=new $e(r,n),o=new $e(r,n+1),a=[];return this.es.forEachInRange([i,o],u=>{this.rs(u),a.push(u.key)}),a}us(){this.Zn.forEach(n=>this.rs(n))}rs(n){this.Zn=this.Zn.delete(n),this.es=this.es.delete(n)}hs(n){const r=new U(new ue([])),i=new $e(r,n),o=new $e(r,n+1);let a=ce();return this.es.forEachInRange([i,o],u=>{a=a.add(u.key)}),a}containsKey(n){const r=new $e(n,0),i=this.Zn.firstAfterOrEqual(r);return null!==i&&n.isEqual(i.key)}}class $e{constructor(n,r){this.key=n,this.ls=r}static ts(n,r){return U.comparator(n.key,r.key)||te(n.ls,r.ls)}static ns(n,r){return te(n.ls,r.ls)||U.comparator(n.key,r.key)}}class Qg{constructor(n,r){this.Ht=n,this.referenceDelegate=r,this.In=[],this.fs=1,this.ds=new Te($e.ts)}checkEmpty(n){return S.resolve(0===this.In.length)}addMutationBatch(n,r,i,o){const a=this.fs;this.fs++;const u=new $o(a,r,i,o);this.In.push(u);for(const c of o)this.ds=this.ds.add(new $e(c.key,a)),this.Ht.addToCollectionParentIndex(n,c.key.path.popLast());return S.resolve(u)}lookupMutationBatch(n,r){return S.resolve(this.ws(r))}getNextMutationBatchAfterBatchId(n,r){const o=this._s(r+1),a=o<0?0:o;return S.resolve(this.In.length>a?this.In[a]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(0===this.In.length?-1:this.fs-1)}getAllMutationBatches(n){return S.resolve(this.In.slice())}getAllMutationBatchesAffectingDocumentKey(n,r){const i=new $e(r,0),o=new $e(r,Number.POSITIVE_INFINITY),a=[];return this.ds.forEachInRange([i,o],u=>{const c=this.ws(u.ls);a.push(c)}),S.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(n,r){let i=new Te(te);return r.forEach(o=>{const a=new $e(o,0),u=new $e(o,Number.POSITIVE_INFINITY);this.ds.forEachInRange([a,u],c=>{i=i.add(c.ls)})}),S.resolve(this.gs(i))}getAllMutationBatchesAffectingQuery(n,r){const i=r.path,o=i.length+1;let a=i;U.isDocumentKey(a)||(a=a.child(""));const u=new $e(new U(a),0);let c=new Te(te);return this.ds.forEachWhile(l=>{const h=l.key.path;return!!i.isPrefixOf(h)&&(h.length===o&&(c=c.add(l.ls)),!0)},u),S.resolve(this.gs(c))}gs(n){const r=[];return n.forEach(i=>{const o=this.ws(i);null!==o&&r.push(o)}),r}removeMutationBatch(n,r){z(0===this.ys(r.batchId,"removed")),this.In.shift();let i=this.ds;return S.forEach(r.mutations,o=>{const a=new $e(o.key,r.batchId);return i=i.delete(a),this.referenceDelegate.markPotentiallyOrphaned(n,o.key)}).next(()=>{this.ds=i})}te(n){}containsKey(n,r){const i=new $e(r,0),o=this.ds.firstAfterOrEqual(i);return S.resolve(r.isEqual(o&&o.key))}performConsistencyCheck(n){return S.resolve()}ys(n,r){return this._s(n)}_s(n){return 0===this.In.length?0:n-this.In[0].batchId}ws(n){const r=this._s(n);return r<0||r>=this.In.length?null:this.In[r]}}class Yg{constructor(n,r){this.Ht=n,this.ps=r,this.docs=new Pe(U.comparator),this.size=0}addEntry(n,r,i){const o=r.key,a=this.docs.get(o),u=a?a.size:0,c=this.ps(r);return this.docs=this.docs.insert(o,{document:r.clone(),size:c,readTime:i}),this.size+=c-u,this.Ht.addToCollectionParentIndex(n,o.path.popLast())}removeEntry(n){const r=this.docs.get(n);r&&(this.docs=this.docs.remove(n),this.size-=r.size)}getEntry(n,r){const i=this.docs.get(r);return S.resolve(i?i.document.clone():ve.newInvalidDocument(r))}getEntries(n,r){let i=St();return r.forEach(o=>{const a=this.docs.get(o);i=i.insert(o,a?a.document.clone():ve.newInvalidDocument(o))}),S.resolve(i)}getDocumentsMatchingQuery(n,r,i){let o=St();const a=new U(r.path.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:c,value:{document:l,readTime:h}}=u.getNext();if(!r.path.isPrefixOf(c.path))break;h.compareTo(i)<=0||gs(r,l)&&(o=o.insert(l.key,l.clone()))}return S.resolve(o)}Es(n,r){return S.forEach(this.docs,i=>r(i))}newChangeBuffer(n){return new Jg(this)}getSize(n){return S.resolve(this.size)}}class Jg extends Yl{constructor(n){super(),this.Se=n}applyChanges(n){const r=[];return this.changes.forEach((i,o)=>{o.document.isValidDocument()?r.push(this.Se.addEntry(n,o.document,this.getReadTime(i))):this.Se.removeEntry(i)}),S.waitFor(r)}getFromCache(n,r){return this.Se.getEntry(n,r)}getAllFromCache(n,r){return this.Se.getEntries(n,r)}}class Xg{constructor(n){this.persistence=n,this.Ts=new _r(r=>hs(r),di),this.lastRemoteSnapshotVersion=Q.min(),this.highestTargetId=0,this.Is=0,this.As=new ua,this.targetCount=0,this.Rs=Cn.se()}forEachTarget(n,r){return this.Ts.forEach((i,o)=>r(o)),S.resolve()}getLastRemoteSnapshotVersion(n){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(n){return S.resolve(this.Is)}allocateTargetId(n){return this.highestTargetId=this.Rs.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(n,r,i){return i&&(this.lastRemoteSnapshotVersion=i),r>this.Is&&(this.Is=r),S.resolve()}ae(n){this.Ts.set(n.target,n);const r=n.targetId;r>this.highestTargetId&&(this.Rs=new Cn(r),this.highestTargetId=r),n.sequenceNumber>this.Is&&(this.Is=n.sequenceNumber)}addTargetData(n,r){return this.ae(r),this.targetCount+=1,S.resolve()}updateTargetData(n,r){return this.ae(r),S.resolve()}removeTargetData(n,r){return this.Ts.delete(r.target),this.As.cs(r.targetId),this.targetCount-=1,S.resolve()}removeTargets(n,r,i){let o=0;const a=[];return this.Ts.forEach((u,c)=>{c.sequenceNumber<=r&&null===i.get(c.targetId)&&(this.Ts.delete(u),a.push(this.removeMatchingKeysForTargetId(n,c.targetId)),o++)}),S.waitFor(a).next(()=>o)}getTargetCount(n){return S.resolve(this.targetCount)}getTargetData(n,r){const i=this.Ts.get(r)||null;return S.resolve(i)}addMatchingKeys(n,r,i){return this.As.ss(r,i),S.resolve()}removeMatchingKeys(n,r,i){this.As.os(r,i);const o=this.persistence.referenceDelegate,a=[];return o&&r.forEach(u=>{a.push(o.markPotentiallyOrphaned(n,u))}),S.waitFor(a)}removeMatchingKeysForTargetId(n,r){return this.As.cs(r),S.resolve()}getMatchingKeysForTargetId(n,r){const i=this.As.hs(r);return S.resolve(i)}containsKey(n,r){return S.resolve(this.As.containsKey(r))}}class em{constructor(n,r){this.bs={},this.Le=new vt(0),this.Be=!1,this.Be=!0,this.referenceDelegate=n(this),this.ze=new Xg(this),this.Ht=new kg,this.He=new Yg(this.Ht,i=>this.referenceDelegate.Ps(i)),this.N=new Ul(r),this.Je=new Hg(this.N)}start(){return Promise.resolve()}shutdown(){return this.Be=!1,Promise.resolve()}get started(){return this.Be}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Ht}getMutationQueue(n){let r=this.bs[n.toKey()];return r||(r=new Qg(this.Ht,this.referenceDelegate),this.bs[n.toKey()]=r),r}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getBundleCache(){return this.Je}runTransaction(n,r,i){N("MemoryPersistence","Starting transaction:",n);const o=new tm(this.Le.next());return this.referenceDelegate.vs(),i(o).next(a=>this.referenceDelegate.Vs(o).next(()=>a)).toPromise().then(a=>(o.raiseOnCommittedEvent(),a))}Ss(n,r){return S.or(Object.values(this.bs).map(i=>()=>i.containsKey(n,r)))}}class tm extends Pl{constructor(n){super(),this.currentSequenceNumber=n}}class ca{constructor(n){this.persistence=n,this.Ds=new ua,this.Cs=null}static Ns(n){return new ca(n)}get xs(){if(this.Cs)return this.Cs;throw B()}addReference(n,r,i){return this.Ds.addReference(i,r),this.xs.delete(i.toString()),S.resolve()}removeReference(n,r,i){return this.Ds.removeReference(i,r),this.xs.add(i.toString()),S.resolve()}markPotentiallyOrphaned(n,r){return this.xs.add(r.toString()),S.resolve()}removeTarget(n,r){this.Ds.cs(r.targetId).forEach(o=>this.xs.add(o.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(n,r.targetId).next(o=>{o.forEach(a=>this.xs.add(a.toString()))}).next(()=>i.removeTargetData(n,r))}vs(){this.Cs=new Set}Vs(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.xs,i=>{const o=U.fromPath(i);return this.ks(n,o).next(a=>{a||r.removeEntry(o)})}).next(()=>(this.Cs=null,r.apply(n)))}updateLimboDocument(n,r){return this.ks(n,r).next(i=>{i?this.xs.delete(r.toString()):this.xs.add(r.toString())})}Ps(n){return 0}ks(n,r){return S.or([()=>S.resolve(this.Ds.containsKey(r)),()=>this.persistence.getTargetCache().containsKey(n,r),()=>this.persistence.Ss(n,r)])}}function uh(s,n){return`firestore_clients_${s}_${n}`}function ch(s,n,r){let i=`firestore_mutations_${s}_${r}`;return n.isAuthenticated()&&(i+=`_${n.uid}`),i}function la(s,n){return`firestore_targets_${s}_${n}`}class Di{constructor(n,r,i,o){this.user=n,this.batchId=r,this.state=i,this.error=o}static $s(n,r,i){const o=JSON.parse(i);let a,u="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return u&&o.error&&(u="string"==typeof o.error.message&&"string"==typeof o.error.code,u&&(a=new x(o.error.code,o.error.message))),u?new Di(n,r,o.state,a):(Ce("SharedClientState",`Failed to parse mutation state for ID '${r}': ${i}`),null)}Os(){const n={state:this.state,updateTimeMs:Date.now()};return this.error&&(n.error={code:this.error.code,message:this.error.message}),JSON.stringify(n)}}class bs{constructor(n,r,i){this.targetId=n,this.state=r,this.error=i}static $s(n,r){const i=JSON.parse(r);let o,a="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&(a="string"==typeof i.error.message&&"string"==typeof i.error.code,a&&(o=new x(i.error.code,i.error.message))),a?new bs(n,i.state,o):(Ce("SharedClientState",`Failed to parse target state for ID '${n}': ${r}`),null)}Os(){const n={state:this.state,updateTimeMs:Date.now()};return this.error&&(n.error={code:this.error.code,message:this.error.message}),JSON.stringify(n)}}class ki{constructor(n,r){this.clientId=n,this.activeTargetIds=r}static $s(n,r){const i=JSON.parse(r);let o="object"==typeof i&&i.activeTargetIds instanceof Array,a=Ii();for(let u=0;o&&u<i.activeTargetIds.length;++u)o=Uc(i.activeTargetIds[u]),a=a.add(i.activeTargetIds[u]);return o?new ki(n,a):(Ce("SharedClientState",`Failed to parse client data for instance '${n}': ${r}`),null)}}class ha{constructor(n,r){this.clientId=n,this.onlineState=r}static $s(n){const r=JSON.parse(n);return"object"==typeof r&&-1!==["Unknown","Online","Offline"].indexOf(r.onlineState)&&"string"==typeof r.clientId?new ha(r.clientId,r.onlineState):(Ce("SharedClientState",`Failed to parse online state: ${n}`),null)}}class da{constructor(){this.activeTargetIds=Ii()}Fs(n){this.activeTargetIds=this.activeTargetIds.add(n)}Ms(n){this.activeTargetIds=this.activeTargetIds.delete(n)}Os(){const n={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(n)}}class fa{constructor(n,r,i,o,a){this.window=n,this.Oe=r,this.persistenceKey=i,this.Ls=o,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Bs=this.Us.bind(this),this.qs=new Pe(te),this.started=!1,this.Ks=[];const u=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=a,this.js=uh(this.persistenceKey,this.Ls),this.Qs=`firestore_sequence_number_${this.persistenceKey}`,this.qs=this.qs.insert(this.Ls,new da),this.Ws=new RegExp(`^firestore_clients_${u}_([^_]*)$`),this.Gs=new RegExp(`^firestore_mutations_${u}_(\\d+)(?:_(.*))?$`),this.zs=new RegExp(`^firestore_targets_${u}_(\\d+)$`),this.Hs=`firestore_online_state_${this.persistenceKey}`,this.Js=function(c){return`firestore_bundle_loaded_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.Bs)}static bt(n){return!(!n||!n.localStorage)}start(){var n=this;return(0,I.Z)(function*(){const r=yield n.syncEngine.pn();for(const o of r){if(o===n.Ls)continue;const a=n.getItem(uh(n.persistenceKey,o));if(a){const u=ki.$s(o,a);u&&(n.qs=n.qs.insert(u.clientId,u))}}n.Ys();const i=n.storage.getItem(n.Hs);if(i){const o=n.Xs(i);o&&n.Zs(o)}for(const o of n.Ks)n.Us(o);n.Ks=[],n.window.addEventListener("pagehide",()=>n.shutdown()),n.started=!0})()}writeSequenceNumber(n){this.setItem(this.Qs,JSON.stringify(n))}getAllActiveQueryTargets(){return this.ti(this.qs)}isActiveQueryTarget(n){let r=!1;return this.qs.forEach((i,o)=>{o.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(n){this.ei(n,"pending")}updateMutationState(n,r,i){this.ei(n,r,i),this.ni(n)}addLocalQueryTarget(n){let r="not-current";if(this.isActiveQueryTarget(n)){const i=this.storage.getItem(la(this.persistenceKey,n));if(i){const o=bs.$s(n,i);o&&(r=o.state)}}return this.si.Fs(n),this.Ys(),r}removeLocalQueryTarget(n){this.si.Ms(n),this.Ys()}isLocalQueryTarget(n){return this.si.activeTargetIds.has(n)}clearQueryState(n){this.removeItem(la(this.persistenceKey,n))}updateQueryState(n,r,i){this.ii(n,r,i)}handleUserChange(n,r,i){r.forEach(o=>{this.ni(o)}),this.currentUser=n,i.forEach(o=>{this.addPendingMutation(o)})}setOnlineState(n){this.ri(n)}notifyBundleLoaded(){this.oi()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Bs),this.removeItem(this.js),this.started=!1)}getItem(n){const r=this.storage.getItem(n);return N("SharedClientState","READ",n,r),r}setItem(n,r){N("SharedClientState","SET",n,r),this.storage.setItem(n,r)}removeItem(n){N("SharedClientState","REMOVE",n),this.storage.removeItem(n)}Us(n){var r=this;const i=n;if(i.storageArea===this.storage){if(N("SharedClientState","EVENT",i.key,i.newValue),i.key===this.js)return void Ce("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Oe.enqueueRetryable((0,I.Z)(function*(){if(r.started){if(null!==i.key)if(r.Ws.test(i.key)){if(null==i.newValue){const o=r.ai(i.key);return r.ci(o,null)}{const o=r.ui(i.key,i.newValue);if(o)return r.ci(o.clientId,o)}}else if(r.Gs.test(i.key)){if(null!==i.newValue){const o=r.hi(i.key,i.newValue);if(o)return r.li(o)}}else if(r.zs.test(i.key)){if(null!==i.newValue){const o=r.fi(i.key,i.newValue);if(o)return r.di(o)}}else if(i.key===r.Hs){if(null!==i.newValue){const o=r.Xs(i.newValue);if(o)return r.Zs(o)}}else if(i.key===r.Qs){const o=function(a){let u=vt.T;if(null!=a)try{const c=JSON.parse(a);z("number"==typeof c),u=c}catch(c){Ce("SharedClientState","Failed to read sequence number from WebStorage",c)}return u}(i.newValue);o!==vt.T&&r.sequenceNumberHandler(o)}else if(i.key===r.Js)return r.syncEngine.wi()}else r.Ks.push(i)}))}}get si(){return this.qs.get(this.Ls)}Ys(){this.setItem(this.js,this.si.Os())}ei(n,r,i){const o=new Di(this.currentUser,n,r,i),a=ch(this.persistenceKey,this.currentUser,n);this.setItem(a,o.Os())}ni(n){const r=ch(this.persistenceKey,this.currentUser,n);this.removeItem(r)}ri(n){this.storage.setItem(this.Hs,JSON.stringify({clientId:this.Ls,onlineState:n}))}ii(n,r,i){const o=la(this.persistenceKey,n),a=new bs(n,r,i);this.setItem(o,a.Os())}oi(){this.setItem(this.Js,"value-not-used")}ai(n){const r=this.Ws.exec(n);return r?r[1]:null}ui(n,r){const i=this.ai(n);return ki.$s(i,r)}hi(n,r){const i=this.Gs.exec(n),o=Number(i[1]);return Di.$s(new He(void 0!==i[2]?i[2]:null),o,r)}fi(n,r){const i=this.zs.exec(n),o=Number(i[1]);return bs.$s(o,r)}Xs(n){return ha.$s(n)}li(n){var r=this;return(0,I.Z)(function*(){if(n.user.uid===r.currentUser.uid)return r.syncEngine._i(n.batchId,n.state,n.error);N("SharedClientState",`Ignoring mutation for non-active user ${n.user.uid}`)})()}di(n){return this.syncEngine.mi(n.targetId,n.state,n.error)}ci(n,r){const i=r?this.qs.insert(n,r):this.qs.remove(n),o=this.ti(this.qs),a=this.ti(i),u=[],c=[];return a.forEach(l=>{o.has(l)||u.push(l)}),o.forEach(l=>{a.has(l)||c.push(l)}),this.syncEngine.gi(u,c).then(()=>{this.qs=i})}Zs(n){this.qs.get(n.clientId)&&this.onlineStateHandler(n.onlineState)}ti(n){let r=Ii();return n.forEach((i,o)=>{r=r.unionWith(o.activeTargetIds)}),r}}class lh{constructor(){this.yi=new da,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(n){}updateMutationState(n,r,i){}addLocalQueryTarget(n){return this.yi.Fs(n),this.pi[n]||"not-current"}updateQueryState(n,r,i){this.pi[n]=r}removeLocalQueryTarget(n){this.yi.Ms(n)}isLocalQueryTarget(n){return this.yi.activeTargetIds.has(n)}clearQueryState(n){delete this.pi[n]}getAllActiveQueryTargets(){return this.yi.activeTargetIds}isActiveQueryTarget(n){return this.yi.activeTargetIds.has(n)}start(){return this.yi=new da,Promise.resolve()}handleUserChange(n,r,i){}setOnlineState(n){}shutdown(){}writeSequenceNumber(n){}notifyBundleLoaded(){}}class nm{Ei(n){}shutdown(){}}class hh{constructor(){this.Ti=()=>this.Ii(),this.Ai=()=>this.Ri(),this.bi=[],this.Pi()}Ei(n){this.bi.push(n)}shutdown(){window.removeEventListener("online",this.Ti),window.removeEventListener("offline",this.Ai)}Pi(){window.addEventListener("online",this.Ti),window.addEventListener("offline",this.Ai)}Ii(){N("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const n of this.bi)n(0)}Ri(){N("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const n of this.bi)n(1)}static bt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const rm={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class sm{constructor(n){this.vi=n.vi,this.Vi=n.Vi}Si(n){this.Di=n}Ci(n){this.Ni=n}onMessage(n){this.xi=n}close(){this.Vi()}send(n){this.vi(n)}ki(){this.Di()}$i(n){this.Ni(n)}Oi(n){this.xi(n)}}class im extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId,this.Fi=(n.ssl?"https":"http")+"://"+n.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Li(n,r,i,o){const a=this.Bi(n,r);N("RestConnection","Sending: ",a,i);const u={};return this.Ui(u,o),this.qi(n,a,u,i).then(c=>(N("RestConnection","Received: ",c),c),c=>{throw os("RestConnection",`${n} failed with error: `,c,"url: ",a,"request:",i),c})}Ki(n,r,i,o){return this.Li(n,r,i,o)}Ui(n,r){if(n["X-Goog-Api-Client"]="gl-js/ fire/"+tr,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r)for(const i in r.authHeaders)r.authHeaders.hasOwnProperty(i)&&(n[i]=r.authHeaders[i])}Bi(n,r){return`${this.Fi}/v1/${r}:${rm[n]}`}}{constructor(n){super(n),this.forceLongPolling=n.forceLongPolling,this.autoDetectLongPolling=n.autoDetectLongPolling,this.useFetchStreams=n.useFetchStreams}qi(n,r,i,o){return new Promise((a,u)=>{const c=new Af;c.listenOnce(Sf.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Ao.NO_ERROR:const h=c.getResponseJson();N("Connection","XHR received:",JSON.stringify(h)),a(h);break;case Ao.TIMEOUT:N("Connection",'RPC "'+n+'" timed out'),u(new x(w.DEADLINE_EXCEEDED,"Request time out"));break;case Ao.HTTP_ERROR:const d=c.getStatus();if(N("Connection",'RPC "'+n+'" failed with status:',d,"response text:",c.getResponseText()),d>0){const g=c.getResponseJson().error;if(g&&g.status&&g.message){const _=function(E){const b=E.toLowerCase().replace(/_/g,"-");return Object.values(w).indexOf(b)>=0?b:w.UNKNOWN}(g.status);u(new x(_,g.message))}else u(new x(w.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new x(w.UNAVAILABLE,"Connection failed."));break;default:B()}}finally{N("Connection",'RPC "'+n+'" completed.')}});const l=JSON.stringify(o);c.send(r,"POST",l,i,15)})}ji(n,r){const i=[this.Fi,"/","google.firestore.v1.Firestore","/",n,"/channel"],o=Ef(),a=Tf(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(u.xmlHttpFactory=new bf({})),this.Ui(u.initMessageHeaders,r),(0,Y.uI)()||(0,Y.b$)()||(0,Y.d)()||(0,Y.w1)()||(0,Y.Mn)()||(0,Y.ru)()||(u.httpHeadersOverwriteParam="$httpHeaders");const c=i.join("");N("Connection","Creating WebChannel: "+c,u);const l=o.createWebChannel(c,u);let h=!1,d=!1;const g=new sm({vi:E=>{d?N("Connection","Not sending because WebChannel is closed:",E):(h||(N("Connection","Opening WebChannel transport."),l.open(),h=!0),N("Connection","WebChannel sending:",E),l.send(E))},Vi:()=>l.close()}),_=(E,b,M)=>{E.listen(b,W=>{try{M(W)}catch(ge){setTimeout(()=>{throw ge},0)}})};return _(l,ui.EventType.OPEN,()=>{d||N("Connection","WebChannel transport opened.")}),_(l,ui.EventType.CLOSE,()=>{d||(d=!0,N("Connection","WebChannel transport closed"),g.$i())}),_(l,ui.EventType.ERROR,E=>{d||(d=!0,os("Connection","WebChannel transport errored:",E),g.$i(new x(w.UNAVAILABLE,"The operation could not be completed")))}),_(l,ui.EventType.MESSAGE,E=>{var b;if(!d){const M=E.data[0];z(!!M);const W=M,ge=W.error||(null===(b=W[0])||void 0===b?void 0:b.error);if(ge){N("Connection","WebChannel received error:",ge);const Fe=ge.status;let le=function(It){const Zi=Re[It];if(void 0!==Zi)return hl(Zi)}(Fe),Ae=ge.message;void 0===le&&(le=w.INTERNAL,Ae="Unknown error status: "+Fe+" with message "+ge.message),d=!0,g.$i(new x(le,Ae)),l.close()}else N("Connection","WebChannel received:",M),g.Oi(M)}}),_(a,xf.STAT_EVENT,E=>{E.stat===kc.PROXY?N("Connection","Detected buffering proxy"):E.stat===kc.NOPROXY&&N("Connection","Detected no buffering proxy")}),setTimeout(()=>{g.ki()},0),g}}function dh(){return"undefined"!=typeof window?window:null}function Ri(){return"undefined"!=typeof document?document:null}function As(s){return new dg(s,!0)}class ga{constructor(n,r,i=1e3,o=1.5,a=6e4){this.Oe=n,this.timerId=r,this.Qi=i,this.Wi=o,this.Gi=a,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}reset(){this.zi=0}Yi(){this.zi=this.Gi}Xi(n){this.cancel();const r=Math.floor(this.zi+this.Zi()),i=Math.max(0,Date.now()-this.Ji),o=Math.max(0,r-i);o>0&&N("ExponentialBackoff",`Backing off for ${o} ms (base delay: ${this.zi} ms, delay with jitter: ${r} ms, last attempt: ${i} ms ago)`),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,o,()=>(this.Ji=Date.now(),n())),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}tr(){null!==this.Hi&&(this.Hi.skipDelay(),this.Hi=null)}cancel(){null!==this.Hi&&(this.Hi.cancel(),this.Hi=null)}Zi(){return(Math.random()-.5)*this.zi}}class fh{constructor(n,r,i,o,a,u){this.Oe=n,this.er=i,this.nr=o,this.credentialsProvider=a,this.listener=u,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new ga(n,r)}ar(){return 1===this.state||2===this.state||4===this.state}cr(){return 2===this.state}start(){3!==this.state?this.auth():this.ur()}stop(){var n=this;return(0,I.Z)(function*(){n.ar()&&(yield n.close(0))})()}hr(){this.state=0,this.rr.reset()}lr(){this.cr()&&null===this.ir&&(this.ir=this.Oe.enqueueAfterDelay(this.er,6e4,()=>this.dr()))}wr(n){this._r(),this.stream.send(n)}dr(){var n=this;return(0,I.Z)(function*(){if(n.cr())return n.close(0)})()}_r(){this.ir&&(this.ir.cancel(),this.ir=null)}close(n,r){var i=this;return(0,I.Z)(function*(){i._r(),i.rr.cancel(),i.sr++,3!==n?i.rr.reset():r&&r.code===w.RESOURCE_EXHAUSTED?(Ce(r.toString()),Ce("Using maximum backoff delay to prevent overloading the backend."),i.rr.Yi()):r&&r.code===w.UNAUTHENTICATED&&i.credentialsProvider.invalidateToken(),null!==i.stream&&(i.mr(),i.stream.close(),i.stream=null),i.state=n,yield i.listener.Ci(r)})()}mr(){}auth(){this.state=1;const n=this.gr(this.sr),r=this.sr;this.credentialsProvider.getToken().then(i=>{this.sr===r&&this.yr(i)},i=>{n(()=>{const o=new x(w.UNKNOWN,"Fetching auth token failed: "+i.message);return this.pr(o)})})}yr(n){const r=this.gr(this.sr);this.stream=this.Er(n),this.stream.Si(()=>{r(()=>(this.state=2,this.listener.Si()))}),this.stream.Ci(i=>{r(()=>this.pr(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}ur(){var n=this;this.state=4,this.rr.Xi((0,I.Z)(function*(){n.state=0,n.start()}))}pr(n){return N("PersistentStream",`close with error: ${n}`),this.stream=null,this.close(3,n)}gr(n){return r=>{this.Oe.enqueueAndForget(()=>this.sr===n?r():(N("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class om extends fh{constructor(n,r,i,o,a){super(n,"listen_stream_connection_backoff","listen_stream_idle",r,i,a),this.N=o}Er(n){return this.nr.ji("Listen",n)}onMessage(n){this.rr.reset();const r=function(s,n){let r;if("targetChange"in n){const i="NO_CHANGE"===(l=n.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===l?1:"REMOVE"===l?2:"CURRENT"===l?3:"RESET"===l?4:B(),o=n.targetChange.targetIds||[],a=function(l,h){return l.D?(z(void 0===h||"string"==typeof h),Ke.fromBase64String(h||"")):(z(void 0===h||h instanceof Uint8Array),Ke.fromUint8Array(h||new Uint8Array))}(s,n.targetChange.resumeToken),u=n.targetChange.cause,c=u&&function(l){const h=void 0===l.code?w.UNKNOWN:hl(l.code);return new x(h,l.message||"")}(u);r=new ml(i,o,a,c||null)}else if("documentChange"in n){const i=n.documentChange,o=Mt(s,i.document.name),a=Ge(i.document.updateTime),u=new st({mapValue:{fields:i.document.fields}}),c=ve.newFoundDocument(o,a,u);r=new Ei(i.targetIds||[],i.removedTargetIds||[],c.key,c)}else if("documentDelete"in n){const i=n.documentDelete,o=Mt(s,i.document),a=i.readTime?Ge(i.readTime):Q.min(),u=ve.newNoDocument(o,a);r=new Ei([],i.removedTargetIds||[],u.key,u)}else if("documentRemove"in n){const i=n.documentRemove,o=Mt(s,i.document);r=new Ei([],i.removedTargetIds||[],o,null)}else{if(!("filter"in n))return B();{const i=n.filter,a=new rg(i.count||0);r=new gl(i.targetId,a)}}var l;return r}(this.N,n),i=function(o){if(!("targetChange"in o))return Q.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?Q.min():a.readTime?Ge(a.readTime):Q.min()}(n);return this.listener.Tr(r,i)}Ir(n){const r={};r.database=Es(this.N),r.addTarget=function(o,a){let u;const c=a.target;return u=fi(c)?{documents:bl(o,c)}:{query:Al(o,c)},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0?u.resumeToken=wl(o,a.resumeToken):a.snapshotVersion.compareTo(Q.min())>0&&(u.readTime=_s(o,a.snapshotVersion.toTimestamp())),u}(this.N,n);const i=function(s,n){const r=function(i,o){switch(o){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return B()}}(0,n.purpose);return null==r?null:{"goog-listen-tags":r}}(0,n);i&&(r.labels=i),this.wr(r)}Ar(n){const r={};r.database=Es(this.N),r.removeTarget=n,this.wr(r)}}class am extends fh{constructor(n,r,i,o,a){super(n,"write_stream_connection_backoff","write_stream_idle",r,i,a),this.N=o,this.Rr=!1}get br(){return this.Rr}start(){this.Rr=!1,this.lastStreamToken=void 0,super.start()}mr(){this.Rr&&this.Pr([])}Er(n){return this.nr.ji("Write",n)}onMessage(n){if(z(!!n.streamToken),this.lastStreamToken=n.streamToken,this.Rr){this.rr.reset();const r=function(s,n){return s&&s.length>0?(z(void 0!==n),s.map(r=>function(i,o){let a=Ge(i.updateTime?i.updateTime:o);return a.isEqual(Q.min())&&(a=Ge(o)),new eg(a,i.transformResults||[])}(r,n))):[]}(n.writeResults,n.commitTime),i=Ge(n.commitTime);return this.listener.vr(i,r)}return z(!n.writeResults||0===n.writeResults.length),this.Rr=!0,this.listener.Vr()}Sr(){const n={};n.database=Es(this.N),this.wr(n)}Pr(n){const r={streamToken:this.lastStreamToken,writes:n.map(i=>Ti(this.N,i))};this.wr(r)}}class um extends class{}{constructor(n,r,i){super(),this.credentials=n,this.nr=r,this.N=i,this.Dr=!1}Cr(){if(this.Dr)throw new x(w.FAILED_PRECONDITION,"The client has already been terminated.")}Li(n,r,i){return this.Cr(),this.credentials.getToken().then(o=>this.nr.Li(n,r,i,o)).catch(o=>{throw"FirebaseError"===o.name?(o.code===w.UNAUTHENTICATED&&this.credentials.invalidateToken(),o):new x(w.UNKNOWN,o.toString())})}Ki(n,r,i){return this.Cr(),this.credentials.getToken().then(o=>this.nr.Ki(n,r,i,o)).catch(o=>{throw"FirebaseError"===o.name?(o.code===w.UNAUTHENTICATED&&this.credentials.invalidateToken(),o):new x(w.UNKNOWN,o.toString())})}terminate(){this.Dr=!0}}class cm{constructor(n,r){this.asyncQueue=n,this.onlineStateHandler=r,this.state="Unknown",this.Nr=0,this.kr=null,this.$r=!0}Or(){0===this.Nr&&(this.Fr("Unknown"),this.kr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.kr=null,this.Mr("Backend didn't respond within 10 seconds."),this.Fr("Offline"),Promise.resolve())))}Lr(n){"Online"===this.state?this.Fr("Unknown"):(this.Nr++,this.Nr>=1&&(this.Br(),this.Mr(`Connection failed 1 times. Most recent error: ${n.toString()}`),this.Fr("Offline")))}set(n){this.Br(),this.Nr=0,"Online"===n&&(this.$r=!1),this.Fr(n)}Fr(n){n!==this.state&&(this.state=n,this.onlineStateHandler(n))}Mr(n){const r=`Could not reach Cloud Firestore backend. ${n}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.$r?(Ce(r),this.$r=!1):N("OnlineStateTracker",r)}Br(){null!==this.kr&&(this.kr.cancel(),this.kr=null)}}class lm{constructor(n,r,i,o,a){var u=this;this.localStore=n,this.datastore=r,this.asyncQueue=i,this.remoteSyncer={},this.Ur=[],this.qr=new Map,this.Kr=new Set,this.jr=[],this.Qr=a,this.Qr.Ei(c=>{i.enqueueAndForget((0,I.Z)(function*(){var l;an(u)&&(N("RemoteStore","Restarting streams for network reachability change."),yield(l=(0,I.Z)(function*(h){const d=k(h);d.Kr.add(4),yield Tr(d),d.Wr.set("Unknown"),d.Kr.delete(4),yield Ns(d)}),function(h){return l.apply(this,arguments)})(u))}))}),this.Wr=new cm(i,o)}}function Ns(s){return ma.apply(this,arguments)}function ma(){return(ma=(0,I.Z)(function*(s){if(an(s))for(const n of s.jr)yield n(!0)})).apply(this,arguments)}function Tr(s){return pa.apply(this,arguments)}function pa(){return(pa=(0,I.Z)(function*(s){for(const n of s.jr)yield n(!1)})).apply(this,arguments)}function Oi(s,n){const r=k(s);r.qr.has(n.targetId)||(r.qr.set(n.targetId,n),wa(r)?va(r):xr(r).cr()&&ya(r,n))}function Cs(s,n){const r=k(s),i=xr(r);r.qr.delete(n),i.cr()&&gh(r,n),0===r.qr.size&&(i.cr()?i.lr():an(r)&&r.Wr.set("Unknown"))}function ya(s,n){s.Gr.Y(n.targetId),xr(s).Ir(n)}function gh(s,n){s.Gr.Y(n),xr(s).Ar(n)}function va(s){s.Gr=new cg({getRemoteKeysForTarget:n=>s.remoteSyncer.getRemoteKeysForTarget(n),Et:n=>s.qr.get(n)||null}),xr(s).start(),s.Wr.Or()}function wa(s){return an(s)&&!xr(s).ar()&&s.qr.size>0}function an(s){return 0===k(s).Kr.size}function mh(s){s.Gr=void 0}function hm(s){return _a.apply(this,arguments)}function _a(){return(_a=(0,I.Z)(function*(s){s.qr.forEach((n,r)=>{ya(s,n)})})).apply(this,arguments)}function dm(s,n){return Ia.apply(this,arguments)}function Ia(){return(Ia=(0,I.Z)(function*(s,n){mh(s),wa(s)?(s.Wr.Lr(n),va(s)):s.Wr.set("Unknown")})).apply(this,arguments)}function fm(s,n,r){return Ea.apply(this,arguments)}function Ea(){return(Ea=(0,I.Z)(function*(s,n,r){if(s.Wr.set("Online"),n instanceof ml&&2===n.state&&n.cause)try{yield(i=(0,I.Z)(function*(o,a){const u=a.cause;for(const c of a.targetIds)o.qr.has(c)&&(yield o.remoteSyncer.rejectListen(c,u),o.qr.delete(c),o.Gr.removeTarget(c))}),function(o,a){return i.apply(this,arguments)})(s,n)}catch(i){N("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),i),yield Li(s,i)}else if(n instanceof Ei?s.Gr.rt(n):n instanceof gl?s.Gr.ft(n):s.Gr.ct(n),!r.isEqual(Q.min()))try{const i=yield sh(s.localStore);r.compareTo(i)>=0&&(yield function(o,a){const u=o.Gr._t(a);return u.targetChanges.forEach((c,l)=>{if(c.resumeToken.approximateByteSize()>0){const h=o.qr.get(l);h&&o.qr.set(l,h.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach(c=>{const l=o.qr.get(c);if(!l)return;o.qr.set(c,l.withResumeToken(Ke.EMPTY_BYTE_STRING,l.snapshotVersion)),gh(o,c);const h=new nn(l.target,c,1,l.sequenceNumber);ya(o,h)}),o.remoteSyncer.applyRemoteEvent(u)}(s,r))}catch(i){N("RemoteStore","Failed to raise snapshot:",i),yield Li(s,i)}var i})).apply(this,arguments)}function Li(s,n,r){return Ta.apply(this,arguments)}function Ta(){return(Ta=(0,I.Z)(function*(s,n,r){if(!An(n))throw n;s.Kr.add(1),yield Tr(s),s.Wr.set("Offline"),r||(r=()=>sh(s.localStore)),s.asyncQueue.enqueueRetryable((0,I.Z)(function*(){N("RemoteStore","Retrying IndexedDB access"),yield r(),s.Kr.delete(1),yield Ns(s)}))})).apply(this,arguments)}function ph(s,n){return n().catch(r=>Li(s,r,n))}function Sr(s){return Sa.apply(this,arguments)}function Sa(){return(Sa=(0,I.Z)(function*(s){const n=k(s),r=un(n);let i=n.Ur.length>0?n.Ur[n.Ur.length-1].batchId:-1;for(;gm(n);)try{const o=yield $g(n.localStore,i);if(null===o){0===n.Ur.length&&r.lr();break}i=o.batchId,mm(n,o)}catch(o){yield Li(n,o)}yh(n)&&vh(n)})).apply(this,arguments)}function gm(s){return an(s)&&s.Ur.length<10}function mm(s,n){s.Ur.push(n);const r=un(s);r.cr()&&r.br&&r.Pr(n.mutations)}function yh(s){return an(s)&&!un(s).ar()&&s.Ur.length>0}function vh(s){un(s).start()}function pm(s){return xa.apply(this,arguments)}function xa(){return(xa=(0,I.Z)(function*(s){un(s).Sr()})).apply(this,arguments)}function ym(s){return ba.apply(this,arguments)}function ba(){return(ba=(0,I.Z)(function*(s){const n=un(s);for(const r of s.Ur)n.Pr(r.mutations)})).apply(this,arguments)}function vm(s,n,r){return Aa.apply(this,arguments)}function Aa(){return(Aa=(0,I.Z)(function*(s,n,r){const i=s.Ur.shift(),o=zo.from(i,n,r);yield ph(s,()=>s.remoteSyncer.applySuccessfulWrite(o)),yield Sr(s)})).apply(this,arguments)}function wm(s,n){return Na.apply(this,arguments)}function Na(){return(Na=(0,I.Z)(function*(s,n){var r;n&&un(s).br&&(yield(r=(0,I.Z)(function*(i,o){if(ll(a=o.code)&&a!==w.ABORTED){const u=i.Ur.shift();un(i).hr(),yield ph(i,()=>i.remoteSyncer.rejectFailedWrite(u.batchId,o)),yield Sr(i)}var a}),function(i,o){return r.apply(this,arguments)})(s,n)),yh(s)&&vh(s)})).apply(this,arguments)}function Ca(s,n){return Da.apply(this,arguments)}function Da(){return(Da=(0,I.Z)(function*(s,n){const r=k(s);n?(r.Kr.delete(2),yield Ns(r)):n||(r.Kr.add(2),yield Tr(r),r.Wr.set("Unknown"))})).apply(this,arguments)}function xr(s){return s.zr||(s.zr=function(n,r,i){const o=k(n);return o.Cr(),new om(r,o.nr,o.credentials,o.N,i)}(s.datastore,s.asyncQueue,{Si:hm.bind(null,s),Ci:dm.bind(null,s),Tr:fm.bind(null,s)}),s.jr.push(function(){var n=(0,I.Z)(function*(r){r?(s.zr.hr(),wa(s)?va(s):s.Wr.set("Unknown")):(yield s.zr.stop(),mh(s))});return function(r){return n.apply(this,arguments)}}())),s.zr}function un(s){return s.Hr||(s.Hr=function(n,r,i){const o=k(n);return o.Cr(),new am(r,o.nr,o.credentials,o.N,i)}(s.datastore,s.asyncQueue,{Si:pm.bind(null,s),Ci:wm.bind(null,s),Vr:ym.bind(null,s),vr:vm.bind(null,s)}),s.jr.push(function(){var n=(0,I.Z)(function*(r){r?(s.Hr.hr(),yield Sr(s)):(yield s.Hr.stop(),s.Ur.length>0&&(N("RemoteStore",`Stopping write stream with ${s.Ur.length} pending writes`),s.Ur=[]))});return function(r){return n.apply(this,arguments)}}())),s.Hr}class ka{constructor(n,r,i,o,a){this.asyncQueue=n,this.timerId=r,this.targetTimeMs=i,this.op=o,this.removalCallback=a,this.deferred=new qe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}static createAndSchedule(n,r,i,o,a){const u=Date.now()+i,c=new ka(n,r,u,o,a);return c.start(i),c}start(n){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),n)}skipDelay(){return this.handleDelayElapsed()}cancel(n){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new x(w.CANCELLED,"Operation cancelled"+(n?": "+n:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(n=>this.deferred.resolve(n))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function br(s,n){if(Ce("AsyncQueue",`${n}: ${s}`),An(s))return new x(w.UNAVAILABLE,`${n}: ${s}`);throw s}class Ar{constructor(n){this.comparator=n?(r,i)=>n(r,i)||U.comparator(r.key,i.key):(r,i)=>U.comparator(r.key,i.key),this.keyedMap=qo(),this.sortedSet=new Pe(this.comparator)}static emptySet(n){return new Ar(n.comparator)}has(n){return null!=this.keyedMap.get(n)}get(n){return this.keyedMap.get(n)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(n){const r=this.keyedMap.get(n);return r?this.sortedSet.indexOf(r):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((r,i)=>(n(r),!1))}add(n){const r=this.delete(n.key);return r.copy(r.keyedMap.insert(n.key,n),r.sortedSet.insert(n,null))}delete(n){const r=this.get(n);return r?this.copy(this.keyedMap.remove(n),this.sortedSet.remove(r)):this}isEqual(n){if(!(n instanceof Ar)||this.size!==n.size)return!1;const r=this.sortedSet.getIterator(),i=n.sortedSet.getIterator();for(;r.hasNext();){const o=r.getNext().key,a=i.getNext().key;if(!o.isEqual(a))return!1}return!0}toString(){const n=[];return this.forEach(r=>{n.push(r.toString())}),0===n.length?"DocumentSet ()":"DocumentSet (\n  "+n.join("  \n")+"\n)"}copy(n,r){const i=new Ar;return i.comparator=this.comparator,i.keyedMap=n,i.sortedSet=r,i}}class wh{constructor(){this.Jr=new Pe(U.comparator)}track(n){const r=n.doc.key,i=this.Jr.get(r);i?0!==n.type&&3===i.type?this.Jr=this.Jr.insert(r,n):3===n.type&&1!==i.type?this.Jr=this.Jr.insert(r,{type:i.type,doc:n.doc}):2===n.type&&2===i.type?this.Jr=this.Jr.insert(r,{type:2,doc:n.doc}):2===n.type&&0===i.type?this.Jr=this.Jr.insert(r,{type:0,doc:n.doc}):1===n.type&&0===i.type?this.Jr=this.Jr.remove(r):1===n.type&&2===i.type?this.Jr=this.Jr.insert(r,{type:1,doc:i.doc}):0===n.type&&1===i.type?this.Jr=this.Jr.insert(r,{type:2,doc:n.doc}):B():this.Jr=this.Jr.insert(r,n)}Yr(){const n=[];return this.Jr.inorderTraversal((r,i)=>{n.push(i)}),n}}class Nr{constructor(n,r,i,o,a,u,c,l){this.query=n,this.docs=r,this.oldDocs=i,this.docChanges=o,this.mutatedKeys=a,this.fromCache=u,this.syncStateChanged=c,this.excludesMetadataChanges=l}static fromInitialDocuments(n,r,i,o){const a=[];return r.forEach(u=>{a.push({type:0,doc:u})}),new Nr(n,r,Ar.emptySet(r),a,i,o,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(n){if(!(this.fromCache===n.fromCache&&this.syncStateChanged===n.syncStateChanged&&this.mutatedKeys.isEqual(n.mutatedKeys)&&fs(this.query,n.query)&&this.docs.isEqual(n.docs)&&this.oldDocs.isEqual(n.oldDocs)))return!1;const r=this.docChanges,i=n.docChanges;if(r.length!==i.length)return!1;for(let o=0;o<r.length;o++)if(r[o].type!==i[o].type||!r[o].doc.isEqual(i[o].doc))return!1;return!0}}class _m{constructor(){this.Xr=void 0,this.listeners=[]}}class Im{constructor(){this.queries=new _r(n=>Hc(n),fs),this.onlineState="Unknown",this.Zr=new Set}}function Ra(s,n){return Oa.apply(this,arguments)}function Oa(){return(Oa=(0,I.Z)(function*(s,n){const r=k(s),i=n.query;let o=!1,a=r.queries.get(i);if(a||(o=!0,a=new _m),o)try{a.Xr=yield r.onListen(i)}catch(u){const c=br(u,`Initialization of query '${Uo(n.query)}' failed`);return void n.onError(c)}r.queries.set(i,a),a.listeners.push(n),n.eo(r.onlineState),a.Xr&&n.no(a.Xr)&&Ma(r)})).apply(this,arguments)}function La(s,n){return Pa.apply(this,arguments)}function Pa(){return(Pa=(0,I.Z)(function*(s,n){const r=k(s),i=n.query;let o=!1;const a=r.queries.get(i);if(a){const u=a.listeners.indexOf(n);u>=0&&(a.listeners.splice(u,1),o=0===a.listeners.length)}if(o)return r.queries.delete(i),r.onUnlisten(i)})).apply(this,arguments)}function Em(s,n){const r=k(s);let i=!1;for(const o of n){const u=r.queries.get(o.query);if(u){for(const c of u.listeners)c.no(o)&&(i=!0);u.Xr=o}}i&&Ma(r)}function Tm(s,n,r){const i=k(s),o=i.queries.get(n);if(o)for(const a of o.listeners)a.onError(r);i.queries.delete(n)}function Ma(s){s.Zr.forEach(n=>{n.next()})}class Fa{constructor(n,r,i){this.query=n,this.so=r,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=i||{}}no(n){if(!this.options.includeMetadataChanges){const i=[];for(const o of n.docChanges)3!==o.type&&i.push(o);n=new Nr(n.query,n.docs,n.oldDocs,i,n.mutatedKeys,n.fromCache,n.syncStateChanged,!0)}let r=!1;return this.io?this.oo(n)&&(this.so.next(n),r=!0):this.ao(n,this.onlineState)&&(this.co(n),r=!0),this.ro=n,r}onError(n){this.so.error(n)}eo(n){this.onlineState=n;let r=!1;return this.ro&&!this.io&&this.ao(this.ro,n)&&(this.co(this.ro),r=!0),r}ao(n,r){return!n.fromCache||!(this.options.uo&&"Offline"!==r||n.docs.isEmpty()&&"Offline"!==r)}oo(n){return n.docChanges.length>0||!!(n.syncStateChanged||this.ro&&this.ro.hasPendingWrites!==n.hasPendingWrites)&&!0===this.options.includeMetadataChanges}co(n){n=Nr.fromInitialDocuments(n.query,n.docs,n.mutatedKeys,n.fromCache),this.io=!0,this.so.next(n)}}class Sm{constructor(n,r){this.payload=n,this.byteLength=r}ho(){return"metadata"in this.payload}}class _h{constructor(n){this.N=n}zn(n){return Mt(this.N,n)}Hn(n){return n.metadata.exists?Sl(this.N,n.document,!1):ve.newNoDocument(this.zn(n.metadata.name),this.Jn(n.metadata.readTime))}Jn(n){return Ge(n)}}class xm{constructor(n,r,i){this.lo=n,this.localStore=r,this.N=i,this.queries=[],this.documents=[],this.progress=Ih(n)}fo(n){this.progress.bytesLoaded+=n.byteLength;let r=this.progress.documentsLoaded;return n.payload.namedQuery?this.queries.push(n.payload.namedQuery):n.payload.documentMetadata?(this.documents.push({metadata:n.payload.documentMetadata}),n.payload.documentMetadata.exists||++r):n.payload.document&&(this.documents[this.documents.length-1].document=n.payload.document,++r),r!==this.progress.documentsLoaded?(this.progress.documentsLoaded=r,Object.assign({},this.progress)):null}wo(n){const r=new Map,i=new _h(this.N);for(const o of n)if(o.metadata.queries){const a=i.zn(o.metadata.name);for(const u of o.metadata.queries){const c=(r.get(u)||ce()).add(a);r.set(u,c)}}return r}complete(){var n=this;return(0,I.Z)(function*(){const r=yield function(s,n,r,i){return oa.apply(this,arguments)}(n.localStore,new _h(n.N),n.documents,n.lo.id),i=n.wo(n.documents);for(const o of n.queries)yield Zg(n.localStore,o,i.get(o.name));return n.progress.taskState="Success",new qg(Object.assign({},n.progress),r)})()}}function Ih(s){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:s.totalDocuments,totalBytes:s.totalBytes}}class Eh{constructor(n){this.key=n}}class Th{constructor(n){this.key=n}}class Sh{constructor(n,r){this.query=n,this._o=r,this.mo=null,this.current=!1,this.yo=ce(),this.mutatedKeys=ce(),this.po=Qc(n),this.Eo=new Ar(this.po)}get To(){return this._o}Io(n,r){const i=r?r.Ao:new wh,o=r?r.Eo:this.Eo;let a=r?r.mutatedKeys:this.mutatedKeys,u=o,c=!1;const l=mi(this.query)&&o.size===this.query.limit?o.last():null,h=pi(this.query)&&o.size===this.query.limit?o.first():null;if(n.inorderTraversal((d,g)=>{const _=o.get(d),E=gs(this.query,g)?g:null,b=!!_&&this.mutatedKeys.has(_.key),M=!!E&&(E.hasLocalMutations||this.mutatedKeys.has(E.key)&&E.hasCommittedMutations);let W=!1;_&&E?_.data.isEqual(E.data)?b!==M&&(i.track({type:3,doc:E}),W=!0):this.Ro(_,E)||(i.track({type:2,doc:E}),W=!0,(l&&this.po(E,l)>0||h&&this.po(E,h)<0)&&(c=!0)):!_&&E?(i.track({type:0,doc:E}),W=!0):_&&!E&&(i.track({type:1,doc:_}),W=!0,(l||h)&&(c=!0)),W&&(E?(u=u.add(E),a=M?a.add(d):a.delete(d)):(u=u.delete(d),a=a.delete(d)))}),mi(this.query)||pi(this.query))for(;u.size>this.query.limit;){const d=mi(this.query)?u.last():u.first();u=u.delete(d.key),a=a.delete(d.key),i.track({type:1,doc:d})}return{Eo:u,Ao:i,Ln:c,mutatedKeys:a}}Ro(n,r){return n.hasLocalMutations&&r.hasCommittedMutations&&!r.hasLocalMutations}applyChanges(n,r,i){const o=this.Eo;this.Eo=n.Eo,this.mutatedKeys=n.mutatedKeys;const a=n.Ao.Yr();a.sort((h,d)=>function(g,_){const E=b=>{switch(b){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B()}};return E(g)-E(_)}(h.type,d.type)||this.po(h.doc,d.doc)),this.bo(i);const u=r?this.Po():[],c=0===this.yo.size&&this.current?1:0,l=c!==this.mo;return this.mo=c,0!==a.length||l?{snapshot:new Nr(this.query,n.Eo,o,a,n.mutatedKeys,0===c,l,!1),vo:u}:{vo:u}}eo(n){return this.current&&"Offline"===n?(this.current=!1,this.applyChanges({Eo:this.Eo,Ao:new wh,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{vo:[]}}Vo(n){return!this._o.has(n)&&!!this.Eo.has(n)&&!this.Eo.get(n).hasLocalMutations}bo(n){n&&(n.addedDocuments.forEach(r=>this._o=this._o.add(r)),n.modifiedDocuments.forEach(r=>{}),n.removedDocuments.forEach(r=>this._o=this._o.delete(r)),this.current=n.current)}Po(){if(!this.current)return[];const n=this.yo;this.yo=ce(),this.Eo.forEach(i=>{this.Vo(i.key)&&(this.yo=this.yo.add(i.key))});const r=[];return n.forEach(i=>{this.yo.has(i)||r.push(new Th(i))}),this.yo.forEach(i=>{n.has(i)||r.push(new Eh(i))}),r}So(n){this._o=n.Gn,this.yo=ce();const r=this.Io(n.documents);return this.applyChanges(r,!0)}Do(){return Nr.fromInitialDocuments(this.query,this.Eo,this.mutatedKeys,0===this.mo)}}class bm{constructor(n,r,i){this.query=n,this.targetId=r,this.view=i}}class Am{constructor(n){this.key=n,this.Co=!1}}class Nm{constructor(n,r,i,o,a,u){this.localStore=n,this.remoteStore=r,this.eventManager=i,this.sharedClientState=o,this.currentUser=a,this.maxConcurrentLimboResolutions=u,this.No={},this.xo=new _r(c=>Hc(c),fs),this.ko=new Map,this.$o=new Set,this.Oo=new Pe(U.comparator),this.Fo=new Map,this.Mo=new ua,this.Lo={},this.Bo=new Map,this.Uo=Cn.ie(),this.onlineState="Unknown",this.qo=void 0}get isPrimaryClient(){return!0===this.qo}}function Cm(s,n){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,I.Z)(function*(s,n){const r=au(s);let i,o;const a=r.xo.get(n);if(a)i=a.targetId,r.sharedClientState.addLocalQueryTarget(i),o=a.view.Do();else{const u=yield Ir(r.localStore,Tt(n)),c=r.sharedClientState.addLocalQueryTarget(u.targetId);i=u.targetId,o=yield Va(r,n,i,"current"===c),r.isPrimaryClient&&Oi(r.remoteStore,u)}return o})).apply(this,arguments)}function Va(s,n,r,i){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,I.Z)(function*(s,n,r,i){s.Ko=(d,g,_)=>{return(E=(0,I.Z)(function*(b,M,W,ge){let Fe=M.view.Io(W);Fe.Ln&&(Fe=yield Ci(b.localStore,M.query,!1).then(({documents:It})=>M.view.Io(It,Fe)));const le=ge&&ge.targetChanges.get(M.targetId),Ae=M.view.applyChanges(Fe,b.isPrimaryClient,le);return Qa(b,M.targetId,Ae.vo),Ae.snapshot}),function(b,M,W,ge){return E.apply(this,arguments)})(s,d,g,_);var E};const o=yield Ci(s.localStore,n,!0),a=new Sh(n,o.Gn),u=a.Io(o.documents),c=ws.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==s.onlineState),l=a.applyChanges(u,s.isPrimaryClient,c);Qa(s,r,l.vo);const h=new bm(n,r,a);return s.xo.set(n,h),s.ko.has(r)?s.ko.get(r).push(n):s.ko.set(r,[n]),l.snapshot})).apply(this,arguments)}function Dm(s,n){return qa.apply(this,arguments)}function qa(){return(qa=(0,I.Z)(function*(s,n){const r=k(s),i=r.xo.get(n),o=r.ko.get(i.targetId);if(o.length>1)return r.ko.set(i.targetId,o.filter(a=>!fs(a,n))),void r.xo.delete(n);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Er(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),Cs(r.remoteStore,i.targetId),Cr(r,i.targetId)}).catch(Dn))):(Cr(r,i.targetId),yield Er(r.localStore,i.targetId,!0))})).apply(this,arguments)}function ja(){return(ja=(0,I.Z)(function*(s,n,r){const i=uu(s);try{const o=yield function(a,u){const c=k(a),l=je.now(),h=u.reduce((g,_)=>g.add(_.key),ce());let d;return c.persistence.runTransaction("Locally write mutations","readwrite",g=>c.Qn.Pn(g,h).next(_=>{d=_;const E=[];for(const b of u){const M=ng(b,d.get(b.key));null!=M&&E.push(new en(b.key,M,jc(M.value.mapValue),ke.exists(!0)))}return c.In.addMutationBatch(g,l,E,u)})).then(g=>(g.applyToLocalDocumentSet(d),{batchId:g.batchId,changes:d}))}(i.localStore,n);i.sharedClientState.addPendingMutation(o.batchId),function(a,u,c){let l=a.Lo[a.currentUser.toKey()];l||(l=new Pe(te)),l=l.insert(u,c),a.Lo[a.currentUser.toKey()]=l}(i,o.batchId,r),yield zt(i,o.changes),yield Sr(i.remoteStore)}catch(o){const a=br(o,"Failed to persist write");r.reject(a)}})).apply(this,arguments)}function xh(s,n){return Ka.apply(this,arguments)}function Ka(){return(Ka=(0,I.Z)(function*(s,n){const r=k(s);try{const i=yield Gg(r.localStore,n);n.targetChanges.forEach((o,a)=>{const u=r.Fo.get(a);u&&(z(o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size<=1),o.addedDocuments.size>0?u.Co=!0:o.modifiedDocuments.size>0?z(u.Co):o.removedDocuments.size>0&&(z(u.Co),u.Co=!1))}),yield zt(r,i,n)}catch(i){yield Dn(i)}})).apply(this,arguments)}function bh(s,n,r){const i=k(s);if(i.isPrimaryClient&&0===r||!i.isPrimaryClient&&1===r){const o=[];i.xo.forEach((a,u)=>{const c=u.view.eo(n);c.snapshot&&o.push(c.snapshot)}),function(a,u){const c=k(a);c.onlineState=u;let l=!1;c.queries.forEach((h,d)=>{for(const g of d.listeners)g.eo(u)&&(l=!0)}),l&&Ma(c)}(i.eventManager,n),o.length&&i.No.Tr(o),i.onlineState=n,i.isPrimaryClient&&i.sharedClientState.setOnlineState(n)}}function Rm(s,n,r){return Ga.apply(this,arguments)}function Ga(){return(Ga=(0,I.Z)(function*(s,n,r){const i=k(s);i.sharedClientState.updateQueryState(n,"rejected",r);const o=i.Fo.get(n),a=o&&o.key;if(a){let u=new Pe(U.comparator);u=u.insert(a,ve.newNoDocument(a,Q.min()));const c=ce().add(a),l=new vs(Q.min(),new Map,new Te(te),u,c);yield xh(i,l),i.Oo=i.Oo.remove(a),i.Fo.delete(n),Ya(i)}else yield Er(i.localStore,n,!1).then(()=>Cr(i,n,r)).catch(Dn)})).apply(this,arguments)}function Om(s,n){return $a.apply(this,arguments)}function $a(){return($a=(0,I.Z)(function*(s,n){const r=k(s),i=n.batch.batchId;try{const o=yield Kg(r.localStore,n);Ha(r,i,null),Za(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),yield zt(r,o)}catch(o){yield Dn(o)}})).apply(this,arguments)}function Lm(s,n,r){return za.apply(this,arguments)}function za(){return(za=(0,I.Z)(function*(s,n,r){const i=k(s);try{const o=yield function(a,u){const c=k(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let h;return c.In.lookupMutationBatch(l,u).next(d=>(z(null!==d),h=d.keys(),c.In.removeMutationBatch(l,d))).next(()=>c.In.performConsistencyCheck(l)).next(()=>c.Qn.Pn(l,h))})}(i.localStore,n);Ha(i,n,r),Za(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),yield zt(i,o)}catch(o){yield Dn(o)}})).apply(this,arguments)}function Wa(){return(Wa=(0,I.Z)(function*(s,n){const r=k(s);an(r.remoteStore)||N("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const i=yield function(a){const u=k(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.In.getHighestUnacknowledgedBatchId(c))}(r.localStore);if(-1===i)return void n.resolve();const o=r.Bo.get(i)||[];o.push(n),r.Bo.set(i,o)}catch(i){const o=br(i,"Initialization of waitForPendingWrites() operation failed");n.reject(o)}})).apply(this,arguments)}function Za(s,n){(s.Bo.get(n)||[]).forEach(r=>{r.resolve()}),s.Bo.delete(n)}function Ha(s,n,r){const i=k(s);let o=i.Lo[i.currentUser.toKey()];if(o){const a=o.get(n);a&&(r?a.reject(r):a.resolve(),o=o.remove(n)),i.Lo[i.currentUser.toKey()]=o}}function Cr(s,n,r=null){s.sharedClientState.removeLocalQueryTarget(n);for(const i of s.ko.get(n))s.xo.delete(i),r&&s.No.jo(i,r);s.ko.delete(n),s.isPrimaryClient&&s.Mo.cs(n).forEach(i=>{s.Mo.containsKey(i)||Ah(s,i)})}function Ah(s,n){s.$o.delete(n.path.canonicalString());const r=s.Oo.get(n);null!==r&&(Cs(s.remoteStore,r),s.Oo=s.Oo.remove(n),s.Fo.delete(r),Ya(s))}function Qa(s,n,r){for(const i of r)i instanceof Eh?(s.Mo.addReference(i.key,n),Mm(s,i)):i instanceof Th?(N("SyncEngine","Document no longer in limbo: "+i.key),s.Mo.removeReference(i.key,n),s.Mo.containsKey(i.key)||Ah(s,i.key)):B()}function Mm(s,n){const r=n.key,i=r.path.canonicalString();s.Oo.get(r)||s.$o.has(i)||(N("SyncEngine","New document in limbo: "+r),s.$o.add(i),Ya(s))}function Ya(s){for(;s.$o.size>0&&s.Oo.size<s.maxConcurrentLimboResolutions;){const n=s.$o.values().next().value;s.$o.delete(n);const r=new U(ue.fromString(n)),i=s.Uo.next();s.Fo.set(i,new Am(r)),s.Oo=s.Oo.insert(r,i),Oi(s.remoteStore,new nn(Tt(ar(r.path)),i,2,vt.T))}}function zt(s,n,r){return Ja.apply(this,arguments)}function Ja(){return(Ja=(0,I.Z)(function*(s,n,r){const i=k(s),o=[],a=[],u=[];var c;i.xo.isEmpty()||(i.xo.forEach((c,l)=>{u.push(i.Ko(l,n,r).then(h=>{if(h){i.isPrimaryClient&&i.sharedClientState.updateQueryState(l.targetId,h.fromCache?"not-current":"current"),o.push(h);const d=na.kn(l.targetId,h);a.push(d)}}))}),yield Promise.all(u),i.No.Tr(o),yield(c=(0,I.Z)(function*(l,h){const d=k(l);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>S.forEach(h,_=>S.forEach(_.Nn,E=>d.persistence.referenceDelegate.addReference(g,_.targetId,E)).next(()=>S.forEach(_.xn,E=>d.persistence.referenceDelegate.removeReference(g,_.targetId,E)))))}catch(g){if(!An(g))throw g;N("LocalStore","Failed to update sequence numbers: "+g)}for(const g of h){const _=g.targetId;if(!g.fromCache){const E=d.Un.get(_),M=E.withLastLimboFreeSnapshotVersion(E.snapshotVersion);d.Un=d.Un.insert(_,M)}}}),function(l,h){return c.apply(this,arguments)})(i.localStore,a))})).apply(this,arguments)}function Fm(s,n){return Xa.apply(this,arguments)}function Xa(){return(Xa=(0,I.Z)(function*(s,n){const r=k(s);if(!r.currentUser.isEqual(n)){N("SyncEngine","User change. New user:",n.toKey());const i=yield rh(r.localStore,n);r.currentUser=n,(o=r).Bo.forEach(u=>{u.forEach(c=>{c.reject(new x(w.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),o.Bo.clear(),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),yield zt(r,i.Wn)}var o})).apply(this,arguments)}function Um(s,n){const r=k(s),i=r.Fo.get(n);if(i&&i.Co)return ce().add(i.key);{let o=ce();const a=r.ko.get(n);if(!a)return o;for(const u of a){const c=r.xo.get(u);o=o.unionWith(c.view.To)}return o}}function Vm(s,n){return eu.apply(this,arguments)}function eu(){return(eu=(0,I.Z)(function*(s,n){const r=k(s),i=yield Ci(r.localStore,n.query,!0),o=n.view.So(i);return r.isPrimaryClient&&Qa(r,n.targetId,o.vo),o})).apply(this,arguments)}function Bm(s){return tu.apply(this,arguments)}function tu(){return(tu=(0,I.Z)(function*(s){const n=k(s);return ah(n.localStore).then(r=>zt(n,r))})).apply(this,arguments)}function qm(s,n,r,i){return nu.apply(this,arguments)}function nu(){return(nu=(0,I.Z)(function*(s,n,r,i){const o=k(s),a=yield function(u,c){const l=k(u),h=k(l.In);return l.persistence.runTransaction("Lookup mutation documents","readonly",d=>h.Xt(d,c).next(g=>g?l.Qn.Pn(d,g):S.resolve(null)))}(o.localStore,n);var c;null!==a?("pending"===r?yield Sr(o.remoteStore):"acknowledged"===r||"rejected"===r?(Ha(o,n,i||null),Za(o,n),c=n,k(k(o.localStore).In).te(c)):B(),yield zt(o,a)):N("SyncEngine","Cannot apply mutation batch with id: "+n)})).apply(this,arguments)}function ru(){return(ru=(0,I.Z)(function*(s,n){const r=k(s);if(au(r),uu(r),!0===n&&!0!==r.qo){const i=r.sharedClientState.getAllActiveQueryTargets(),o=yield Nh(r,i.toArray());r.qo=!0,yield Ca(r.remoteStore,!0);for(const a of o)Oi(r.remoteStore,a)}else if(!1===n&&!1!==r.qo){const i=[];let o=Promise.resolve();r.ko.forEach((a,u)=>{r.sharedClientState.isLocalQueryTarget(u)?i.push(u):o=o.then(()=>(Cr(r,u),Er(r.localStore,u,!0))),Cs(r.remoteStore,u)}),yield o,yield Nh(r,i),function(a){const u=k(a);u.Fo.forEach((c,l)=>{Cs(u.remoteStore,l)}),u.Mo.us(),u.Fo=new Map,u.Oo=new Pe(U.comparator)}(r),r.qo=!1,yield Ca(r.remoteStore,!1)}})).apply(this,arguments)}function Nh(s,n,r){return su.apply(this,arguments)}function su(){return(su=(0,I.Z)(function*(s,n,r){const i=k(s),o=[],a=[];for(const u of n){let c;const l=i.ko.get(u);if(l&&0!==l.length){c=yield Ir(i.localStore,Tt(l[0]));for(const h of l){const d=i.xo.get(h),g=yield Vm(i,d);g.snapshot&&a.push(g.snapshot)}}else{const h=yield oh(i.localStore,u);c=yield Ir(i.localStore,h),yield Va(i,Ch(h),u,!1)}o.push(c)}return i.No.Tr(a),o})).apply(this,arguments)}function Ch(s){return Wc(s.path,s.collectionGroup,s.orderBy,s.filters,s.limit,"F",s.startAt,s.endAt)}function Km(s){const n=k(s);return k(k(n.localStore).persistence).pn()}function Gm(s,n,r,i){return iu.apply(this,arguments)}function iu(){return(iu=(0,I.Z)(function*(s,n,r,i){const o=k(s);if(o.qo)N("SyncEngine","Ignoring unexpected query state notification.");else if(o.ko.has(n))switch(r){case"current":case"not-current":{const a=yield ah(o.localStore),u=vs.createSynthesizedRemoteEventForCurrentChange(n,"current"===r);yield zt(o,a,u);break}case"rejected":yield Er(o.localStore,n,!0),Cr(o,n,i);break;default:B()}})).apply(this,arguments)}function $m(s,n,r){return ou.apply(this,arguments)}function ou(){return(ou=(0,I.Z)(function*(s,n,r){const i=au(s);if(i.qo){for(const o of n){if(i.ko.has(o)){N("SyncEngine","Adding an already active target "+o);continue}const a=yield oh(i.localStore,o),u=yield Ir(i.localStore,a);yield Va(i,Ch(a),u.targetId,!1),Oi(i.remoteStore,u)}for(const o of r)i.ko.has(o)&&(yield Er(i.localStore,o,!1).then(()=>{Cs(i.remoteStore,o),Cr(i,o)}).catch(Dn))}})).apply(this,arguments)}function au(s){const n=k(s);return n.remoteStore.remoteSyncer.applyRemoteEvent=xh.bind(null,n),n.remoteStore.remoteSyncer.getRemoteKeysForTarget=Um.bind(null,n),n.remoteStore.remoteSyncer.rejectListen=Rm.bind(null,n),n.No.Tr=Em.bind(null,n.eventManager),n.No.jo=Tm.bind(null,n.eventManager),n}function uu(s){const n=k(s);return n.remoteStore.remoteSyncer.applySuccessfulWrite=Om.bind(null,n),n.remoteStore.remoteSyncer.rejectFailedWrite=Lm.bind(null,n),n}class Dh{constructor(){this.synchronizeTabs=!1}initialize(n){var r=this;return(0,I.Z)(function*(){r.N=As(n.databaseInfo.databaseId),r.sharedClientState=r.Wo(n),r.persistence=r.Go(n),yield r.persistence.start(),r.gcScheduler=r.zo(n),r.localStore=r.Ho(n)})()}zo(n){return null}Ho(n){return nh(this.persistence,new th,n.initialUser,this.N)}Go(n){return new em(ca.Ns,this.N)}Wo(n){return new lh}terminate(){var n=this;return(0,I.Z)(function*(){n.gcScheduler&&n.gcScheduler.stop(),yield n.sharedClientState.shutdown(),yield n.persistence.shutdown()})()}}class kh extends Dh{constructor(n,r,i){super(),this.Jo=n,this.cacheSizeBytes=r,this.forceOwnership=i,this.synchronizeTabs=!1}initialize(n){var r=()=>super.initialize,i=this;return(0,I.Z)(function*(){yield r().call(i,n),yield function(s){return ia.apply(this,arguments)}(i.localStore),yield i.Jo.initialize(i,n),yield uu(i.Jo.syncEngine),yield Sr(i.Jo.remoteStore),yield i.persistence.nn(()=>(i.gcScheduler&&!i.gcScheduler.started&&i.gcScheduler.start(i.localStore),Promise.resolve()))})()}Ho(n){return nh(this.persistence,new th,n.initialUser,this.N)}zo(n){return new Pg(this.persistence.referenceDelegate.garbageCollector,n.asyncQueue)}Go(n){const r=ta(n.databaseInfo.databaseId,n.databaseInfo.persistenceKey),i=void 0!==this.cacheSizeBytes?gt.withCacheSize(this.cacheSizeBytes):gt.DEFAULT;return new ea(this.synchronizeTabs,r,n.clientId,i,n.asyncQueue,dh(),Ri(),this.N,this.sharedClientState,!!this.forceOwnership)}Wo(n){return new lh}}class Wm extends kh{constructor(n,r){super(n,r,!1),this.Jo=n,this.cacheSizeBytes=r,this.synchronizeTabs=!0}initialize(n){var r=()=>super.initialize,i=this;return(0,I.Z)(function*(){yield r().call(i,n);const o=i.Jo.syncEngine;i.sharedClientState instanceof fa&&(i.sharedClientState.syncEngine={_i:qm.bind(null,o),mi:Gm.bind(null,o),gi:$m.bind(null,o),pn:Km.bind(null,o),wi:Bm.bind(null,o)},yield i.sharedClientState.start()),yield i.persistence.nn(function(){var a=(0,I.Z)(function*(u){yield function(s,n){return ru.apply(this,arguments)}(i.Jo.syncEngine,u),i.gcScheduler&&(u&&!i.gcScheduler.started?i.gcScheduler.start(i.localStore):u||i.gcScheduler.stop())});return function(u){return a.apply(this,arguments)}}())})()}Wo(n){const r=dh();if(!fa.bt(r))throw new x(w.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const i=ta(n.databaseInfo.databaseId,n.databaseInfo.persistenceKey);return new fa(r,n.asyncQueue,i,n.clientId,n.initialUser)}}class cu{initialize(n,r){var i=this;return(0,I.Z)(function*(){i.localStore||(i.localStore=n.localStore,i.sharedClientState=n.sharedClientState,i.datastore=i.createDatastore(r),i.remoteStore=i.createRemoteStore(r),i.eventManager=i.createEventManager(r),i.syncEngine=i.createSyncEngine(r,!n.synchronizeTabs),i.sharedClientState.onlineStateHandler=o=>bh(i.syncEngine,o,1),i.remoteStore.remoteSyncer.handleCredentialChange=Fm.bind(null,i.syncEngine),yield Ca(i.remoteStore,i.syncEngine.isPrimaryClient))})()}createEventManager(n){return new Im}createDatastore(n){const r=As(n.databaseInfo.databaseId),i=new im(n.databaseInfo);return new um(n.credentials,i,r)}createRemoteStore(n){return r=this.localStore,i=this.datastore,o=n.asyncQueue,a=c=>bh(this.syncEngine,c,0),u=hh.bt()?new hh:new nm,new lm(r,i,o,a,u);var r,i,o,a,u}createSyncEngine(n,r){return function(i,o,a,u,c,l,h){const d=new Nm(i,o,a,u,c,l);return h&&(d.qo=!0),d}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,n.initialUser,n.maxConcurrentLimboResolutions,r)}terminate(){return(n=(0,I.Z)(function*(r){const i=k(r);N("RemoteStore","RemoteStore shutting down."),i.Kr.add(5),yield Tr(i),i.Qr.shutdown(),i.Wr.set("Unknown")}),function(r){return n.apply(this,arguments)})(this.remoteStore);var n}}function Rh(s,n=10240){let r=0;return{read:()=>(0,I.Z)(function*(){if(r<s.byteLength){const i={value:s.slice(r,r+n),done:!1};return r+=n,i}return{done:!0}})(),cancel:()=>(0,I.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class Pi{constructor(n){this.observer=n,this.muted=!1}next(n){this.observer.next&&this.Yo(this.observer.next,n)}error(n){this.observer.error?this.Yo(this.observer.error,n):console.error("Uncaught Error in snapshot listener:",n)}Xo(){this.muted=!0}Yo(n,r){this.muted||setTimeout(()=>{this.muted||n(r)},0)}}class Zm{constructor(n,r){this.Zo=n,this.N=r,this.metadata=new qe,this.buffer=new Uint8Array,this.ta=new TextDecoder("utf-8"),this.ea().then(i=>{i&&i.ho()?this.metadata.resolve(i.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==i?void 0:i.payload)}`))},i=>this.metadata.reject(i))}close(){return this.Zo.cancel()}getMetadata(){var n=this;return(0,I.Z)(function*(){return n.metadata.promise})()}Qo(){var n=this;return(0,I.Z)(function*(){return yield n.getMetadata(),n.ea()})()}ea(){var n=this;return(0,I.Z)(function*(){const r=yield n.na();if(null===r)return null;const i=n.ta.decode(r),o=Number(i);isNaN(o)&&n.sa(`length string (${i}) is not valid number`);const a=yield n.ia(o);return new Sm(JSON.parse(a),r.length+o)})()}ra(){return this.buffer.findIndex(n=>n==="{".charCodeAt(0))}na(){var n=this;return(0,I.Z)(function*(){for(;n.ra()<0&&!(yield n.oa()););if(0===n.buffer.length)return null;const r=n.ra();r<0&&n.sa("Reached the end of bundle when a length string is expected.");const i=n.buffer.slice(0,r);return n.buffer=n.buffer.slice(r),i})()}ia(n){var r=this;return(0,I.Z)(function*(){for(;r.buffer.length<n;)(yield r.oa())&&r.sa("Reached the end of bundle when more is expected.");const i=r.ta.decode(r.buffer.slice(0,n));return r.buffer=r.buffer.slice(n),i})()}sa(n){throw this.Zo.cancel(),new Error(`Invalid bundle format: ${n}`)}oa(){var n=this;return(0,I.Z)(function*(){const r=yield n.Zo.read();if(!r.done){const i=new Uint8Array(n.buffer.length+r.value.length);i.set(n.buffer),i.set(r.value,n.buffer.length),n.buffer=i}return r.done})()}}class Hm{constructor(n){this.datastore=n,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(n){var r=this;return(0,I.Z)(function*(){if(r.ensureCommitNotCalled(),r.mutations.length>0)throw new x(w.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const i=yield(o=(0,I.Z)(function*(a,u){const c=k(a),l=Es(c.N)+"/documents",h={documents:u.map(E=>Is(c.N,E))},d=yield c.Ki("BatchGetDocuments",l,h),g=new Map;d.forEach(E=>{const b=function(s,n){return"found"in n?function(r,i){z(!!i.found);const o=Mt(r,i.found.name),a=Ge(i.found.updateTime),u=new st({mapValue:{fields:i.found.fields}});return ve.newFoundDocument(o,a,u)}(s,n):"missing"in n?function(r,i){z(!!i.missing),z(!!i.readTime);const o=Mt(r,i.missing),a=Ge(i.readTime);return ve.newNoDocument(o,a)}(s,n):B()}(c.N,E);g.set(b.key.toString(),b)});const _=[];return u.forEach(E=>{const b=g.get(E.toString());z(!!b),_.push(b)}),_}),function(a,u){return o.apply(this,arguments)})(r.datastore,n);var o;return i.forEach(o=>r.recordVersion(o)),i})()}set(n,r){this.write(r.toMutation(n,this.precondition(n))),this.writtenDocs.add(n.toString())}update(n,r){try{this.write(r.toMutation(n,this.preconditionForUpdate(n)))}catch(i){this.lastWriteError=i}this.writtenDocs.add(n.toString())}delete(n){this.write(new ys(n,this.precondition(n))),this.writtenDocs.add(n.toString())}commit(){var n=this;return(0,I.Z)(function*(){if(n.ensureCommitNotCalled(),n.lastWriteError)throw n.lastWriteError;const r=n.readVersions;var i;n.mutations.forEach(i=>{r.delete(i.key.toString())}),r.forEach((i,o)=>{const a=U.fromPath(o);n.mutations.push(new Bo(a,n.precondition(a)))}),yield(i=(0,I.Z)(function*(o,a){const u=k(o),c=Es(u.N)+"/documents",l={writes:a.map(h=>Ti(u.N,h))};yield u.Li("Commit",c,l)}),function(o,a){return i.apply(this,arguments)})(n.datastore,n.mutations),n.committed=!0})()}recordVersion(n){let r;if(n.isFoundDocument())r=n.version;else{if(!n.isNoDocument())throw B();r=Q.min()}const i=this.readVersions.get(n.key.toString());if(i){if(!r.isEqual(i))throw new x(w.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(n.key.toString(),r)}precondition(n){const r=this.readVersions.get(n.toString());return!this.writtenDocs.has(n.toString())&&r?ke.updateTime(r):ke.none()}preconditionForUpdate(n){const r=this.readVersions.get(n.toString());if(!this.writtenDocs.has(n.toString())&&r){if(r.isEqual(Q.min()))throw new x(w.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ke.updateTime(r)}return ke.exists(!0)}write(n){this.ensureCommitNotCalled(),this.mutations.push(n)}ensureCommitNotCalled(){}}class Qm{constructor(n,r,i,o){this.asyncQueue=n,this.datastore=r,this.updateFunction=i,this.deferred=o,this.aa=5,this.rr=new ga(this.asyncQueue,"transaction_retry")}run(){this.aa-=1,this.ca()}ca(){var n=this;this.rr.Xi((0,I.Z)(function*(){const r=new Hm(n.datastore),i=n.ua(r);i&&i.then(o=>{n.asyncQueue.enqueueAndForget(()=>r.commit().then(()=>{n.deferred.resolve(o)}).catch(a=>{n.ha(a)}))}).catch(o=>{n.ha(o)})}))}ua(n){try{const r=this.updateFunction(n);return!En(r)&&r.catch&&r.then?r:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(r){return this.deferred.reject(r),null}}ha(n){this.aa>0&&this.la(n)?(this.aa-=1,this.asyncQueue.enqueueAndForget(()=>(this.ca(),Promise.resolve()))):this.deferred.reject(n)}la(n){if("FirebaseError"===n.name){const r=n.code;return"aborted"===r||"failed-precondition"===r||!ll(r)}return!1}}class Ym{constructor(n,r,i){var o=this;this.credentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=He.UNAUTHENTICATED,this.clientId=Oc.I(),this.credentialListener=()=>Promise.resolve(),this.credentials.start(r,function(){var a=(0,I.Z)(function*(u){N("FirestoreClient","Received user=",u.uid),yield o.credentialListener(u),o.user=u});return function(u){return a.apply(this,arguments)}}())}getConfiguration(){var n=this;return(0,I.Z)(function*(){return{asyncQueue:n.asyncQueue,databaseInfo:n.databaseInfo,clientId:n.clientId,credentials:n.credentials,initialUser:n.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(n){this.credentialListener=n}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new x(w.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var n=this;this.asyncQueue.enterRestrictedMode();const r=new qe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,I.Z)(function*(){try{n.onlineComponents&&(yield n.onlineComponents.terminate()),n.offlineComponents&&(yield n.offlineComponents.terminate()),n.credentials.shutdown(),r.resolve()}catch(i){const o=br(i,"Failed to shutdown persistence");r.reject(o)}})),r.promise}}function Oh(s,n){return lu.apply(this,arguments)}function lu(){return(lu=(0,I.Z)(function*(s,n){s.asyncQueue.verifyOperationInProgress(),N("FirestoreClient","Initializing OfflineComponentProvider");const r=yield s.getConfiguration();yield n.initialize(r);let i=r.initialUser;s.setCredentialChangeListener(function(){var o=(0,I.Z)(function*(a){i.isEqual(a)||(yield rh(n.localStore,a),i=a)});return function(a){return o.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener(()=>s.terminate()),s.offlineComponents=n})).apply(this,arguments)}function Lh(s,n){return hu.apply(this,arguments)}function hu(){return(hu=(0,I.Z)(function*(s,n){s.asyncQueue.verifyOperationInProgress();const r=yield du(s);N("FirestoreClient","Initializing OnlineComponentProvider");const i=yield s.getConfiguration();yield n.initialize(r,i),s.setCredentialChangeListener(o=>{return(a=(0,I.Z)(function*(u,c){const l=k(u);l.asyncQueue.verifyOperationInProgress(),N("RemoteStore","RemoteStore received new credentials");const h=an(l);l.Kr.add(3),yield Tr(l),h&&l.Wr.set("Unknown"),yield l.remoteSyncer.handleCredentialChange(c),l.Kr.delete(3),yield Ns(l)}),function(u,c){return a.apply(this,arguments)})(n.remoteStore,o);var a}),s.onlineComponents=n})).apply(this,arguments)}function du(s){return fu.apply(this,arguments)}function fu(){return(fu=(0,I.Z)(function*(s){return s.offlineComponents||(N("FirestoreClient","Using default OfflineComponentProvider"),yield Oh(s,new Dh)),s.offlineComponents})).apply(this,arguments)}function Mi(s){return gu.apply(this,arguments)}function gu(){return(gu=(0,I.Z)(function*(s){return s.onlineComponents||(N("FirestoreClient","Using default OnlineComponentProvider"),yield Lh(s,new cu)),s.onlineComponents})).apply(this,arguments)}function Ph(s){return du(s).then(n=>n.persistence)}function mu(s){return du(s).then(n=>n.localStore)}function Mh(s){return Mi(s).then(n=>n.remoteStore)}function pu(s){return Mi(s).then(n=>n.syncEngine)}function Dr(s){return yu.apply(this,arguments)}function yu(){return(yu=(0,I.Z)(function*(s){const n=yield Mi(s),r=n.eventManager;return r.onListen=Cm.bind(null,n.syncEngine),r.onUnlisten=Dm.bind(null,n.syncEngine),r})).apply(this,arguments)}function Fh(s,n,r={}){const i=new qe;return s.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return function(o,a,u,c,l){const h=new Pi({next:g=>{a.enqueueAndForget(()=>La(o,d));const _=g.docs.has(u);!_&&g.fromCache?l.reject(new x(w.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&g.fromCache&&c&&"server"===c.source?l.reject(new x(w.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(g)},error:g=>l.reject(g)}),d=new Fa(ar(u.path),h,{includeMetadataChanges:!0,uo:!0});return Ra(o,d)}(yield Dr(s),s.asyncQueue,n,r,i)})),i.promise}function Uh(s,n,r={}){const i=new qe;return s.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return function(o,a,u,c,l){const h=new Pi({next:g=>{a.enqueueAndForget(()=>La(o,d)),g.fromCache&&"server"===c.source?l.reject(new x(w.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(g)},error:g=>l.reject(g)}),d=new Fa(u,h,{includeMetadataChanges:!0,uo:!0});return Ra(o,d)}(yield Dr(s),s.asyncQueue,n,r,i)})),i.promise}class op{constructor(n,r,i,o,a,u,c,l){this.databaseId=n,this.appId=r,this.persistenceKey=i,this.host=o,this.ssl=a,this.forceLongPolling=u,this.autoDetectLongPolling=c,this.useFetchStreams=l}}class kr{constructor(n,r){this.projectId=n,this.database=r||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(n){return n instanceof kr&&n.projectId===this.projectId&&n.database===this.database}}const Vh=new Map;function vu(s,n,r){if(!r)throw new x(w.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${n}.`)}function Bh(s,n,r,i){if(!0===n&&!0===i)throw new x(w.INVALID_ARGUMENT,`${s} and ${r} cannot be used together.`)}function qh(s){if(!U.isDocumentKey(s))throw new x(w.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function jh(s){if(U.isDocumentKey(s))throw new x(w.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function Fi(s){if(void 0===s)return"undefined";if(null===s)return"null";if("string"==typeof s)return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if("number"==typeof s||"boolean"==typeof s)return""+s;if("object"==typeof s){if(s instanceof Array)return"an array";{const n=(r=s).constructor?r.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var r;return"function"==typeof s?"a function":B()}function se(s,n){if("_delegate"in s&&(s=s._delegate),!(s instanceof n)){if(n.name===s.constructor.name)throw new x(w.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=Fi(s);throw new x(w.INVALID_ARGUMENT,`Expected type '${n.name}', but it was: ${r}`)}}return s}function Kh(s,n){if(n<=0)throw new x(w.INVALID_ARGUMENT,`Function ${s}() requires a positive number, but it was: ${n}.`)}class Gh{constructor(n){var r;if(void 0===n.host){if(void 0!==n.ssl)throw new x(w.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=n.host,this.ssl=null===(r=n.ssl)||void 0===r||r;if(this.credentials=n.credentials,this.ignoreUndefinedProperties=!!n.ignoreUndefinedProperties,void 0===n.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==n.cacheSizeBytes&&n.cacheSizeBytes<1048576)throw new x(w.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=n.cacheSizeBytes}this.experimentalForceLongPolling=!!n.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!n.experimentalAutoDetectLongPolling,this.useFetchStreams=!!n.useFetchStreams,Bh("experimentalForceLongPolling",n.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",n.experimentalAutoDetectLongPolling)}isEqual(n){return this.host===n.host&&this.ssl===n.ssl&&this.credentials===n.credentials&&this.cacheSizeBytes===n.cacheSizeBytes&&this.experimentalForceLongPolling===n.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===n.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===n.ignoreUndefinedProperties&&this.useFetchStreams===n.useFetchStreams}}class Ds{constructor(n,r){this._credentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Gh({}),this._settingsFrozen=!1,n instanceof kr?this._databaseId=n:(this._app=n,this._databaseId=function(i){if(!Object.prototype.hasOwnProperty.apply(i.options,["projectId"]))throw new x(w.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new kr(i.options.projectId)}(n))}get app(){if(!this._app)throw new x(w.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(n){if(this._settingsFrozen)throw new x(w.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Gh(n),void 0!==n.credentials&&(this._credentials=function(r){if(!r)return new Df;switch(r.type){case"gapi":const i=r.client;return z(!("object"!=typeof i||null===i||!i.auth||!i.auth.getAuthHeaderValueForFirstParty)),new Lf(i,r.sessionIndex||"0",r.iamToken||null);case"provider":return r.client;default:throw new x(w.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(n.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=Vh.get(n);r&&(N("ComponentProvider","Removing Datastore"),Vh.delete(n),r.terminate())}(this),Promise.resolve()}}class pe{constructor(n,r,i){this.converter=r,this._key=i,this.type="document",this.firestore=n}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ut(this.firestore,this.converter,this._key.path.popLast())}withConverter(n){return new pe(this.firestore,n,this._key)}}class ot{constructor(n,r,i){this.converter=r,this._query=i,this.type="query",this.firestore=n}withConverter(n){return new ot(this.firestore,n,this._query)}}class Ut extends ot{constructor(n,r,i){super(n,r,ar(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const n=this._path.popLast();return n.isEmpty()?null:new pe(this.firestore,null,new U(n))}withConverter(n){return new Ut(this.firestore,n,this._path)}}function $h(s,n,...r){if(s=(0,Y.m9)(s),vu("collection","path",n),s instanceof Ds){const i=ue.fromString(n,...r);return jh(i),new Ut(s,null,i)}{if(!(s instanceof pe||s instanceof Ut))throw new x(w.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=s._path.child(ue.fromString(n,...r));return jh(i),new Ut(s.firestore,null,i)}}function Ui(s,n,...r){if(s=(0,Y.m9)(s),1===arguments.length&&(n=Oc.I()),vu("doc","path",n),s instanceof Ds){const i=ue.fromString(n,...r);return qh(i),new pe(s,null,new U(i))}{if(!(s instanceof pe||s instanceof Ut))throw new x(w.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=s._path.child(ue.fromString(n,...r));return qh(i),new pe(s.firestore,s instanceof Ut?s.converter:null,new U(i))}}function zh(s,n){return s=(0,Y.m9)(s),n=(0,Y.m9)(n),(s instanceof pe||s instanceof Ut)&&(n instanceof pe||n instanceof Ut)&&s.firestore===n.firestore&&s.path===n.path&&s.converter===n.converter}function Wh(s,n){return s=(0,Y.m9)(s),n=(0,Y.m9)(n),s instanceof ot&&n instanceof ot&&s.firestore===n.firestore&&fs(s._query,n._query)&&s.converter===n.converter}class cp{constructor(){this.fa=Promise.resolve(),this.da=[],this.wa=!1,this._a=[],this.ma=null,this.ga=!1,this.ya=!1,this.pa=[],this.rr=new ga(this,"async_queue_retry"),this.Ea=()=>{const r=Ri();r&&N("AsyncQueue","Visibility state changed to "+r.visibilityState),this.rr.tr()};const n=Ri();n&&"function"==typeof n.addEventListener&&n.addEventListener("visibilitychange",this.Ea)}get isShuttingDown(){return this.wa}enqueueAndForget(n){this.enqueue(n)}enqueueAndForgetEvenWhileRestricted(n){this.Ta(),this.Ia(n)}enterRestrictedMode(n){if(!this.wa){this.wa=!0,this.ya=n||!1;const r=Ri();r&&"function"==typeof r.removeEventListener&&r.removeEventListener("visibilitychange",this.Ea)}}enqueue(n){if(this.Ta(),this.wa)return new Promise(()=>{});const r=new qe;return this.Ia(()=>this.wa&&this.ya?Promise.resolve():(n().then(r.resolve,r.reject),r.promise)).then(()=>r.promise)}enqueueRetryable(n){this.enqueueAndForget(()=>(this.da.push(n),this.Aa()))}Aa(){var n=this;return(0,I.Z)(function*(){if(0!==n.da.length){try{yield n.da[0](),n.da.shift(),n.rr.reset()}catch(r){if(!An(r))throw r;N("AsyncQueue","Operation failed with retryable error: "+r)}n.da.length>0&&n.rr.Xi(()=>n.Aa())}})()}Ia(n){const r=this.fa.then(()=>(this.ga=!0,n().catch(i=>{throw this.ma=i,this.ga=!1,Ce("INTERNAL UNHANDLED ERROR: ",function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),a}(i)),i}).then(i=>(this.ga=!1,i))));return this.fa=r,r}enqueueAfterDelay(n,r,i){this.Ta(),this.pa.indexOf(n)>-1&&(r=0);const o=ka.createAndSchedule(this,n,r,i,a=>this.Ra(a));return this._a.push(o),o}Ta(){this.ma&&B()}verifyOperationInProgress(){}ba(){var n=this;return(0,I.Z)(function*(){let r;do{r=n.fa,yield r}while(r!==n.fa)})()}Pa(n){for(const r of this._a)if(r.timerId===n)return!0;return!1}va(n){return this.ba().then(()=>{this._a.sort((r,i)=>r.targetTimeMs-i.targetTimeMs);for(const r of this._a)if(r.skipDelay(),"all"!==n&&r.timerId===n)break;return this.ba()})}Va(n){this.pa.push(n)}Ra(n){const r=this._a.indexOf(n);this._a.splice(r,1)}}function wu(s){return function(n,r){if("object"!=typeof n||null===n)return!1;const i=n;for(const o of["next","error","complete"])if(o in i&&"function"==typeof i[o])return!0;return!1}(s)}class lp{constructor(){this._progressObserver={},this._taskCompletionResolver=new qe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(n,r,i){this._progressObserver={next:n,error:r,complete:i}}catch(n){return this._taskCompletionResolver.promise.catch(n)}then(n,r){return this._taskCompletionResolver.promise.then(n,r)}_completeWith(n){this._updateProgress(n),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(n)}_failWith(n){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(n),this._taskCompletionResolver.reject(n)}_updateProgress(n){this._lastProgress=n,this._progressObserver.next&&this._progressObserver.next(n)}}class xe extends Ds{constructor(n,r){super(n,r),this.type="firestore",this._queue=new cp,this._persistenceKey="name"in n?n.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Zh(this),this._firestoreClient.terminate()}}function Me(s){return s._firestoreClient||Zh(s),s._firestoreClient.verifyNotTerminated(),s._firestoreClient}function Zh(s){var n;const r=s._freezeSettings(),i=(a=(null===(n=s._app)||void 0===n?void 0:n.options.appId)||"",new op(s._databaseId,a,s._persistenceKey,(c=r).host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,c.useFetchStreams));var a,c;s._firestoreClient=new Ym(s._credentials,s._queue,i)}function Hh(s,n,r){const i=new qe;return s.asyncQueue.enqueue((0,I.Z)(function*(){try{yield Oh(s,r),yield Lh(s,n),i.resolve()}catch(o){if(!("FirebaseError"===(a=o).name?a.code===w.FAILED_PRECONDITION||a.code===w.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&a instanceof DOMException)||22===a.code||20===a.code||11===a.code))throw o;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+o),i.reject(o)}var a})).then(()=>i.promise)}function Qh(s){if(s._initialized||s._terminated)throw new x(w.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Wt{constructor(...n){for(let r=0;r<n.length;++r)if(0===n[r].length)throw new x(w.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Qe(n)}isEqual(n){return this._internalPath.isEqual(n._internalPath)}}class Vt{constructor(n){this._byteString=n}static fromBase64String(n){try{return new Vt(Ke.fromBase64String(n))}catch(r){throw new x(w.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(n){return new Vt(Ke.fromUint8Array(n))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(n){return this._byteString.isEqual(n._byteString)}}class kn{constructor(n){this._methodName=n}}class Vi{constructor(n,r){if(!isFinite(n)||n<-90||n>90)throw new x(w.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+n);if(!isFinite(r)||r<-180||r>180)throw new x(w.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=n,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(n){return this._lat===n._lat&&this._long===n._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(n){return te(this._lat,n._lat)||te(this._long,n._long)}}const _p=/^__.*__$/;class Ip{constructor(n,r,i){this.data=n,this.fieldMask=r,this.fieldTransforms=i}toMutation(n,r){return null!==this.fieldMask?new en(n,this.data,this.fieldMask,r,this.fieldTransforms):new ps(n,this.data,r,this.fieldTransforms)}}class Yh{constructor(n,r,i){this.data=n,this.fieldMask=r,this.fieldTransforms=i}toMutation(n,r){return new en(n,this.data,this.fieldMask,r,this.fieldTransforms)}}function Jh(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B()}}class Bi{constructor(n,r,i,o,a,u){this.settings=n,this.databaseId=r,this.N=i,this.ignoreUndefinedProperties=o,void 0===a&&this.Sa(),this.fieldTransforms=a||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Da(){return this.settings.Da}Ca(n){return new Bi(Object.assign(Object.assign({},this.settings),n),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Na(n){var r;const i=null===(r=this.path)||void 0===r?void 0:r.child(n),o=this.Ca({path:i,xa:!1});return o.ka(n),o}$a(n){var r;const i=null===(r=this.path)||void 0===r?void 0:r.child(n),o=this.Ca({path:i,xa:!1});return o.Sa(),o}Oa(n){return this.Ca({path:void 0,xa:!0})}Fa(n){return ji(n,this.settings.methodName,this.settings.Ma||!1,this.path,this.settings.La)}contains(n){return void 0!==this.fieldMask.find(r=>n.isPrefixOf(r))||void 0!==this.fieldTransforms.find(r=>n.isPrefixOf(r.field))}Sa(){if(this.path)for(let n=0;n<this.path.length;n++)this.ka(this.path.get(n))}ka(n){if(0===n.length)throw this.Fa("Document fields must not be empty");if(Jh(this.Da)&&_p.test(n))throw this.Fa('Document fields cannot begin and end with "__"')}}class Ep{constructor(n,r,i){this.databaseId=n,this.ignoreUndefinedProperties=r,this.N=i||As(n)}Ba(n,r,i,o=!1){return new Bi({Da:n,methodName:r,La:i,path:Qe.emptyPath(),xa:!1,Ma:o},this.databaseId,this.N,this.ignoreUndefinedProperties)}}function Rn(s){const n=s._freezeSettings(),r=As(s._databaseId);return new Ep(s._databaseId,!!n.ignoreUndefinedProperties,r)}function qi(s,n,r,i,o,a={}){const u=s.Ba(a.merge||a.mergeFields?2:0,n,r,o);Tu("Data must be an object, but it was:",u,i);const c=td(i,u);let l,h;if(a.merge)l=new rr(u.fieldMask),h=u.fieldTransforms;else if(a.mergeFields){const d=[];for(const g of a.mergeFields){const _=Su(n,g,r);if(!u.contains(_))throw new x(w.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);rd(d,_)||d.push(_)}l=new rr(d),h=u.fieldTransforms.filter(g=>l.covers(g.field))}else l=null,h=u.fieldTransforms;return new Ip(new st(c),l,h)}class ks extends kn{_toFieldTransform(n){if(2!==n.Da)throw n.Fa(1===n.Da?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return n.fieldMask.push(n.path),null}isEqual(n){return n instanceof ks}}function Xh(s,n,r){return new Bi({Da:3,La:n.settings.La,methodName:s._methodName,xa:r},n.databaseId,n.N,n.ignoreUndefinedProperties)}class _u extends kn{_toFieldTransform(n){return new ms(n.path,new cr)}isEqual(n){return n instanceof _u}}class Tp extends kn{constructor(n,r){super(n),this.Ua=r}_toFieldTransform(n){const r=Xh(this,n,!0),i=this.Ua.map(a=>On(a,r)),o=new Sn(i);return new ms(n.path,o)}isEqual(n){return this===n}}class Sp extends kn{constructor(n,r){super(n),this.Ua=r}_toFieldTransform(n){const r=Xh(this,n,!0),i=this.Ua.map(a=>On(a,r)),o=new xn(i);return new ms(n.path,o)}isEqual(n){return this===n}}class xp extends kn{constructor(n,r){super(n),this.qa=r}_toFieldTransform(n){const r=new lr(n.N,Xc(n.N,this.qa));return new ms(n.path,r)}isEqual(n){return this===n}}function Iu(s,n,r,i){const o=s.Ba(1,n,r);Tu("Data must be an object, but it was:",o,i);const a=[],u=st.empty();In(i,(l,h)=>{const d=xu(n,l,r);h=(0,Y.m9)(h);const g=o.$a(d);if(h instanceof ks)a.push(d);else{const _=On(h,g);null!=_&&(a.push(d),u.set(d,_))}});const c=new rr(a);return new Yh(u,c,o.fieldTransforms)}function Eu(s,n,r,i,o,a){const u=s.Ba(1,n,r),c=[Su(n,i,r)],l=[o];if(a.length%2!=0)throw new x(w.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<a.length;_+=2)c.push(Su(n,a[_])),l.push(a[_+1]);const h=[],d=st.empty();for(let _=c.length-1;_>=0;--_)if(!rd(h,c[_])){const E=c[_];let b=l[_];b=(0,Y.m9)(b);const M=u.$a(E);if(b instanceof ks)h.push(E);else{const W=On(b,M);null!=W&&(h.push(E),d.set(E,W))}}const g=new rr(h);return new Yh(d,g,u.fieldTransforms)}function ed(s,n,r,i=!1){return On(r,s.Ba(i?4:3,n))}function On(s,n){if(nd(s=(0,Y.m9)(s)))return Tu("Unsupported field value:",n,s),td(s,n);if(s instanceof kn)return function(r,i){if(!Jh(i.Da))throw i.Fa(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Fa(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(s,n),null;if(void 0===s&&n.ignoreUndefinedProperties)return null;if(n.path&&n.fieldMask.push(n.path),s instanceof Array){if(n.settings.xa&&4!==n.Da)throw n.Fa("Nested arrays are not supported");return function(r,i){const o=[];let a=0;for(const u of r){let c=On(u,i.Oa(a));null==c&&(c={nullValue:"NULL_VALUE"}),o.push(c),a++}return{arrayValue:{values:o}}}(s,n)}return function(r,i){if(null===(r=(0,Y.m9)(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return Xc(i.N,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const o=je.fromDate(r);return{timestampValue:_s(i.N,o)}}if(r instanceof je){const o=new je(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:_s(i.N,o)}}if(r instanceof Vi)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Vt)return{bytesValue:wl(i.N,r._byteString)};if(r instanceof pe){const o=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw i.Fa(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:jo(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Fa(`Unsupported field value: ${Fi(r)}`)}(s,n)}function td(s,n){const r={};return Mc(s)?n.path&&n.path.length>0&&n.fieldMask.push(n.path):In(s,(i,o)=>{const a=On(o,n.Na(i));null!=a&&(r[i]=a)}),{mapValue:{fields:r}}}function nd(s){return!("object"!=typeof s||null===s||s instanceof Array||s instanceof Date||s instanceof je||s instanceof Vi||s instanceof Vt||s instanceof pe||s instanceof kn)}function Tu(s,n,r){if(!nd(r)||"object"!=typeof(i=r)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const i=Fi(r);throw n.Fa("an object"===i?s+" a custom object":s+" "+i)}var i}function Su(s,n,r){if((n=(0,Y.m9)(n))instanceof Wt)return n._internalPath;if("string"==typeof n)return xu(s,n);throw ji("Field path arguments must be of type string or FieldPath.",s,!1,void 0,r)}const bp=new RegExp("[~\\*/\\[\\]]");function xu(s,n,r){if(n.search(bp)>=0)throw ji(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,r);try{return new Wt(...n.split("."))._internalPath}catch(i){throw ji(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,r)}}function ji(s,n,r,i,o){const a=i&&!i.isEmpty(),u=void 0!==o;let c=`Function ${n}() called with invalid data`;r&&(c+=" (via `toFirestore()`)"),c+=". ";let l="";return(a||u)&&(l+=" (found",a&&(l+=` in field ${i}`),u&&(l+=` in document ${o}`),l+=")"),new x(w.INVALID_ARGUMENT,c+s+l)}function rd(s,n){return s.some(r=>r.isEqual(n))}class Rs{constructor(n,r,i,o,a){this._firestore=n,this._userDataWriter=r,this._key=i,this._document=o,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new pe(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const n=new Ap(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(n)}return this._userDataWriter.convertValue(this._document.data.value)}}get(n){if(this._document){const r=this._document.data.field(Ki("DocumentSnapshot.get",n));if(null!==r)return this._userDataWriter.convertValue(r)}}}class Ap extends Rs{data(){return super.data()}}function Ki(s,n){return"string"==typeof n?xu(s,n):n instanceof Wt?n._internalPath:n._delegate._internalPath}class Ln{constructor(n,r){this.hasPendingWrites=n,this.fromCache=r}isEqual(n){return this.hasPendingWrites===n.hasPendingWrites&&this.fromCache===n.fromCache}}class Zt extends Rs{constructor(n,r,i,o,a,u){super(n,r,i,o,u),this._firestore=n,this._firestoreImpl=n,this.metadata=a}exists(){return super.exists()}data(n={}){if(this._document){if(this._converter){const r=new Os(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,n)}return this._userDataWriter.convertValue(this._document.data.value,n.serverTimestamps)}}get(n,r={}){if(this._document){const i=this._document.data.field(Ki("DocumentSnapshot.get",n));if(null!==i)return this._userDataWriter.convertValue(i,r.serverTimestamps)}}}class Os extends Zt{data(n={}){return super.data(n)}}class cn{constructor(n,r,i,o){this._firestore=n,this._userDataWriter=r,this._snapshot=o,this.metadata=new Ln(o.hasPendingWrites,o.fromCache),this.query=i}get docs(){const n=[];return this.forEach(r=>n.push(r)),n}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(n,r){this._snapshot.docs.forEach(i=>{n.call(r,new Os(this._firestore,this._userDataWriter,i.key,i,new Ln(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(n={}){const r=!!n.includeMetadataChanges;if(r&&this._snapshot.excludesMetadataChanges)throw new x(w.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===r||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>({type:"added",doc:new Os(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Ln(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>o||3!==u.type).map(u=>{const c=new Os(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Ln(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let l=-1,h=-1;return 0!==u.type&&(l=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),1!==u.type&&(a=a.add(u.doc),h=a.indexOf(u.doc.key)),{type:Np(u.type),doc:c,oldIndex:l,newIndex:h}})}}(this,r),this._cachedChangesIncludeMetadataChanges=r),this._cachedChanges}}function Np(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B()}}function sd(s,n){return s instanceof Zt&&n instanceof Zt?s._firestore===n._firestore&&s._key.isEqual(n._key)&&(null===s._document?null===n._document:s._document.isEqual(n._document))&&s._converter===n._converter:s instanceof cn&&n instanceof cn&&s._firestore===n._firestore&&Wh(s.query,n.query)&&s.metadata.isEqual(n.metadata)&&s._snapshot.isEqual(n._snapshot)}function id(s){if(pi(s)&&0===s.explicitOrderBy.length)throw new x(w.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ls{}function ln(s,...n){for(const r of n)s=r._apply(s);return s}class Cp extends Ls{constructor(n,r,i){super(),this.Ka=n,this.ja=r,this.Qa=i,this.type="where"}_apply(n){const r=Rn(n.firestore),i=function(o,a,u,c,l,h,d){let g;if(l.isKeyField()){if("array-contains"===h||"array-contains-any"===h)throw new x(w.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on FieldPath.documentId().`);if("in"===h||"not-in"===h){hd(d,h);const E=[];for(const b of d)E.push(ld(c,o,b));g={arrayValue:{values:E}}}else g=ld(c,o,d)}else"in"!==h&&"not-in"!==h&&"array-contains-any"!==h||hd(d,h),g=ed(u,"where",d,"in"===h||"not-in"===h);const _=ct.create(l,h,g);return function(E,b){if(b.v()){const W=Mo(E);if(null!==W&&!W.isEqual(b.field))throw new x(w.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${W.toString()}' and '${b.field.toString()}'`);const ge=Po(E);null!==ge&&dd(0,b.field,ge)}const M=function(W,ge){for(const Fe of W.filters)if(ge.indexOf(Fe.op)>=0)return Fe.op;return null}(E,function(W){switch(W){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(b.op));if(null!==M)throw new x(w.INVALID_ARGUMENT,M===b.op?`Invalid query. You cannot use more than one '${b.op.toString()}' filter.`:`Invalid query. You cannot use '${b.op.toString()}' filters with '${M.toString()}' filters.`)}(o,_),_}(n._query,0,r,n.firestore._databaseId,this.Ka,this.ja,this.Qa);return new ot(n.firestore,n.converter,function(o,a){const u=o.filters.concat([a]);return new Kt(o.path,o.collectionGroup,o.explicitOrderBy.slice(),u,o.limit,o.limitType,o.startAt,o.endAt)}(n._query,i))}}class kp extends Ls{constructor(n,r){super(),this.Ka=n,this.Wa=r,this.type="orderBy"}_apply(n){const r=function(i,o,a){if(null!==i.startAt)throw new x(w.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new x(w.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const u=new or(o,a);return function(c,l){if(null===Po(c)){const h=Mo(c);null!==h&&dd(0,h,l.field)}}(i,u),u}(n._query,this.Ka,this.Wa);return new ot(n.firestore,n.converter,function(i,o){const a=i.explicitOrderBy.concat([o]);return new Kt(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(n._query,r))}}class od extends Ls{constructor(n,r,i){super(),this.type=n,this.Ga=r,this.za=i}_apply(n){return new ot(n.firestore,n.converter,Zc(n._query,this.Ga,this.za))}}class ad extends Ls{constructor(n,r,i){super(),this.type=n,this.Ha=r,this.Ja=i}_apply(n){const r=cd(n,this.type,this.Ha,this.Ja);return new ot(n.firestore,n.converter,(o=r,new Kt((i=n._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,o,i.endAt)));var i,o}}class ud extends Ls{constructor(n,r,i){super(),this.type=n,this.Ha=r,this.Ja=i}_apply(n){const r=cd(n,this.type,this.Ha,this.Ja);return new ot(n.firestore,n.converter,(o=r,new Kt((i=n._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,o)));var i,o}}function cd(s,n,r,i){if(r[0]=(0,Y.m9)(r[0]),r[0]instanceof Rs)return function(o,a,u,c,l){if(!c)throw new x(w.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const h=[];for(const d of ur(o))if(d.field.isKeyField())h.push(li(a,c.key));else{const g=c.data.field(d.field);if(Do(g))throw new x(w.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+d.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===g){const _=d.field.canonicalString();throw new x(w.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}h.push(g)}return new ds(h,l)}(s._query,s.firestore._databaseId,n,r[0]._document,i);{const o=Rn(s.firestore);return function(a,u,c,l,h,d){const g=a.explicitOrderBy;if(h.length>g.length)throw new x(w.INVALID_ARGUMENT,`Too many arguments provided to ${l}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const _=[];for(let E=0;E<h.length;E++){const b=h[E];if(g[E].field.isKeyField()){if("string"!=typeof b)throw new x(w.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${l}(), but got a ${typeof b}`);if(!Fo(a)&&-1!==b.indexOf("/"))throw new x(w.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${l}() must be a plain document ID, but '${b}' contains a slash.`);const M=a.path.child(ue.fromString(b));if(!U.isDocumentKey(M))throw new x(w.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${l}() must result in a valid document path, but '${M}' is not because it contains an odd number of segments.`);const W=new U(M);_.push(li(u,W))}else{const M=ed(c,l,b);_.push(M)}}return new ds(_,d)}(s._query,s.firestore._databaseId,o,n,r,i)}}function ld(s,n,r){if("string"==typeof(r=(0,Y.m9)(r))){if(""===r)throw new x(w.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Fo(n)&&-1!==r.indexOf("/"))throw new x(w.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);const i=n.path.child(ue.fromString(r));if(!U.isDocumentKey(i))throw new x(w.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return li(s,new U(i))}if(r instanceof pe)return li(s,r._key);throw new x(w.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${Fi(r)}.`)}function hd(s,n){if(!Array.isArray(s)||0===s.length)throw new x(w.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${n.toString()}' filters.`);if(s.length>10)throw new x(w.INVALID_ARGUMENT,`Invalid Query. '${n.toString()}' filters support a maximum of 10 elements in the value array.`)}function dd(s,n,r){if(!r.isEqual(n))throw new x(w.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${n.toString()}' and so you must also use '${n.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${r.toString()}' instead.`)}class bu{convertValue(n,r="none"){switch(Tn(n)){case 0:return null;case 1:return n.booleanValue;case 2:return De(n.integerValue||n.doubleValue);case 3:return this.convertTimestamp(n.timestampValue);case 4:return this.convertServerTimestamp(n,r);case 5:return n.stringValue;case 6:return this.convertBytes(sr(n.bytesValue));case 7:return this.convertReference(n.referenceValue);case 8:return this.convertGeoPoint(n.geoPointValue);case 9:return this.convertArray(n.arrayValue,r);case 10:return this.convertObject(n.mapValue,r);default:throw B()}}convertObject(n,r){const i={};return In(n.fields,(o,a)=>{i[o]=this.convertValue(a,r)}),i}convertGeoPoint(n){return new Vi(De(n.latitude),De(n.longitude))}convertArray(n,r){return(n.values||[]).map(i=>this.convertValue(i,r))}convertServerTimestamp(n,r){switch(r){case"previous":const i=Fc(n);return null==i?null:this.convertValue(i,r);case"estimate":return this.convertTimestamp(us(n));default:return null}}convertTimestamp(n){const r=Xt(n);return new je(r.seconds,r.nanos)}convertDocumentKey(n,r){const i=ue.fromString(n);z(Rl(i));const o=new kr(i.get(1),i.get(3)),a=new U(i.popFirst(5));return o.isEqual(r)||Ce(`Document ${a} contains a document reference within a different database (${o.projectId}/${o.database}) which is not supported. It will be treated as a reference in the current database (${r.projectId}/${r.database}) instead.`),a}}function Gi(s,n,r){let i;return i=s?r&&(r.merge||r.mergeFields)?s.toFirestore(n,r):s.toFirestore(n):n,i}class Vp extends bu{constructor(n){super(),this.firestore=n}convertBytes(n){return new Vt(n)}convertReference(n){const r=this.convertDocumentKey(n,this.firestore._databaseId);return new pe(this.firestore,null,r)}}class fd{constructor(n,r){this._firestore=n,this._commitHandler=r,this._mutations=[],this._committed=!1,this._dataReader=Rn(n)}set(n,r,i){this._verifyNotCommitted();const o=hn(n,this._firestore),a=Gi(o.converter,r,i),u=qi(this._dataReader,"WriteBatch.set",o._key,a,null!==o.converter,i);return this._mutations.push(u.toMutation(o._key,ke.none())),this}update(n,r,i,...o){this._verifyNotCommitted();const a=hn(n,this._firestore);let u;return u="string"==typeof(r=(0,Y.m9)(r))||r instanceof Wt?Eu(this._dataReader,"WriteBatch.update",a._key,r,i,o):Iu(this._dataReader,"WriteBatch.update",a._key,r),this._mutations.push(u.toMutation(a._key,ke.exists(!0))),this}delete(n){this._verifyNotCommitted();const r=hn(n,this._firestore);return this._mutations=this._mutations.concat(new ys(r._key,ke.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new x(w.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function hn(s,n){if((s=(0,Y.m9)(s)).firestore!==n)throw new x(w.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return s}class Pn extends bu{constructor(n){super(),this.firestore=n}convertBytes(n){return new Vt(n)}convertReference(n){const r=this.convertDocumentKey(n,this.firestore._databaseId);return new pe(this.firestore,null,r)}}function gd(s,n,r){s=se(s,pe);const i=se(s.firestore,xe),o=Gi(s.converter,n,r);return Rr(i,[qi(Rn(i),"setDoc",s._key,o,null!==s.converter,r).toMutation(s._key,ke.none())])}function md(s,n,r,...i){s=se(s,pe);const o=se(s.firestore,xe),a=Rn(o);let u;return u="string"==typeof(n=(0,Y.m9)(n))||n instanceof Wt?Eu(a,"updateDoc",s._key,n,r,i):Iu(a,"updateDoc",s._key,n),Rr(o,[u.toMutation(s._key,ke.exists(!0))])}function pd(s,...n){var r,i,o;s=(0,Y.m9)(s);let a={includeMetadataChanges:!1},u=0;"object"!=typeof n[u]||wu(n[u])||(a=n[u],u++);const c={includeMetadataChanges:a.includeMetadataChanges};if(wu(n[u])){const g=n[u];n[u]=null===(r=g.next)||void 0===r?void 0:r.bind(g),n[u+1]=null===(i=g.error)||void 0===i?void 0:i.bind(g),n[u+2]=null===(o=g.complete)||void 0===o?void 0:o.bind(g)}let l,h,d;if(s instanceof pe)h=se(s.firestore,xe),d=ar(s._key.path),l={next:g=>{n[u]&&n[u](Au(h,s,g))},error:n[u+1],complete:n[u+2]};else{const g=se(s,ot);h=se(g.firestore,xe),d=g._query;const _=new Pn(h);l={next:E=>{n[u]&&n[u](new cn(h,_,g,E))},error:n[u+1],complete:n[u+2]},id(s._query)}return function(g,_,E,b){const M=new Pi(b),W=new Fa(_,M,E);return g.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return Ra(yield Dr(g),W)})),()=>{M.Xo(),g.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return La(yield Dr(g),W)}))}}(Me(h),d,c,l)}function Rr(s,n){return function(r,i){const o=new qe;return r.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return function(s,n,r){return ja.apply(this,arguments)}(yield pu(r),i,o)})),o.promise}(Me(s),n)}function Au(s,n,r){const i=r.docs.get(n._key),o=new Pn(s);return new Zt(s,o,n._key,i,new Ln(r.hasPendingWrites,r.fromCache),n.converter)}class Hp extends class{constructor(n,r){this._firestore=n,this._transaction=r,this._dataReader=Rn(n)}get(n){const r=hn(n,this._firestore),i=new Vp(this._firestore);return this._transaction.lookup([r._key]).then(o=>{if(!o||1!==o.length)return B();const a=o[0];if(a.isFoundDocument())return new Rs(this._firestore,i,a.key,a,r.converter);if(a.isNoDocument())return new Rs(this._firestore,i,r._key,null,r.converter);throw B()})}set(n,r,i){const o=hn(n,this._firestore),a=Gi(o.converter,r,i),u=qi(this._dataReader,"Transaction.set",o._key,a,null!==o.converter,i);return this._transaction.set(o._key,u),this}update(n,r,i,...o){const a=hn(n,this._firestore);let u;return u="string"==typeof(r=(0,Y.m9)(r))||r instanceof Wt?Eu(this._dataReader,"Transaction.update",a._key,r,i,o):Iu(this._dataReader,"Transaction.update",a._key,r),this._transaction.update(a._key,u),this}delete(n){const r=hn(n,this._firestore);return this._transaction.delete(r._key),this}}{constructor(n,r){super(n,r),this._firestore=n}get(n){const r=hn(n,this._firestore),i=new Pn(this._firestore);return super.get(n).then(o=>new Zt(this._firestore,i,r._key,o._document,new Ln(!1,!1),r.converter))}}function Nu(s,n){if(void 0===n)return{merge:!1};if(void 0!==n.mergeFields&&void 0!==n.merge)throw new x("invalid-argument",`Invalid options passed to function ${s}(): You cannot specify both "merge" and "mergeFields".`);return n}function yd(){if("undefined"==typeof Uint8Array)throw new x("unimplemented","Uint8Arrays are not available in this environment.")}function vd(){if("undefined"==typeof atob)throw new x("unimplemented","Blobs are unavailable in Firestore in this environment.")}(function(s){tr=s})(Ue.SDK_VERSION),(0,Ue._registerComponent)(new _e.wA("firestore",(s,{options:n})=>{const r=s.getProvider("app").getImmediate(),i=new xe(r,new Rf(s.getProvider("auth-internal")));return n=Object.assign({useFetchStreams:!0},n),i._setSettings(n),i},"PUBLIC")),(0,Ue.registerVersion)("@firebase/firestore","3.1.0",void 0);class Ps{constructor(n){this._delegate=n}static fromBase64String(n){return vd(),new Ps(Vt.fromBase64String(n))}static fromUint8Array(n){return yd(),new Ps(Vt.fromUint8Array(n))}toBase64(){return vd(),this._delegate.toBase64()}toUint8Array(){return yd(),this._delegate.toUint8Array()}isEqual(n){return this._delegate.isEqual(n._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Cu(s){return function(s,n){if("object"!=typeof s||null===s)return!1;const r=s;for(const i of["next","error","complete"])if(i in r&&"function"==typeof r[i])return!0;return!1}(s)}class oy{enableIndexedDbPersistence(n,r){return function(s,n){Qh(s=se(s,xe));const r=Me(s),i=s._freezeSettings(),o=new cu;return Hh(r,o,new kh(o,i.cacheSizeBytes,null==n?void 0:n.forceOwnership))}(n._delegate,{forceOwnership:r})}enableMultiTabIndexedDbPersistence(n){return function(s){Qh(s=se(s,xe));const n=Me(s),r=s._freezeSettings(),i=new cu;return Hh(n,i,new Wm(i,r.cacheSizeBytes))}(n._delegate)}clearIndexedDbPersistence(n){return function(s){if(s._initialized&&!s._terminated)throw new x(w.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const n=new qe;return s._queue.enqueueAndForgetEvenWhileRestricted((0,I.Z)(function*(){try{yield(r=(0,I.Z)(function*(i){if(!Ct.bt())return Promise.resolve();const o=i+"main";yield Ct.delete(o)}),function(i){return r.apply(this,arguments)})(ta(s._databaseId,s._persistenceKey)),n.resolve()}catch(r){n.reject(r)}var r})),n.promise}(n._delegate)}}class wd{constructor(n,r,i){this._delegate=r,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},n instanceof kr||(this._appCompat=n)}get _databaseId(){return this._delegate._databaseId}settings(n){const r=this._delegate._getSettings();!n.merge&&r.host!==n.host&&os("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),n.merge&&delete(n=Object.assign(Object.assign({},r),n)).merge,this._delegate._setSettings(n)}useEmulator(n,r,i={}){!function(s,n,r,i={}){var o;const a=(s=se(s,Ds))._getSettings();if("firestore.googleapis.com"!==a.host&&a.host!==n&&os("Host has been set in both settings() and useEmulator(), emulator host will be used"),s._setSettings(Object.assign(Object.assign({},a),{host:`${n}:${r}`,ssl:!1})),i.mockUserToken){let u,c;if("string"==typeof i.mockUserToken)u=i.mockUserToken,c=He.MOCK_USER;else{u=(0,Y.Sg)(i.mockUserToken,null===(o=s._app)||void 0===o?void 0:o.options.projectId);const l=i.mockUserToken.sub||i.mockUserToken.user_id;if(!l)throw new x(w.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new He(l)}s._credentials=new kf(new Rc(u,c))}}(this._delegate,n,r,i)}enableNetwork(){return function(s){return function(s){return s.asyncQueue.enqueue((0,I.Z)(function*(){const n=yield Ph(s),r=yield Mh(s);return n.setNetworkEnabled(!0),function(i){const o=k(i);return o.Kr.delete(0),Ns(o)}(r)}))}(Me(s=se(s,xe)))}(this._delegate)}disableNetwork(){return function(s){return function(s){return s.asyncQueue.enqueue((0,I.Z)(function*(){const n=yield Ph(s),r=yield Mh(s);return n.setNetworkEnabled(!1),(i=(0,I.Z)(function*(o){const a=k(o);a.Kr.add(0),yield Tr(a),a.Wr.set("Offline")}),function(o){return i.apply(this,arguments)})(r);var i}))}(Me(s=se(s,xe)))}(this._delegate)}enablePersistence(n){let r=!1,i=!1;return n&&(r=!!n.synchronizeTabs,i=!!n.experimentalForceOwningTab,Bh("synchronizeTabs",r,"experimentalForceOwningTab",i)),r?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(s){return function(n){const r=new qe;return n.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return function(s,n){return Wa.apply(this,arguments)}(yield pu(n),r)})),r.promise}(Me(s=se(s,xe)))}(this._delegate)}onSnapshotsInSync(n){return function(s,n){return function(s,n){const r=new Pi(n);return s.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return i=yield Dr(s),o=r,k(i).Zr.add(o),void o.next();var i,o})),()=>{r.Xo(),s.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return i=yield Dr(s),o=r,void k(i).Zr.delete(o);var i,o}))}}(Me(s=se(s,xe)),wu(n)?n:{next:n})}(this._delegate,n)}get app(){if(!this._appCompat)throw new x("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(n){try{return new Or(this,$h(this._delegate,n))}catch(r){throw lt(r,"collection()","Firestore.collection()")}}doc(n){try{return new xt(this,Ui(this._delegate,n))}catch(r){throw lt(r,"doc()","Firestore.doc()")}}collectionGroup(n){try{return new ht(this,function(s,n){if(s=se(s,Ds),vu("collectionGroup","collection id",n),n.indexOf("/")>=0)throw new x(w.INVALID_ARGUMENT,`Invalid collection ID '${n}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ot(s,null,(r=n,new Kt(ue.emptyPath(),r)));var r}(this._delegate,n))}catch(r){throw lt(r,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(n){return function(s,n){return function(s,n){const r=new qe;return s.asyncQueue.enqueueAndForget((0,I.Z)(function*(){const i=yield(o=s,Mi(o).then(a=>a.datastore));var o;new Qm(s.asyncQueue,i,n,r).run()})),r.promise}(Me(s),r=>n(new Hp(s,r)))}(this._delegate,r=>n(new _d(this,r)))}batch(){return Me(this._delegate),new Id(new fd(this._delegate,n=>Rr(this._delegate,n)))}loadBundle(n){return function(s,n){const r=Me(s=se(s,xe)),i=new lp;return function(s,n,r,i){const o=function(a,u){let c;return c="string"==typeof a?(new TextEncoder).encode(a):a,l=function(l,h){if(l instanceof Uint8Array)return Rh(l,h);if(l instanceof ArrayBuffer)return Rh(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),new Zm(l,u);var l}(r,As(n));s.asyncQueue.enqueueAndForget((0,I.Z)(function*(){!function(s,n,r){const i=k(s);var o;(o=(0,I.Z)(function*(a,u,c){try{const l=yield u.getMetadata();if(yield function(_,E){const b=k(_),M=Ge(E.createTime);return b.persistence.runTransaction("hasNewerBundle","readonly",W=>b.Je.getBundleMetadata(W,E.id)).then(W=>!!W&&W.createTime.compareTo(M)>=0)}(a.localStore,l))return yield u.close(),void c._completeWith((_=l,{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}));c._updateProgress(Ih(l));const h=new xm(l,a.localStore,u.N);let d=yield u.Qo();for(;d;){const _=yield h.fo(d);_&&c._updateProgress(_),d=yield u.Qo()}const g=yield h.complete();yield zt(a,g.Tn,void 0),yield function(_,E){const b=k(_);return b.persistence.runTransaction("Save bundle","readwrite",M=>b.Je.saveBundleMetadata(M,E))}(a.localStore,l),c._completeWith(g.progress)}catch(l){os("SyncEngine",`Loading bundle failed with ${l}`),c._failWith(l)}var _}),function(a,u,c){return o.apply(this,arguments)})(i,n,r).then(()=>{i.sharedClientState.notifyBundleLoaded()})}(yield pu(s),o,i)}))}(r,s._databaseId,n,i),i}(this._delegate,n)}namedQuery(n){return function(s,n){return function(s,n){return s.asyncQueue.enqueue((0,I.Z)(function*(){return function(r,i){const o=k(r);return o.persistence.runTransaction("Get named query","readonly",a=>o.Je.getNamedQuery(a,i))}(yield mu(s),n)}))}(Me(s=se(s,xe)),n).then(r=>r?new ot(s,null,r.query):null)}(this._delegate,n).then(r=>r?new ht(this,r):null)}}class $i extends bu{constructor(n){super(),this.firestore=n}convertBytes(n){return new Ps(new Vt(n))}convertReference(n){const r=this.convertDocumentKey(n,this.firestore._databaseId);return xt.forKey(r,this.firestore,null)}}class _d{constructor(n,r){this._firestore=n,this._delegate=r,this._userDataWriter=new $i(n)}get(n){const r=Fn(n);return this._delegate.get(r).then(i=>new Ms(this._firestore,new Zt(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,r.converter)))}set(n,r,i){const o=Fn(n);return i?(Nu("Transaction.set",i),this._delegate.set(o,r,i)):this._delegate.set(o,r),this}update(n,r,i,...o){const a=Fn(n);return 2===arguments.length?this._delegate.update(a,r):this._delegate.update(a,r,i,...o),this}delete(n){const r=Fn(n);return this._delegate.delete(r),this}}class Id{constructor(n){this._delegate=n}set(n,r,i){const o=Fn(n);return i?(Nu("WriteBatch.set",i),this._delegate.set(o,r,i)):this._delegate.set(o,r),this}update(n,r,i,...o){const a=Fn(n);return 2===arguments.length?this._delegate.update(a,r):this._delegate.update(a,r,i,...o),this}delete(n){const r=Fn(n);return this._delegate.delete(r),this}commit(){return this._delegate.commit()}}class Mn{constructor(n,r,i){this._firestore=n,this._userDataWriter=r,this._delegate=i}fromFirestore(n,r){const i=new Os(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,null);return this._delegate.fromFirestore(new Fs(this._firestore,i),null!=r?r:{})}toFirestore(n,r){return r?this._delegate.toFirestore(n,r):this._delegate.toFirestore(n)}static getInstance(n,r){const i=Mn.INSTANCES;let o=i.get(n);o||(o=new WeakMap,i.set(n,o));let a=o.get(r);return a||(a=new Mn(n,new $i(n),r),o.set(r,a)),a}}Mn.INSTANCES=new WeakMap;class xt{constructor(n,r){this.firestore=n,this._delegate=r,this._userDataWriter=new $i(n)}static forPath(n,r,i){if(n.length%2!=0)throw new x("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${n.canonicalString()} has ${n.length}`);return new xt(r,new pe(r._delegate,i,new U(n)))}static forKey(n,r,i){return new xt(r,new pe(r._delegate,i,n))}get id(){return this._delegate.id}get parent(){return new Or(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(n){try{return new Or(this.firestore,$h(this._delegate,n))}catch(r){throw lt(r,"collection()","DocumentReference.collection()")}}isEqual(n){return(n=(0,Y.m9)(n))instanceof pe&&zh(this._delegate,n)}set(n,r){r=Nu("DocumentReference.set",r);try{return r?gd(this._delegate,n,r):gd(this._delegate,n)}catch(i){throw lt(i,"setDoc()","DocumentReference.set()")}}update(n,r,...i){try{return 1===arguments.length?md(this._delegate,n):md(this._delegate,n,r,...i)}catch(o){throw lt(o,"updateDoc()","DocumentReference.update()")}}delete(){return function(s){return Rr(se(s.firestore,xe),[new ys(s._key,ke.none())])}(this._delegate)}onSnapshot(...n){const r=Ed(n),i=Td(n,o=>new Ms(this.firestore,new Zt(this.firestore._delegate,this._userDataWriter,o._key,o._document,o.metadata,this._delegate.converter)));return pd(this._delegate,r,i)}get(n){let r;return r="cache"===(null==n?void 0:n.source)?function(s){s=se(s,pe);const n=se(s.firestore,xe),r=Me(n),i=new Pn(n);return function(s,n){const r=new qe;return s.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return(i=(0,I.Z)(function*(o,a,u){try{const c=yield function(l,h){const d=k(l);return d.persistence.runTransaction("read document","readonly",g=>d.Qn.An(g,h))}(o,a);c.isFoundDocument()?u.resolve(c):c.isNoDocument()?u.resolve(null):u.reject(new x(w.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(c){const l=br(c,`Failed to get document '${a} from cache`);u.reject(l)}}),function(o,a,u){return i.apply(this,arguments)})(yield mu(s),n,r);var i})),r.promise}(r,s._key).then(o=>new Zt(n,i,s._key,o,new Ln(null!==o&&o.hasLocalMutations,!0),s.converter))}(this._delegate):"server"===(null==n?void 0:n.source)?function(s){s=se(s,pe);const n=se(s.firestore,xe);return Fh(Me(n),s._key,{source:"server"}).then(r=>Au(n,s,r))}(this._delegate):function(s){s=se(s,pe);const n=se(s.firestore,xe);return Fh(Me(n),s._key).then(r=>Au(n,s,r))}(this._delegate),r.then(i=>new Ms(this.firestore,new Zt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(n){return new xt(this.firestore,this._delegate.withConverter(n?Mn.getInstance(this.firestore,n):null))}}function lt(s,n,r){return s.message=s.message.replace(n,r),s}function Ed(s){for(const n of s)if("object"==typeof n&&!Cu(n))return n;return{}}function Td(s,n){var r,i;let o;return o=Cu(s[0])?s[0]:Cu(s[1])?s[1]:"function"==typeof s[0]?{next:s[0],error:s[1],complete:s[2]}:{next:s[1],error:s[2],complete:s[3]},{next:a=>{o.next&&o.next(n(a))},error:null===(r=o.error)||void 0===r?void 0:r.bind(o),complete:null===(i=o.complete)||void 0===i?void 0:i.bind(o)}}class Ms{constructor(n,r){this._firestore=n,this._delegate=r}get ref(){return new xt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(n){return this._delegate.data(n)}get(n,r){return this._delegate.get(n,r)}isEqual(n){return sd(this._delegate,n._delegate)}}class Fs extends Ms{data(n){const r=this._delegate.data(n);return function(s,n){s||B()}(void 0!==r),r}}class ht{constructor(n,r){this.firestore=n,this._delegate=r,this._userDataWriter=new $i(n)}where(n,r,i){try{return new ht(this.firestore,ln(this._delegate,function(s,n,r){const i=n,o=Ki("where",s);return new Cp(o,i,r)}(n,r,i)))}catch(o){throw lt(o,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(n,r){try{return new ht(this.firestore,ln(this._delegate,function(s,n="asc"){const r=n,i=Ki("orderBy",s);return new kp(i,r)}(n,r)))}catch(i){throw lt(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(n){try{return new ht(this.firestore,ln(this._delegate,function(s){return Kh("limit",s),new od("limit",s,"F")}(n)))}catch(r){throw lt(r,"limit()","Query.limit()")}}limitToLast(n){try{return new ht(this.firestore,ln(this._delegate,function(s){return Kh("limitToLast",s),new od("limitToLast",s,"L")}(n)))}catch(r){throw lt(r,"limitToLast()","Query.limitToLast()")}}startAt(...n){try{return new ht(this.firestore,ln(this._delegate,function(...s){return new ad("startAt",s,!0)}(...n)))}catch(r){throw lt(r,"startAt()","Query.startAt()")}}startAfter(...n){try{return new ht(this.firestore,ln(this._delegate,function(...s){return new ad("startAfter",s,!1)}(...n)))}catch(r){throw lt(r,"startAfter()","Query.startAfter()")}}endBefore(...n){try{return new ht(this.firestore,ln(this._delegate,function(...s){return new ud("endBefore",s,!0)}(...n)))}catch(r){throw lt(r,"endBefore()","Query.endBefore()")}}endAt(...n){try{return new ht(this.firestore,ln(this._delegate,function(...s){return new ud("endAt",s,!1)}(...n)))}catch(r){throw lt(r,"endAt()","Query.endAt()")}}isEqual(n){return Wh(this._delegate,n._delegate)}get(n){let r;return r="cache"===(null==n?void 0:n.source)?function(s){s=se(s,ot);const n=se(s.firestore,xe),r=Me(n),i=new Pn(n);return function(s,n){const r=new qe;return s.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return(i=(0,I.Z)(function*(o,a,u){try{const c=yield Ci(o,a,!0),l=new Sh(a,c.Gn),h=l.Io(c.documents),d=l.applyChanges(h,!1);u.resolve(d.snapshot)}catch(c){const l=br(c,`Failed to execute query '${a} against cache`);u.reject(l)}}),function(o,a,u){return i.apply(this,arguments)})(yield mu(s),n,r);var i})),r.promise}(r,s._query).then(o=>new cn(n,i,s,o))}(this._delegate):"server"===(null==n?void 0:n.source)?function(s){s=se(s,ot);const n=se(s.firestore,xe),r=Me(n),i=new Pn(n);return Uh(r,s._query,{source:"server"}).then(o=>new cn(n,i,s,o))}(this._delegate):function(s){s=se(s,ot);const n=se(s.firestore,xe),r=Me(n),i=new Pn(n);return id(s._query),Uh(r,s._query).then(o=>new cn(n,i,s,o))}(this._delegate),r.then(i=>new Du(this.firestore,new cn(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...n){const r=Ed(n),i=Td(n,o=>new Du(this.firestore,new cn(this.firestore._delegate,this._userDataWriter,this._delegate,o._snapshot)));return pd(this._delegate,r,i)}withConverter(n){return new ht(this.firestore,this._delegate.withConverter(n?Mn.getInstance(this.firestore,n):null))}}class uy{constructor(n,r){this._firestore=n,this._delegate=r}get type(){return this._delegate.type}get doc(){return new Fs(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Du{constructor(n,r){this._firestore=n,this._delegate=r}get query(){return new ht(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(n=>new Fs(this._firestore,n))}docChanges(n){return this._delegate.docChanges(n).map(r=>new uy(this._firestore,r))}forEach(n,r){this._delegate.forEach(i=>{n.call(r,new Fs(this._firestore,i))})}isEqual(n){return sd(this._delegate,n._delegate)}}class Or extends ht{constructor(n,r){super(n,r),this.firestore=n,this._delegate=r}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const n=this._delegate.parent;return n?new xt(this.firestore,n):null}doc(n){try{return new xt(this.firestore,void 0===n?Ui(this._delegate):Ui(this._delegate,n))}catch(r){throw lt(r,"doc()","CollectionReference.doc()")}}add(n){return function(s,n){const r=se(s.firestore,xe),i=Ui(s),o=Gi(s.converter,n);return Rr(r,[qi(Rn(s.firestore),"addDoc",i._key,o,null!==s.converter,{}).toMutation(i._key,ke.exists(!1))]).then(()=>i)}(this._delegate,n).then(r=>new xt(this.firestore,r))}isEqual(n){return zh(this._delegate,n._delegate)}withConverter(n){return new Or(this.firestore,this._delegate.withConverter(n?Mn.getInstance(this.firestore,n):null))}}function Fn(s){return se(s,pe)}class ku{constructor(...n){this._delegate=new Wt(...n)}static documentId(){return new ku(Qe.keyField().canonicalString())}isEqual(n){return(n=(0,Y.m9)(n))instanceof Wt&&this._delegate._internalPath.isEqual(n._internalPath)}}class Un{constructor(n){this._delegate=n}static serverTimestamp(){const n=new _u("serverTimestamp");return n._methodName="FieldValue.serverTimestamp",new Un(n)}static delete(){const n=new ks("deleteField");return n._methodName="FieldValue.delete",new Un(n)}static arrayUnion(...n){const r=function(...s){return new Tp("arrayUnion",s)}(...n);return r._methodName="FieldValue.arrayUnion",new Un(r)}static arrayRemove(...n){const r=function(...s){return new Sp("arrayRemove",s)}(...n);return r._methodName="FieldValue.arrayRemove",new Un(r)}static increment(n){const r=function(s){return new xp("increment",s)}(n);return r._methodName="FieldValue.increment",new Un(r)}isEqual(n){return this._delegate.isEqual(n._delegate)}}const cy={Firestore:wd,GeoPoint:Vi,Timestamp:je,Blob:Ps,Transaction:_d,WriteBatch:Id,DocumentReference:xt,DocumentSnapshot:Ms,Query:ht,QueryDocumentSnapshot:Fs,QuerySnapshot:Du,CollectionReference:Or,FieldPath:ku,FieldValue:Un,setLogLevel:function(s){!function(s){Jt.setLogLevel(s)}(s)},CACHE_SIZE_UNLIMITED:-1};!function(s){(function(s,n){s.INTERNAL.registerComponent(new _e.wA("firestore-compat",r=>((n,r)=>new wd(n,r,new oy))(r.getProvider("app-compat").getImmediate(),r.getProvider("firestore").getImmediate()),"PUBLIC").setServiceProps(Object.assign({},cy)))})(s),s.registerVersion("@firebase/firestore-compat","0.1.3")}(be.Z);var dy=V(9765),fy=V(6682),zi=V(9746),dn=V(3190),Sd=V(7349),gy=V(8049);function xd(s,n){return n?(0,dn.w)(()=>s,n):(0,dn.w)(()=>s)}var Ru=V(9673);V(7841);const bd=new A.OlP("angularfire2.auth.use-emulator"),Ad=new A.OlP("angularfire2.auth.settings"),Nd=new A.OlP("angularfire2.auth.tenant-id"),Cd=new A.OlP("angularfire2.auth.langugage-code"),Dd=new A.OlP("angularfire2.auth.use-device-language"),kd=new A.OlP("angularfire.auth.persistence"),Rd=(s,n,r,i,o,a,u,c)=>(0,D.cc)(`${s.name}.auth`,"AngularFireAuth",s.name,()=>{const l=n.runOutsideAngular(()=>s.auth());if(r&&l.useEmulator(...r),i&&(l.tenantId=i),l.languageCode=o,a&&l.useDeviceLanguage(),u)for(const[h,d]of Object.entries(u))l.settings[h]=d;return c&&l.setPersistence(c),l},[r,i,o,a,u,c]);let Od=(()=>{class s{constructor(r,i,o,a,u,c,l,h,d,g,_){const E=new dy.xQ,b=(0,Xe.of)(void 0).pipe((0,zi.QV)(u.outsideAngular),(0,dn.w)(()=>a.runOutsideAngular(()=>Promise.resolve().then(V.bind(V,4828)))),(0,J.U)(()=>(0,Z.on)(r,a,i)),(0,J.U)(M=>Rd(M,a,c,h,d,g,l,_)),(0,Sd.d)({bufferSize:1,refCount:!1}));if((0,de.PM)(o))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,Xe.of)(null);else{b.pipe((0,gy.P)()).subscribe();const W=b.pipe((0,dn.w)(le=>le.getRedirectResult().then(Ae=>Ae,()=>null)),D.iC,(0,Sd.d)({bufferSize:1,refCount:!1})),ge=b.pipe((0,dn.w)(le=>new y.y(Ae=>({unsubscribe:a.runOutsideAngular(()=>le.onAuthStateChanged(It=>Ae.next(It),It=>Ae.error(It),()=>Ae.complete()))})))),Fe=b.pipe((0,dn.w)(le=>new y.y(Ae=>({unsubscribe:a.runOutsideAngular(()=>le.onIdTokenChanged(It=>Ae.next(It),It=>Ae.error(It),()=>Ae.complete()))}))));this.authState=W.pipe(xd(ge),(0,Ru.R)(u.outsideAngular),(0,zi.QV)(u.insideAngular)),this.user=W.pipe(xd(Fe),(0,Ru.R)(u.outsideAngular),(0,zi.QV)(u.insideAngular)),this.idToken=this.user.pipe((0,dn.w)(le=>le?(0,H.D)(le.getIdToken()):(0,Xe.of)(null))),this.idTokenResult=this.user.pipe((0,dn.w)(le=>le?(0,H.D)(le.getIdTokenResult()):(0,Xe.of)(null))),this.credential=(0,fy.T)(W,E,this.authState.pipe((0,Dt.h)(le=>!le))).pipe((0,J.U)(le=>(null==le?void 0:le.user)?le:null),(0,Ru.R)(u.outsideAngular),(0,zi.QV)(u.insideAngular))}return(0,Z.pX)(this,b,a,{spy:{apply:(M,W,ge)=>{(M.startsWith("signIn")||M.startsWith("createUser"))&&ge.then(Fe=>E.next(Fe))}}})}}return s.\u0275fac=function(r){return new(r||s)(A.LFG(Z.Dh),A.LFG(Z.xv,8),A.LFG(A.Lbi),A.LFG(A.R0b),A.LFG(D.HU),A.LFG(bd,8),A.LFG(Ad,8),A.LFG(Nd,8),A.LFG(Cd,8),A.LFG(Dd,8),A.LFG(kd,8))},s.\u0275prov=A.Yz7({token:s,factory:s.\u0275fac,providedIn:"any"}),s})();function Ld(s,n){return function(s,n=X.z){return new y.y(r=>{let i;return null!=n?n.schedule(()=>{i=s.onSnapshot({includeMetadataChanges:!0},r)}):i=s.onSnapshot({includeMetadataChanges:!0},r),()=>{null!=i&&i()}})}(s,n)}function Ou(s,n){return Ld(s,n).pipe((0,J.U)(r=>({payload:r,type:"query"})))}function Wi(s,n){return Ou(s,n).pipe((0,ee.O)(void 0),(0,we.G)(),(0,J.U)(([r,i])=>{const o=i.payload.docChanges(),a=o.map(u=>({type:u.type,payload:u}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,c)=>{const l=o.find(d=>d.doc.ref.isEqual(u.ref)),h=null==r?void 0:r.payload.docs.find(d=>d.ref.isEqual(u.ref));l&&JSON.stringify(l.doc.metadata)===JSON.stringify(u.metadata)||!l&&h&&JSON.stringify(h.metadata)===JSON.stringify(u.metadata)||a.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:u}})}),a}))}function Pd(s,n,r){return Wi(s,r).pipe((0,he.R)((i,o)=>function(s,n,r){return n.forEach(i=>{r.indexOf(i.type)>-1&&(s=function(s,n){switch(n.type){case"added":if(!s[n.newIndex]||!s[n.newIndex].doc.ref.isEqual(n.doc.ref))return Lu(s,n.newIndex,0,n);break;case"modified":if(null==s[n.oldIndex]||s[n.oldIndex].doc.ref.isEqual(n.doc.ref)){if(n.oldIndex!==n.newIndex){const r=s.slice();return r.splice(n.oldIndex,1),r.splice(n.newIndex,0,n),r}return Lu(s,n.newIndex,1,n)}break;case"removed":if(s[n.oldIndex]&&s[n.oldIndex].doc.ref.isEqual(n.doc.ref))return Lu(s,n.oldIndex,1)}return s}(s,i))}),s}(i,o.map(a=>a.payload),n),[]),(0,et.x)(),(0,J.U)(i=>i.map(o=>({type:o.type,payload:o}))))}function Lu(s,n,r,...i){const o=s.slice();return o.splice(n,r,...i),o}function Md(s){return(!s||0===s.length)&&(s=["added","removed","modified"]),s}class Fd{constructor(n,r,i){this.ref=n,this.query=r,this.afs=i}stateChanges(n){let r=Wi(this.query,this.afs.schedulers.outsideAngular);return n&&n.length>0&&(r=r.pipe((0,J.U)(i=>i.filter(o=>n.indexOf(o.type)>-1)))),r.pipe((0,ee.O)(void 0),(0,we.G)(),(0,Dt.h)(([i,o])=>o.length>0||!i),(0,J.U)(([i,o])=>o),D.iC)}auditTrail(n){return this.stateChanges(n).pipe((0,he.R)((r,i)=>[...r,...i],[]))}snapshotChanges(n){const r=Md(n);return Pd(this.query,r,this.afs.schedulers.outsideAngular).pipe(D.iC)}valueChanges(n={}){return Ou(this.query,this.afs.schedulers.outsideAngular).pipe((0,J.U)(r=>r.payload.docs.map(i=>n.idField?Object.assign(Object.assign({},i.data()),{[n.idField]:i.id}):i.data())),D.iC)}get(n){return(0,H.D)(this.query.get(n)).pipe(D.iC)}add(n){return this.ref.add(n)}doc(n){return new Ud(this.ref.doc(n),this.afs)}}class Ud{constructor(n,r){this.ref=n,this.afs=r}set(n,r){return this.ref.set(n,r)}update(n){return this.ref.update(n)}delete(){return this.ref.delete()}collection(n,r){const i=this.ref.collection(n),{ref:o,query:a}=Vd(i,r);return new Fd(o,a,this.afs)}snapshotChanges(){return function(s,n){return Ld(s,n).pipe((0,ee.O)(void 0),(0,we.G)(),(0,J.U)(([r,i])=>i.exists?(null==r?void 0:r.exists)?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(D.iC)}valueChanges(n={}){return this.snapshotChanges().pipe((0,J.U)(({payload:r})=>n.idField?Object.assign(Object.assign({},r.data()),{[n.idField]:r.id}):r.data()))}get(n){return(0,H.D)(this.ref.get(n)).pipe(D.iC)}}class _y{constructor(n,r){this.query=n,this.afs=r}stateChanges(n){return n&&0!==n.length?Wi(this.query,this.afs.schedulers.outsideAngular).pipe((0,J.U)(r=>r.filter(i=>n.indexOf(i.type)>-1)),(0,Dt.h)(r=>r.length>0),D.iC):Wi(this.query,this.afs.schedulers.outsideAngular).pipe(D.iC)}auditTrail(n){return this.stateChanges(n).pipe((0,he.R)((r,i)=>[...r,...i],[]))}snapshotChanges(n){const r=Md(n);return Pd(this.query,r,this.afs.schedulers.outsideAngular).pipe(D.iC)}valueChanges(n={}){return Ou(this.query,this.afs.schedulers.outsideAngular).pipe((0,J.U)(i=>i.payload.docs.map(o=>n.idField?Object.assign({[n.idField]:o.id},o.data()):o.data())),D.iC)}get(n){return(0,H.D)(this.query.get(n)).pipe(D.iC)}}const Iy=new A.OlP("angularfire2.enableFirestorePersistence"),Ey=new A.OlP("angularfire2.firestore.persistenceSettings"),Ty=new A.OlP("angularfire2.firestore.settings"),Sy=new A.OlP("angularfire2.firestore.use-emulator");function Vd(s,n=(r=>r)){return{query:n(s),ref:s}}let xy=(()=>{class s{constructor(r,i,o,a,u,c,l,h,d,g,_,E,b,M,W,ge){this.schedulers=l;const Fe=(0,Z.on)(r,c,i),le=d;g&&Rd(Fe,c,_,b,M,W,E,ge),[this.firestore,this.persistenceEnabled$]=(0,D.cc)(`${Fe.name}.firestore`,"AngularFirestore",Fe.name,()=>{const Ae=c.runOutsideAngular(()=>Fe.firestore());if(a&&Ae.settings(a),le&&Ae.useEmulator(...le),o&&!(0,de.PM)(u)){const It=()=>{try{return(0,H.D)(Ae.enablePersistence(h||void 0).then(()=>!0,()=>!1))}catch(Zi){return"undefined"!=typeof console&&console.warn(Zi),(0,Xe.of)(!1)}};return[Ae,c.runOutsideAngular(It)]}return[Ae,(0,Xe.of)(!1)]},[a,le,o])}collection(r,i){let o;o="string"==typeof r?this.firestore.collection(r):r;const{ref:a,query:u}=Vd(o,i),c=this.schedulers.ngZone.run(()=>a);return new Fd(c,u,this)}collectionGroup(r,i){const o=i||(u=>u),a=this.firestore.collectionGroup(r);return new _y(o(a),this)}doc(r){let i;i="string"==typeof r?this.firestore.doc(r):r;const o=this.schedulers.ngZone.run(()=>i);return new Ud(o,this)}createId(){return this.firestore.collection("_").doc().id}}return s.\u0275fac=function(r){return new(r||s)(A.LFG(Z.Dh),A.LFG(Z.xv,8),A.LFG(Iy,8),A.LFG(Ty,8),A.LFG(A.Lbi),A.LFG(A.R0b),A.LFG(D.HU),A.LFG(Ey,8),A.LFG(Sy,8),A.LFG(Od,8),A.LFG(bd,8),A.LFG(Ad,8),A.LFG(Nd,8),A.LFG(Cd,8),A.LFG(Dd,8),A.LFG(kd,8))},s.\u0275prov=A.Yz7({token:s,factory:s.\u0275fac,providedIn:"any"}),s})()},273:(Lr,bt,V)=>{V.d(bt,{H:()=>et});var A=V(3065),X=V(7716),D=(()=>{return(Z=D||(D={}))[Z.EntitiesOnly=0]="EntitiesOnly",Z[Z.Both=1]="Both",Z[Z.None=2]="None",D;var Z})();function ee(Z){return function(Ie,be){const I={ids:[...be.ids],entities:Object.assign({},be.entities)},Ue=Z(Ie,I);return Ue===D.Both?Object.assign({},be,I):Ue===D.EntitiesOnly?Object.assign(Object.assign({},be),{entities:I.entities}):be}}function we(Z,de){const Ie=de(Z);return(0,X.X6Q)()&&void 0===Ie&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",Z,"The `selectId` implementation:",de.toString()),Ie}function J(Z){function de(j,P){const L=we(j,Z);return L in P.entities?D.None:(P.ids.push(L),P.entities[L]=j,D.Both)}function Ie(j,P){let L=!1;for(const C of j)L=de(C,P)!==D.None||L;return L?D.Both:D.None}function I(j,P){const L=we(j,Z);return L in P.entities?(P.entities[L]=j,D.EntitiesOnly):(P.ids.push(L),P.entities[L]=j,D.Both)}function tt(j,P){const C=(j instanceof Array?j:P.ids.filter(F=>j(P.entities[F]))).filter(F=>F in P.entities).map(F=>delete P.entities[F]).length>0;return C&&(P.ids=P.ids.filter(F=>F in P.entities)),C?D.Both:D.None}function ze(j,P){return R([j],P)}function R(j,P){const L={};return(j=j.filter(F=>F.id in P.entities)).length>0?j.filter($=>function(j,P,L){const F=Object.assign({},L.entities[P.id],P.changes),$=we(F,Z),K=$!==P.id;return K&&(j[P.id]=$,delete L.entities[P.id]),L.entities[$]=F,K}(L,$,P)).length>0?(P.ids=P.ids.map($=>L[$]||$),D.Both):D.EntitiesOnly:D.None}function Rt(j,P){const L=[],C=[];for(const K of j){const fe=we(K,Z);fe in P.entities?C.push({id:fe,changes:K}):L.push(K)}const F=R(C,P),$=Ie(L,P);switch(!0){case $===D.None&&F===D.None:return D.None;case $===D.Both||F===D.Both:return D.Both;default:return D.EntitiesOnly}}return{removeAll:function(j){return Object.assign({},j,{ids:[],entities:{}})},addOne:ee(de),addMany:ee(Ie),setAll:ee(function(j,P){return P.ids=[],P.entities={},Ie(j,P),D.Both}),setOne:ee(I),setMany:ee(function(j,P){const L=j.map(C=>I(C,P));switch(!0){case L.some(C=>C===D.Both):return D.Both;case L.some(C=>C===D.EntitiesOnly):return D.EntitiesOnly;default:return D.None}}),updateOne:ee(ze),updateMany:ee(R),upsertOne:ee(function(j,P){return Rt([j],P)}),upsertMany:ee(Rt),removeOne:ee(function(j,P){return tt([j],P)}),removeMany:ee(tt),map:ee(function(j,P){return R(P.ids.reduce((F,$)=>{const K=j(P.entities[$]);return K!==P.entities[$]&&F.push({id:$,changes:K}),F},[]).filter(({id:F})=>F in P.entities),P)}),mapOne:ee(function({map:j,id:P},L){const C=L.entities[P];return C?ze({id:P,changes:j(C)},L):D.None})}}function et(Z={}){const{selectId:de,sortComparer:Ie}=Object.assign({sortComparer:!1,selectId:_e=>_e.id},Z),be={getInitialState:function(de={}){return Object.assign({ids:[],entities:{}},de)}},I={getSelectors:function(de){const Ie=_e=>_e.ids,be=_e=>_e.entities,I=(0,A.P1)(Ie,be,(_e,tt)=>_e.map(Y=>tt[Y])),Ue=(0,A.P1)(Ie,_e=>_e.length);return de?{selectIds:(0,A.P1)(de,Ie),selectEntities:(0,A.P1)(de,be),selectAll:(0,A.P1)(de,I),selectTotal:(0,A.P1)(de,Ue)}:{selectIds:Ie,selectEntities:be,selectAll:I,selectTotal:Ue}}},Ue=Ie?function(Z,de){const{removeOne:Ie,removeMany:be,removeAll:I}=J(Z);function Ue(L,C){return _e([L],C)}function _e(L,C){const F=L.filter($=>!(we($,Z)in C.entities));return 0===F.length?D.None:(P(F,C),D.Both)}function Y(L,C){const F=we(L,Z);return F in C.entities?(C.ids=C.ids.filter($=>$!==F),P([L],C),D.Both):Ue(L,C)}function ze(L,C){return mt([L],C)}function mt(L,C){const F=[],$=L.filter(K=>function(L,C,F){if(!(C.id in F.entities))return!1;const K=Object.assign({},F.entities[C.id],C.changes),fe=we(K,Z);return delete F.entities[C.id],L.push(K),fe!==C.id}(F,K,C)).length>0;if(0===F.length)return D.None;{const K=C.ids,fe=[];return C.ids=C.ids.filter((ie,Ve)=>ie in C.entities||(fe.push(Ve),!1)),P(F,C),!$&&fe.every(ie=>C.ids[ie]===K[ie])?D.EntitiesOnly:D.Both}}function j(L,C){const F=[],$=[];for(const ie of L){const Ve=we(ie,Z);Ve in C.entities?$.push({id:Ve,changes:ie}):F.push(ie)}const K=mt($,C),fe=_e(F,C);switch(!0){case fe===D.None&&K===D.None:return D.None;case fe===D.Both||K===D.Both:return D.Both;default:return D.EntitiesOnly}}function P(L,C){L.sort(de);const F=[];let $=0,K=0;for(;$<L.length&&K<C.ids.length;){const fe=L[$],ie=we(fe,Z),Ve=C.ids[K];de(fe,C.entities[Ve])<=0?(F.push(ie),$++):(F.push(Ve),K++)}C.ids=F.concat($<L.length?L.slice($).map(Z):C.ids.slice(K)),L.forEach((fe,ie)=>{C.entities[Z(fe)]=fe})}return{removeOne:Ie,removeMany:be,removeAll:I,addOne:ee(Ue),updateOne:ee(ze),upsertOne:ee(function(L,C){return j([L],C)}),setAll:ee(function(L,C){return C.entities={},C.ids=[],_e(L,C),D.Both}),setOne:ee(Y),setMany:ee(function(L,C){const F=L.map($=>Y($,C));switch(!0){case F.some($=>$===D.Both):return D.Both;case F.some($=>$===D.EntitiesOnly):return D.EntitiesOnly;default:return D.None}}),addMany:ee(_e),updateMany:ee(mt),upsertMany:ee(j),map:ee(function(L,C){return mt(C.ids.reduce(($,K)=>{const fe=L(C.entities[K]);return fe!==C.entities[K]&&$.push({id:K,changes:fe}),$},[]),C)}),mapOne:ee(function({map:L,id:C},F){const $=F.entities[C];return $?ze({id:C,changes:L($)},F):D.None})}}(de,Ie):J(de);return Object.assign(Object.assign(Object.assign({selectId:de,sortComparer:Ie},be),I),Ue)}},4828:(Lr,bt,V)=>{V.r(bt);var A=V(8239),X=V(4486),y=V(7429),H=V(3854),ee=(V(5452),V(5601),V(8308));function we(){return window}function et(){return(et=(0,A.Z)(function*(v,f,m){var T;const{BuildInfo:O}=we();(0,y.ap)(f.sessionId,"AuthEvent did not contain a session ID");const G=yield Ue(f.sessionId),ne={};return(0,y.aq)()?ne.ibi=O.packageName:(0,y.ar)()?ne.apn=O.packageName:(0,y.as)(v,"operation-not-supported-in-this-environment"),O.displayName&&(ne.appDisplayName=O.displayName),ne.sessionId=G,(0,y.at)(v,m,f.type,void 0,null!==(T=f.eventId)&&void 0!==T?T:void 0,ne)})).apply(this,arguments)}function Z(){return(Z=(0,A.Z)(function*(v){const{BuildInfo:f}=we(),m={};(0,y.aq)()?m.iosBundleId=f.packageName:(0,y.ar)()?m.androidPackageName=f.packageName:(0,y.as)(v,"operation-not-supported-in-this-environment"),yield(0,y.au)(v,m)})).apply(this,arguments)}function be(){return(be=(0,A.Z)(function*(v,f,m){const{cordova:T}=we();let O=()=>{};try{yield new Promise((G,ne)=>{let oe=null;function Le(){var ae;G();const Et=null===(ae=T.plugins.browsertab)||void 0===ae?void 0:ae.close;"function"==typeof Et&&Et(),"function"==typeof(null==m?void 0:m.close)&&m.close()}function at(){oe||(oe=window.setTimeout(()=>{ne((0,y.av)(v,"redirect-cancelled-by-user"))},2e3))}function pt(){"visible"===(null==document?void 0:document.visibilityState)&&at()}f.addPassiveListener(Le),document.addEventListener("resume",at,!1),(0,y.ar)()&&document.addEventListener("visibilitychange",pt,!1),O=()=>{f.removePassiveListener(Le),document.removeEventListener("resume",at,!1),document.removeEventListener("visibilitychange",pt,!1),oe&&window.clearTimeout(oe)}})}finally{O()}})).apply(this,arguments)}function Ue(v){return _e.apply(this,arguments)}function _e(){return(_e=(0,A.Z)(function*(v){const f=tt(v),m=yield crypto.subtle.digest("SHA-256",f);return Array.from(new Uint8Array(m)).map(O=>O.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}function tt(v){if((0,y.ap)(/[0-9a-zA-Z]+/.test(v),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(v);const f=new ArrayBuffer(v.length),m=new Uint8Array(f);for(let T=0;T<v.length;T++)m[T]=v.charCodeAt(T);return m}class fn extends y.az{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(f=>{this.resolveInialized=f})}addPassiveListener(f){this.passiveListeners.add(f)}removePassiveListener(f){this.passiveListeners.delete(f)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(f){return this.resolveInialized(),this.passiveListeners.forEach(m=>m(f)),super.onEvent(f)}initialized(){var f=this;return(0,A.Z)(function*(){yield f.initPromise})()}}function mt(v){return q.apply(this,arguments)}function q(){return(q=(0,A.Z)(function*(v){const f=yield j()._get(P(v));return f&&(yield j()._remove(P(v))),f})).apply(this,arguments)}function Rt(){const v=[],f="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let m=0;m<20;m++){const T=Math.floor(Math.random()*f.length);v.push(f.charAt(T))}return v.join("")}function j(){return(0,y.ax)(y.b)}function P(v){return(0,y.ay)("authEvent",v.config.apiKey,v.name)}function F(v){if(!(null==v?void 0:v.includes("?")))return{};const[f,...m]=v.split("?");return(0,H.zd)(m.join("?"))}function ie(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:(0,y.av)("no-auth-event")}}function gn(){var v;return(null===(v=null==self?void 0:self.location)||void 0===v?void 0:v.protocol)||null}function Mr(v=(0,H.z$)()){return!("file:"!==gn()&&"ionic:"!==gn()||!v.toLowerCase().match(/iphone|ipad|ipod|android/))}function Bn(){try{const v=self.localStorage,f=y.aG();if(v)return v.setItem(f,"1"),v.removeItem(f),!function(v=(0,H.z$)()){return(0,H.w1)()&&11===(null==document?void 0:document.documentMode)||function(v=(0,H.z$)()){return/Edge\/\d+/.test(v)}(v)}()||(0,H.hl)()}catch(v){return Oe()&&(0,H.hl)()}return!1}function Oe(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function qn(){return("http:"===gn()||"https:"===gn()||(0,H.ru)()||Mr())&&!((0,H.b$)()||(0,H.UG)())&&Bn()&&!Oe()}function Ur(){return Mr()&&"undefined"!=typeof document}function jn(){return(jn=(0,A.Z)(function*(){return!!Ur()&&new Promise(v=>{const f=setTimeout(()=>{v(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(f),v(!0)})})})).apply(this,arguments)}const nt={LOCAL:"local",NONE:"none",SESSION:"session"},Ht=y.aw,Kn="persistence";function Br(v){return Ot.apply(this,arguments)}function Ot(){return(Ot=(0,A.Z)(function*(v){yield v._initializationPromise;const f=Gn(),m=y.ay(Kn,v.config.apiKey,v.name);(null==f?void 0:f.sessionStorage)&&f.sessionStorage.setItem(m,v._getPersistence())})).apply(this,arguments)}function Gn(){return"undefined"!=typeof window?window:null}const qs=y.aw;class Lt{constructor(){this.browserResolver=y.ax(y.k),this.cordovaResolver=y.ax(class{constructor(){this._redirectPersistence=y.a,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=y.aA}_initialize(f){var m=this;return(0,A.Z)(function*(){const T=f._key();let O=m.eventManagers.get(T);return O||(O=new fn(f),m.eventManagers.set(T,O),m.attachCallbackListeners(f,O)),O})()}_openPopup(f){(0,y.as)(f,"operation-not-supported-in-this-environment")}_openRedirect(f,m,T,O){var G=this;return(0,A.Z)(function*(){!function(v){var f,m,T,O,G,ne,oe,Le,at,pt;const ae=we();(0,y.aw)("function"==typeof(null===(f=null==ae?void 0:ae.universalLinks)||void 0===f?void 0:f.subscribe),v,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),(0,y.aw)(void 0!==(null===(m=null==ae?void 0:ae.BuildInfo)||void 0===m?void 0:m.packageName),v,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),(0,y.aw)("function"==typeof(null===(G=null===(O=null===(T=null==ae?void 0:ae.cordova)||void 0===T?void 0:T.plugins)||void 0===O?void 0:O.browsertab)||void 0===G?void 0:G.openUrl),v,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,y.aw)("function"==typeof(null===(Le=null===(oe=null===(ne=null==ae?void 0:ae.cordova)||void 0===ne?void 0:ne.plugins)||void 0===oe?void 0:oe.browsertab)||void 0===Le?void 0:Le.isAvailable),v,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,y.aw)("function"==typeof(null===(pt=null===(at=null==ae?void 0:ae.cordova)||void 0===at?void 0:at.InAppBrowser)||void 0===pt?void 0:pt.open),v,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(f);const ne=yield G._initialize(f);yield ne.initialized(),ne.resetRedirect(),(0,y.aB)(),yield G._originValidation(f);const oe=function(v,f,m=null){return{type:f,eventId:m,urlResponse:null,sessionId:Rt(),postBody:null,tenantId:v.tenantId,error:(0,y.av)(v,"no-auth-event")}}(f,T,O);yield function(v,f){return j()._set(P(v),f)}(f,oe);const Le=yield function(v,f,m){return et.apply(this,arguments)}(f,oe,m),at=yield function(v){const{cordova:f}=we();return new Promise(m=>{f.plugins.browsertab.isAvailable(T=>{let O=null;T?f.plugins.browsertab.openUrl(v):O=f.InAppBrowser.open(v,(0,y.ao)()?"_blank":"_system","location=yes"),m(O)})})}(Le);return function(v,f,m){return be.apply(this,arguments)}(f,ne,at)})()}_isIframeWebStorageSupported(f,m){throw new Error("Method not implemented.")}_originValidation(f){const m=f._key();return this.originValidationPromises[m]||(this.originValidationPromises[m]=function(v){return Z.apply(this,arguments)}(f)),this.originValidationPromises[m]}attachCallbackListeners(f,m){const{universalLinks:T,handleOpenURL:O,BuildInfo:G}=we(),ne=setTimeout((0,A.Z)(function*(){yield mt(f),m.onEvent(ie())}),500),oe=function(){var pt=(0,A.Z)(function*(ae){clearTimeout(ne);const Et=yield mt(f);let Qn=null;Et&&(null==ae?void 0:ae.url)&&(Qn=function(v,f){var m,T;const O=function(v){const f=F(v),m=f.link?decodeURIComponent(f.link):void 0,T=F(m).link,O=f.deep_link_id?decodeURIComponent(f.deep_link_id):void 0;return F(O).link||O||T||m||v}(f);if(O.includes("/__/auth/callback")){const G=F(O),ne=G.firebaseError?function(v){try{return JSON.parse(v)}catch(f){return null}}(decodeURIComponent(G.firebaseError)):null,oe=null===(T=null===(m=null==ne?void 0:ne.code)||void 0===m?void 0:m.split("auth/"))||void 0===T?void 0:T[1],Le=oe?(0,y.av)(oe):null;return Le?{type:v.type,eventId:v.eventId,tenantId:v.tenantId,error:Le,urlResponse:null,sessionId:null,postBody:null}:{type:v.type,eventId:v.eventId,tenantId:v.tenantId,sessionId:v.sessionId,urlResponse:O,postBody:null}}return null}(Et,ae.url)),m.onEvent(Qn||ie())});return function(Et){return pt.apply(this,arguments)}}();void 0!==T&&"function"==typeof T.subscribe&&T.subscribe(null,oe);const Le=O,at=`${G.packageName.toLowerCase()}://`;we().handleOpenURL=function(){var pt=(0,A.Z)(function*(ae){if(ae.toLowerCase().startsWith(at)&&oe({url:ae}),"function"==typeof Le)try{Le(ae)}catch(Et){console.error(Et)}});return function(ae){return pt.apply(this,arguments)}}()}}),this.underlyingResolver=null,this._redirectPersistence=y.a,this._completeRedirectFn=y.aA}_initialize(f){var m=this;return(0,A.Z)(function*(){return yield m.selectUnderlyingResolver(),m.assertedUnderlyingResolver._initialize(f)})()}_openPopup(f,m,T,O){var G=this;return(0,A.Z)(function*(){return yield G.selectUnderlyingResolver(),G.assertedUnderlyingResolver._openPopup(f,m,T,O)})()}_openRedirect(f,m,T,O){var G=this;return(0,A.Z)(function*(){return yield G.selectUnderlyingResolver(),G.assertedUnderlyingResolver._openRedirect(f,m,T,O)})()}_isIframeWebStorageSupported(f,m){this.assertedUnderlyingResolver._isIframeWebStorageSupported(f,m)}_originValidation(f){return this.assertedUnderlyingResolver._originValidation(f)}get _shouldInitProactively(){return Ur()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return qs(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var f=this;return(0,A.Z)(function*(){if(f.underlyingResolver)return;const m=yield function(){return jn.apply(this,arguments)}();f.underlyingResolver=m?f.cordovaResolver:f.browserResolver})()}}function qr(v){return v.unwrap()}function jr(v){return zn(v)}function Kr(v,f){var m;const T=null===(m=f.customData)||void 0===m?void 0:m._tokenResponse;if("auth/multi-factor-auth-required"===f.code)f.resolver=new Ji(v,y.am(v,f));else if(T){const O=zn(f),G=f;O&&(G.credential=O,G.tenantId=T.tenantId||void 0,G.email=T.email||void 0,G.phoneNumber=T.phoneNumber||void 0)}}function zn(v){const{_tokenResponse:f}=v instanceof H.ZR?v.customData:v;if(!f)return null;if(!(v instanceof H.ZR)&&"temporaryProof"in f&&"phoneNumber"in f)return y.P.credentialFromResult(v);const m=f.providerId;if(!m||m===y.o.PASSWORD)return null;let T;switch(m){case y.o.GOOGLE:T=y.N;break;case y.o.FACEBOOK:T=y.M;break;case y.o.GITHUB:T=y.Q;break;case y.o.TWITTER:T=y.V;break;default:const{oauthIdToken:O,oauthAccessToken:G,oauthTokenSecret:ne,pendingToken:oe,nonce:Le}=f;return G||ne||O||oe?oe?m.startsWith("saml.")?y.aJ._create(m,oe):y.I._fromParams({providerId:m,signInMethod:m,pendingToken:oe,idToken:O,accessToken:G}):new y.T(m).credential({idToken:O,accessToken:G,rawNonce:Le}):null}return v instanceof H.ZR?T.credentialFromError(v):T.credentialFromResult(v)}function rt(v,f){return Gr.apply(this,arguments)}function Gr(){return(Gr=(0,A.Z)(function*(v,f){let m;try{m=yield f}catch(G){throw G instanceof H.ZR&&Kr(v,G),G}const{operationType:T,user:O}=m;return{operationType:T,credential:jr(m),additionalUserInfo:y.ak(m),user:At.getOrCreate(O)}})).apply(this,arguments)}function mn(v,f){return Wn.apply(this,arguments)}function Wn(){return(Wn=(0,A.Z)(function*(v,f){const m=yield f;return{verificationId:m.verificationId,confirm:T=>rt(v,m.confirm(T))}})).apply(this,arguments)}class Ji{constructor(f,m){this.resolver=m,this.auth=f.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(f){return rt(qr(this.auth),this.resolver.resolveSignIn(f))}}class At{constructor(f){this._delegate=f,this.multiFactor=y.an(f)}static getOrCreate(f){return At.USER_MAP.has(f)||At.USER_MAP.set(f,new At(f)),At.USER_MAP.get(f)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(f){return this._delegate.getIdTokenResult(f)}getIdToken(f){return this._delegate.getIdToken(f)}linkAndRetrieveDataWithCredential(f){return this.linkWithCredential(f)}linkWithCredential(f){var m=this;return(0,A.Z)(function*(){return rt(m.auth,y.Y(m._delegate,f))})()}linkWithPhoneNumber(f,m){var T=this;return(0,A.Z)(function*(){return mn(T.auth,y.l(T._delegate,f,m))})()}linkWithPopup(f){var m=this;return(0,A.Z)(function*(){return rt(m.auth,y.d(m._delegate,f,Lt))})()}linkWithRedirect(f){var m=this;return(0,A.Z)(function*(){return yield Br(y.aC(m.auth)),y.g(m._delegate,f,Lt)})()}reauthenticateAndRetrieveDataWithCredential(f){return this.reauthenticateWithCredential(f)}reauthenticateWithCredential(f){var m=this;return(0,A.Z)(function*(){return rt(m.auth,y.Z(m._delegate,f))})()}reauthenticateWithPhoneNumber(f,m){return mn(this.auth,y.r(this._delegate,f,m))}reauthenticateWithPopup(f){return rt(this.auth,y.e(this._delegate,f,Lt))}reauthenticateWithRedirect(f){var m=this;return(0,A.Z)(function*(){return yield Br(y.aC(m.auth)),y.h(m._delegate,f,Lt)})()}sendEmailVerification(f){return y.aa(this._delegate,f)}unlink(f){var m=this;return(0,A.Z)(function*(){return yield y.aj(m._delegate,f),m})()}updateEmail(f){return y.af(this._delegate,f)}updatePassword(f){return y.ag(this._delegate,f)}updatePhoneNumber(f){return y.u(this._delegate,f)}updateProfile(f){return y.ae(this._delegate,f)}verifyBeforeUpdateEmail(f,m){return y.ab(this._delegate,f,m)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}At.USER_MAP=new WeakMap;const Ee=y.aw;let Qt=(()=>{class v{constructor(m,T){if(this.app=m,T.isInitialized())return this._delegate=T.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:O}=m.options;Ee(O,"invalid-api-key",{appName:m.name});let G=[y.K];if("undefined"!=typeof window){G=function(v,f){const m=Gn();if(!(null==m?void 0:m.sessionStorage))return[];const T=y.ay(Kn,v,f);switch(m.sessionStorage.getItem(T)){case nt.NONE:return[y.K];case nt.LOCAL:return[y.i,y.a];case nt.SESSION:return[y.a];default:return[]}}(O,m.name);for(const oe of[y.i,y.b,y.a])G.includes(oe)||G.push(oe)}Ee(O,"invalid-api-key",{appName:m.name});const ne="undefined"!=typeof window?Lt:void 0;this._delegate=T.initialize({options:{persistence:G,popupRedirectResolver:ne}}),this._delegate._updateErrorMap(y.z),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?At.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(m){this._delegate.languageCode=m}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(m){this._delegate.tenantId=m}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(m,T){y.E(this._delegate,m,T)}applyActionCode(m){return y.a1(this._delegate,m)}checkActionCode(m){return y.a2(this._delegate,m)}confirmPasswordReset(m,T){return y.a0(this._delegate,m,T)}createUserWithEmailAndPassword(m,T){var O=this;return(0,A.Z)(function*(){return rt(O._delegate,y.a4(O._delegate,m,T))})()}fetchProvidersForEmail(m){return this.fetchSignInMethodsForEmail(m)}fetchSignInMethodsForEmail(m){return y.a9(this._delegate,m)}isSignInWithEmailLink(m){return y.a7(this._delegate,m)}getRedirectResult(){var m=this;return(0,A.Z)(function*(){Ee(qn(),m._delegate,"operation-not-supported-in-this-environment");const T=yield y.j(m._delegate,Lt);return T?rt(m._delegate,Promise.resolve(T)):{credential:null,user:null}})()}addFrameworkForLogging(m){!function(v,f){(0,y.aC)(v)._logFramework(f)}(this._delegate,m)}onAuthStateChanged(m,T,O){const{next:G,error:ne,complete:oe}=js(m,T,O);return this._delegate.onAuthStateChanged(G,ne,oe)}onIdTokenChanged(m,T,O){const{next:G,error:ne,complete:oe}=js(m,T,O);return this._delegate.onIdTokenChanged(G,ne,oe)}sendSignInLinkToEmail(m,T){return y.a6(this._delegate,m,T)}sendPasswordResetEmail(m,T){return y.$(this._delegate,m,T||void 0)}setPersistence(m){var T=this;return(0,A.Z)(function*(){let O;switch(function(v,f){Ht(Object.values(nt).includes(f),v,"invalid-persistence-type"),(0,H.b$)()?Ht(f!==nt.SESSION,v,"unsupported-persistence-type"):(0,H.UG)()?Ht(f===nt.NONE,v,"unsupported-persistence-type"):Oe()?Ht(f===nt.NONE||f===nt.LOCAL&&(0,H.hl)(),v,"unsupported-persistence-type"):Ht(f===nt.NONE||Bn(),v,"unsupported-persistence-type")}(T._delegate,m),m){case nt.SESSION:O=y.a;break;case nt.LOCAL:O=(yield y.ax(y.i)._isAvailable())?y.i:y.b;break;case nt.NONE:O=y.K;break;default:return y.as("argument-error",{appName:T._delegate.name})}return T._delegate.setPersistence(O)})()}signInAndRetrieveDataWithCredential(m){return this.signInWithCredential(m)}signInAnonymously(){return rt(this._delegate,y.W(this._delegate))}signInWithCredential(m){return rt(this._delegate,y.X(this._delegate,m))}signInWithCustomToken(m){return rt(this._delegate,y._(this._delegate,m))}signInWithEmailAndPassword(m,T){return rt(this._delegate,y.a5(this._delegate,m,T))}signInWithEmailLink(m,T){return rt(this._delegate,y.a8(this._delegate,m,T))}signInWithPhoneNumber(m,T){return mn(this._delegate,y.s(this._delegate,m,T))}signInWithPopup(m){var T=this;return(0,A.Z)(function*(){return Ee(qn(),T._delegate,"operation-not-supported-in-this-environment"),rt(T._delegate,y.c(T._delegate,m,Lt))})()}signInWithRedirect(m){var T=this;return(0,A.Z)(function*(){return Ee(qn(),T._delegate,"operation-not-supported-in-this-environment"),yield Br(T._delegate),y.f(T._delegate,m,Lt)})()}updateCurrentUser(m){return this._delegate.updateCurrentUser(m)}verifyPasswordResetCode(m){return y.a3(this._delegate,m)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return v.Persistence=nt,v})();function js(v,f,m){let T=v;"function"!=typeof v&&({next:T,error:f,complete:m}=v);const O=T;return{next:ne=>O(ne&&At.getOrCreate(ne)),error:f,complete:m}}class Bt{constructor(){this.providerId="phone",this._delegate=new y.P(qr(X.Z.auth()))}static credential(f,m){return y.P.credential(f,m)}verifyPhoneNumber(f,m){return this._delegate.verifyPhoneNumber(f,m)}unwrap(){return this._delegate}}Bt.PHONE_SIGN_IN_METHOD=y.P.PHONE_SIGN_IN_METHOD,Bt.PROVIDER_ID=y.P.PROVIDER_ID;const Xi=y.aw;var v;(v=X.Z).INTERNAL.registerComponent(new ee.wA("auth-compat",f=>{const m=f.getProvider("app-compat").getImmediate(),T=f.getProvider("auth");return new Qt(m,T)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:y.A.EMAIL_SIGNIN,PASSWORD_RESET:y.A.PASSWORD_RESET,RECOVER_EMAIL:y.A.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:y.A.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:y.A.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:y.A.VERIFY_EMAIL}},EmailAuthProvider:y.L,FacebookAuthProvider:y.M,GithubAuthProvider:y.Q,GoogleAuthProvider:y.N,OAuthProvider:y.T,PhoneAuthProvider:Bt,PhoneMultiFactorGenerator:y.m,RecaptchaVerifier:class{constructor(f,m,T=X.Z.app()){var O;Xi(null===(O=T.options)||void 0===O?void 0:O.apiKey,"invalid-api-key",{appName:T.name}),this._delegate=new y.R(f,m,T.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:y.V,Auth:Qt,AuthCredential:y.G,Error:H.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),v.registerVersion("@firebase/auth-compat","0.1.3")},3617:(Lr,bt,V)=>{V.d(bt,{N:()=>y});var A=V(9765),X=V(7716);let y=(()=>{class H{constructor(){this.wholePage=!1,this.loading=!0,this.logoShakeState=!1,this.compDest$=new A.xQ}ngOnChanges(D){this.parentClass=this.wholePage?"whole-page loading-container":"container loading-container mt-5"}ngOnInit(){}ngOnDestroy(){this.compDest$.next(),this.compDest$.complete()}}return H.\u0275fac=function(D){return new(D||H)},H.\u0275cmp=X.Xpm({type:H,selectors:[["app-shared-loading"]],inputs:{wholePage:"wholePage"},features:[X.TTD],decls:13,vars:2,consts:[[1,"row"],[1,"col-sm-12"],[1,"d-flex","loading-parent"],[1,"loading-logo"],["src","assets/banner/resolved2.png","alt","logo",1,"logo-img","d-inline-block"],[1,"lds-facebook"],[1,"d-flex","loading-parent","secfont"]],template:function(D,ee){1&D&&(X.TgZ(0,"div"),X.TgZ(1,"div",0),X.TgZ(2,"div",1),X.TgZ(3,"div",2),X.TgZ(4,"div",3),X._UZ(5,"img",4),X.qZA(),X.qZA(),X.TgZ(6,"div",2),X.TgZ(7,"div",5),X._UZ(8,"div"),X._UZ(9,"div"),X._UZ(10,"div"),X.qZA(),X.qZA(),X.TgZ(11,"div",6),X._uU(12," Loading... "),X.qZA(),X.qZA(),X.qZA(),X.qZA()),2&D&&X.Tol(ee.parentClass)},styles:[".loading-logo[_ngcontent-%COMP%]{height:3rem}.loading-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}.loading-parent[_ngcontent-%COMP%]{justify-content:center;align-items:center}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%}.whole-page[_ngcontent-%COMP%]{position:fixed;width:100%}.lds-facebook[_ngcontent-%COMP%]{display:inline-block;position:relative;width:80px;height:80px}.lds-facebook[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:inline-block;position:absolute;left:8px;width:16px;background:#007bff;animation:lds-facebook 1.2s cubic-bezier(0,.5,.5,1) infinite}.lds-facebook[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){left:8px;animation-delay:-.24s}.lds-facebook[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2){left:32px;animation-delay:-.12s}.lds-facebook[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(3){left:56px;animation-delay:0}@keyframes lds-facebook{0%{top:8px;height:64px}50%,to{top:24px;height:32px}}"]}),H})()},61:(Lr,bt,V)=>{V.d(bt,{I:()=>y});var A=V(8583),X=V(7716);let y=(()=>{class H{}return H.\u0275fac=function(D){return new(D||H)},H.\u0275mod=X.oAB({type:H}),H.\u0275inj=X.cJS({providers:[],imports:[[A.ez]]}),H})()},7343:(Lr,bt,V)=>{V.d(bt,{I:()=>D});var A=V(5990),X=V(7716),y=V(9337),H=V(3065);let D=(()=>{class ee{constructor(J,he){this.afs=J,this.store=he}listenForIssueChanges(){this.readCollectionsOnChanges("issues",J=>{console.log(J.size),J.docChanges().forEach(he=>{console.log(he.type,he.doc.data()),this.updateIssuesStore(he)})},J=>{},()=>{console.log("issue listenered stopped.")})}updateIssuesStore(J){switch(J.type){case"added":case"modified":case"removed":return}}createDocument(J,he){return this.afs.doc(he).set(J)}createDocId(){return this.afs.createId()}updatePartialDocument(J,he){return this.afs.doc(he).update(J.changes)}deleteDocument(J,he="issues"){return this.afs.collection(he).doc(J.id).delete()}readCollections(J,he){const et=this.afs.collection(J);return he?et.ref.where("description",">=",he).get():et.ref.orderBy("dateCreated","desc").get()}readCollectionsOnChanges(J,he,et,Dt){return this.afs.collection(J).ref.orderBy("dateCreated","desc").onSnapshot(he,et,Dt)}addNewIssue(J,he){this.store.dispatch(A.Ow({data:J,url:he}))}}return ee.\u0275fac=function(J){return new(J||ee)(X.LFG(y.ST),X.LFG(H.yh))},ee.\u0275prov=X.Yz7({token:ee,factory:ee.\u0275fac,providedIn:"root"}),ee})()}}]);